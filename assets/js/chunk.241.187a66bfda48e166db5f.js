/*! For license information please see chunk.241.187a66bfda48e166db5f.js.LICENSE.txt */
"use strict";(self.webpackChunkultimate_jekyll=self.webpackChunkultimate_jekyll||[]).push([[241],{241:function(t,e,n){n.r(e);var r=n(788),i=function(t,e){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},i(t,e)};function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function s(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{u(r.next(t))}catch(t){o(t)}}function a(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}u((r=r.apply(t,e||[])).next())}))}function a(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(s=0)),s;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){s.label=a[1];break}if(6===a[0]&&s.label<i[1]){s.label=i[1],i=a;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(a);break}i[2]&&s.ops.pop(),s.trys.pop();continue}a=e.call(t,s)}catch(t){a=[6,t],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}}Object.create;function u(t,e,n){if(n||2===arguments.length)for(var r,i=0,o=e.length;i<o;i++)!r&&i in e||(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))}Object.create;"function"==typeof SuppressedError&&SuppressedError;var c=n(444),h=n(561),l=function(t,e){return l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},l(t,e)};function f(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var d,p="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==n.g?n.g:"undefined"!=typeof self?self:{},y=y||{},g=p||self;function v(){}function m(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function w(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var b="closure_uid_"+(1e9*Math.random()>>>0),T=0;function I(t,e,n){return t.call.apply(t.bind,arguments)}function E(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function _(t,e,n){return(_=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?I:E).apply(null,arguments)}function S(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function D(t,e){function n(){}n.prototype=e.prototype,t.Z=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Vb=function(t,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return e.prototype[n].apply(t,i)}}function N(){this.s=this.s,this.o=this.o}var A={};N.prototype.s=!1,N.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0)){var t=function(t){return Object.prototype.hasOwnProperty.call(t,b)&&t[b]||(t[b]=++T)}(this);delete A[t]}},N.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var k=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},C=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function x(t){return Array.prototype.concat.apply([],arguments)}function R(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function O(t){return/^[\s\xa0]*$/.test(t)}var P,L=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function F(t,e){return-1!=t.indexOf(e)}function M(t,e){return t<e?-1:t>e?1:0}t:{var V=g.navigator;if(V){var q=V.userAgent;if(q){P=q;break t}}P=""}function U(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function j(t){var e={};for(var n in t)e[n]=t[n];return e}var B="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function K(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<B.length;o++)n=B[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function G(t){return G[" "](t),t}G[" "]=v;var Q,z,H=F(P,"Opera"),W=F(P,"Trident")||F(P,"MSIE"),Y=F(P,"Edge"),X=Y||W,$=F(P,"Gecko")&&!(F(P.toLowerCase(),"webkit")&&!F(P,"Edge"))&&!(F(P,"Trident")||F(P,"MSIE"))&&!F(P,"Edge"),J=F(P.toLowerCase(),"webkit")&&!F(P,"Edge");function Z(){var t=g.document;return t?t.documentMode:void 0}t:{var tt="",et=(z=P,$?/rv:([^\);]+)(\)|;)/.exec(z):Y?/Edge\/([\d\.]+)/.exec(z):W?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(z):J?/WebKit\/(\S+)/.exec(z):H?/(?:Version)[ \/]?(\S+)/.exec(z):void 0);if(et&&(tt=et?et[1]:""),W){var nt=Z();if(null!=nt&&nt>parseFloat(tt)){Q=String(nt);break t}}Q=tt}var rt,it={};function ot(){return function(t){var e=it;return Object.prototype.hasOwnProperty.call(e,9)?e[9]:e[9]=t(9)}((function(){for(var t=0,e=L(String(Q)).split("."),n=L("9").split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++){var o=e[i]||"",s=n[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==o[0].length&&0==s[0].length)break;t=M(0==o[1].length?0:parseInt(o[1],10),0==s[1].length?0:parseInt(s[1],10))||M(0==o[2].length,0==s[2].length)||M(o[2],s[2]),o=o[3],s=s[3]}while(0==t)}return 0<=t}))}if(g.document&&W){var st=Z();rt=st||(parseInt(Q,10)||void 0)}else rt=void 0;var at=rt,ut=function(){if(!g.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{g.addEventListener("test",v,e),g.removeEventListener("test",v,e)}catch(t){}return t}();function ct(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}function ht(t,e){if(ct.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if($){t:{try{G(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:lt[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&ht.Z.h.call(this)}}ct.prototype.h=function(){this.defaultPrevented=!0},D(ht,ct);var lt={2:"touch",3:"pen",4:"mouse"};ht.prototype.h=function(){ht.Z.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var ft="closure_listenable_"+(1e6*Math.random()|0),dt=0;function pt(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ia=i,this.key=++dt,this.ca=this.fa=!1}function yt(t){t.ca=!0,t.listener=null,t.proxy=null,t.src=null,t.ia=null}function gt(t){this.src=t,this.g={},this.h=0}function vt(t,e){var n=e.type;if(n in t.g){var r,i=t.g[n],o=k(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(yt(e),0==t.g[n].length&&(delete t.g[n],t.h--))}}function mt(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.ca&&o.listener==e&&o.capture==!!n&&o.ia==r)return i}return-1}gt.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.g[o])||(t=this.g[o]=[],this.h++);var s=mt(t,e,r,i);return-1<s?(e=t[s],n||(e.fa=!1)):((e=new pt(e,this.src,o,!!r,i)).fa=n,t.push(e)),e};var wt="closure_lm_"+(1e6*Math.random()|0),bt={};function Tt(t,e,n,r,i){if(r&&r.once)return Et(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)Tt(t,e[o],n,r,i);return null}return n=Ct(n),t&&t[ft]?t.N(e,n,w(r)?!!r.capture:!!r,i):It(t,e,n,!1,r,i)}function It(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=w(i)?!!i.capture:!!i,a=At(t);if(a||(t[wt]=a=new gt(t)),(n=a.add(e,n,r,s,o)).proxy)return n;if(r=function(){function t(n){return e.call(t.src,t.listener,n)}var e=Nt;return t}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)ut||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Dt(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Et(t,e,n,r,i){if(Array.isArray(e)){for(var o=0;o<e.length;o++)Et(t,e[o],n,r,i);return null}return n=Ct(n),t&&t[ft]?t.O(e,n,w(r)?!!r.capture:!!r,i):It(t,e,n,!0,r,i)}function _t(t,e,n,r,i){if(Array.isArray(e))for(var o=0;o<e.length;o++)_t(t,e[o],n,r,i);else r=w(r)?!!r.capture:!!r,n=Ct(n),t&&t[ft]?(t=t.i,(e=String(e).toString())in t.g&&(-1<(n=mt(o=t.g[e],n,r,i))&&(yt(o[n]),Array.prototype.splice.call(o,n,1),0==o.length&&(delete t.g[e],t.h--)))):t&&(t=At(t))&&(e=t.g[e.toString()],t=-1,e&&(t=mt(e,n,r,i)),(n=-1<t?e[t]:null)&&St(n))}function St(t){if("number"!=typeof t&&t&&!t.ca){var e=t.src;if(e&&e[ft])vt(e.i,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Dt(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=At(e))?(vt(n,t),0==n.h&&(n.src=null,e[wt]=null)):yt(t)}}}function Dt(t){return t in bt?bt[t]:bt[t]="on"+t}function Nt(t,e){if(t.ca)t=!0;else{e=new ht(e,this);var n=t.listener,r=t.ia||t.src;t.fa&&St(t),t=n.call(r,e)}return t}function At(t){return(t=t[wt])instanceof gt?t:null}var kt="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ct(t){return"function"==typeof t?t:(t[kt]||(t[kt]=function(e){return t.handleEvent(e)}),t[kt])}function xt(){N.call(this),this.i=new gt(this),this.P=this,this.I=null}function Rt(t,e){var n,r=t.I;if(r)for(n=[];r;r=r.I)n.push(r);if(t=t.P,r=e.type||e,"string"==typeof e)e=new ct(e,t);else if(e instanceof ct)e.target=e.target||t;else{var i=e;K(e=new ct(r,t),i)}if(i=!0,n)for(var o=n.length-1;0<=o;o--){var s=e.g=n[o];i=Ot(s,r,!0,e)&&i}if(i=Ot(s=e.g=t,r,!0,e)&&i,i=Ot(s,r,!1,e)&&i,n)for(o=0;o<n.length;o++)i=Ot(s=e.g=n[o],r,!1,e)&&i}function Ot(t,e,n,r){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s=e[o];if(s&&!s.ca&&s.capture==n){var a=s.listener,u=s.ia||s.src;s.fa&&vt(t.i,s),i=!1!==a.call(u,r)&&i}}return i&&!r.defaultPrevented}D(xt,N),xt.prototype[ft]=!0,xt.prototype.removeEventListener=function(t,e,n,r){_t(this,t,e,n,r)},xt.prototype.M=function(){if(xt.Z.M.call(this),this.i){var t,e=this.i;for(t in e.g){for(var n=e.g[t],r=0;r<n.length;r++)yt(n[r]);delete e.g[t],e.h--}}this.I=null},xt.prototype.N=function(t,e,n,r){return this.i.add(String(t),e,!1,n,r)},xt.prototype.O=function(t,e,n,r){return this.i.add(String(t),e,!0,n,r)};var Pt=g.JSON.stringify;function Lt(){var t=Kt,e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var Ft,Mt=function(){function t(){this.h=this.g=null}return t.prototype.add=function(t,e){var n=Vt.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n},t}(),Vt=new(function(){function t(t,e){this.i=t,this.j=e,this.h=0,this.g=null}return t.prototype.get=function(){var t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t},t}())((function(){return new qt}),(function(t){return t.reset()})),qt=function(){function t(){this.next=this.g=this.h=null}return t.prototype.set=function(t,e){this.h=t,this.g=e,this.next=null},t.prototype.reset=function(){this.next=this.g=this.h=null},t}();function Ut(t){g.setTimeout((function(){throw t}),0)}function jt(t,e){Ft||function(){var t=g.Promise.resolve(void 0);Ft=function(){t.then(Gt)}}(),Bt||(Ft(),Bt=!0),Kt.add(t,e)}var Bt=!1,Kt=new Mt;function Gt(){for(var t;t=Lt();){try{t.h.call(t.g)}catch(t){Ut(t)}var e=Vt;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}Bt=!1}function Qt(t,e){xt.call(this),this.h=t||1,this.g=e||g,this.j=_(this.kb,this),this.l=Date.now()}function zt(t){t.da=!1,t.S&&(t.g.clearTimeout(t.S),t.S=null)}function Ht(t,e,n){if("function"==typeof t)n&&(t=_(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=_(t.handleEvent,t)}return 2147483647<Number(e)?-1:g.setTimeout(t,e||0)}function Wt(t){t.g=Ht((function(){t.g=null,t.i&&(t.i=!1,Wt(t))}),t.j);var e=t.h;t.h=null,t.m.apply(null,e)}D(Qt,xt),(d=Qt.prototype).da=!1,d.S=null,d.kb=function(){if(this.da){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-t):(this.S&&(this.g.clearTimeout(this.S),this.S=null),Rt(this,"tick"),this.da&&(zt(this),this.start()))}},d.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},d.M=function(){Qt.Z.M.call(this),zt(this),delete this.g};var Yt=function(t){function e(e,n){var r=t.call(this)||this;return r.m=e,r.j=n,r.h=null,r.i=!1,r.g=null,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}l(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),e.prototype.l=function(t){this.h=arguments,this.g?this.i=!0:Wt(this)},e.prototype.M=function(){t.prototype.M.call(this),this.g&&(g.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)},e}(N);function Xt(t){N.call(this),this.h=t,this.g={}}D(Xt,N);var $t=[];function Jt(t,e,n,r){Array.isArray(n)||(n&&($t[0]=n.toString()),n=$t);for(var i=0;i<n.length;i++){var o=Tt(e,n[i],r||t.handleEvent,!1,t.h||t);if(!o)break;t.g[o.key]=o}}function Zt(t){U(t.g,(function(t,e){this.g.hasOwnProperty(e)&&St(t)}),t),t.g={}}function te(){this.g=!0}function ee(t,e,n,r){t.info((function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var o=i[0];if("noop"!=o&&"stop"!=o&&"close"!=o)for(var s=1;s<i.length;s++)i[s]=""}}}return Pt(n)}catch(t){return e}}(t,n)+(r?" "+r:"")}))}Xt.prototype.M=function(){Xt.Z.M.call(this),Zt(this)},Xt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},te.prototype.Aa=function(){this.g=!1},te.prototype.info=function(){};var ne={},re=null;function ie(){return re=re||new xt}function oe(t){ct.call(this,ne.Ma,t)}function se(t){var e=ie();Rt(e,new oe(e,t))}function ae(t,e){ct.call(this,ne.STAT_EVENT,t),this.stat=e}function ue(t){var e=ie();Rt(e,new ae(e,t))}function ce(t,e){ct.call(this,ne.Na,t),this.size=e}function he(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return g.setTimeout((function(){t()}),e)}ne.Ma="serverreachability",D(oe,ct),ne.STAT_EVENT="statevent",D(ae,ct),ne.Na="timingevent",D(ce,ct);var le={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},fe={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function de(){}function pe(t){return t.h||(t.h=t.i())}function ye(){}de.prototype.h=null;var ge,ve={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function me(){ct.call(this,"d")}function we(){ct.call(this,"c")}function be(){}function Te(t,e,n,r){this.l=t,this.j=e,this.m=n,this.X=r||1,this.V=new Xt(this),this.P=Ee,t=X?125:void 0,this.W=new Qt(t),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new Ie}function Ie(){this.i=null,this.g="",this.h=!1}D(me,ct),D(we,ct),D(be,de),be.prototype.g=function(){return new XMLHttpRequest},be.prototype.i=function(){return{}},ge=new be;var Ee=45e3,_e={},Se={};function De(t,e,n){t.K=1,t.v=Ye(Ke(e)),t.s=n,t.U=!0,Ne(t,null)}function Ne(t,e){t.F=Date.now(),xe(t),t.A=Ke(t.v);var n=t.A,r=t.X;Array.isArray(r)||(r=[String(r)]),cn(n.h,"t",r),t.C=0,n=t.l.H,t.h=new Ie,t.g=hr(t.l,n?e:null,!t.s),0<t.O&&(t.L=new Yt(_(t.Ia,t,t.g),t.O)),Jt(t.V,t.g,"readystatechange",t.gb),e=t.H?j(t.H):{},t.s?(t.u||(t.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ea(t.A,t.u,t.s,e)):(t.u="GET",t.g.ea(t.A,t.u,null,e)),se(1),function(t,e,n,r,i,o){t.info((function(){if(t.g)if(o)for(var s="",a=o.split("&"),u=0;u<a.length;u++){var c=a[u].split("=");if(1<c.length){var h=c[0];c=c[1];var l=h.split("_");s=2<=l.length&&"type"==l[1]?s+(h+"=")+c+"&":s+(h+"=redacted&")}}else s=null;else s=o;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+n+"\n"+s}))}(t.j,t.u,t.A,t.m,t.X,t.s)}function Ae(t){return!!t.g&&("GET"==t.u&&2!=t.K&&t.l.Ba)}function ke(t,e,n){for(var r,i=!0;!t.I&&t.C<n.length;){if((r=Ce(t,n))==Se){4==e&&(t.o=4,ue(14),i=!1),ee(t.j,t.m,null,"[Incomplete Response]");break}if(r==_e){t.o=4,ue(15),ee(t.j,t.m,n,"[Invalid Chunk]"),i=!1;break}ee(t.j,t.m,r,null),Fe(t,r)}Ae(t)&&r!=Se&&r!=_e&&(t.h.g="",t.C=0),4!=e||0!=n.length||t.h.h||(t.o=1,ue(16),i=!1),t.i=t.i&&i,i?0<n.length&&!t.aa&&(t.aa=!0,(e=t.l).g==t&&e.$&&!e.L&&(e.h.info("Great, no buffering proxy detected. Bytes received: "+n.length),nr(e),e.L=!0,ue(11))):(ee(t.j,t.m,n,"[Invalid Chunked Response]"),Le(t),Pe(t))}function Ce(t,e){var n=t.C,r=e.indexOf("\n",n);return-1==r?Se:(n=Number(e.substring(n,r)),isNaN(n)?_e:(r+=1)+n>e.length?Se:(e=e.substr(r,n),t.C=r+n,e))}function xe(t){t.Y=Date.now()+t.P,Re(t,t.P)}function Re(t,e){if(null!=t.B)throw Error("WatchDog timer not null");t.B=he(_(t.eb,t),e)}function Oe(t){t.B&&(g.clearTimeout(t.B),t.B=null)}function Pe(t){0==t.l.G||t.I||or(t.l,t)}function Le(t){Oe(t);var e=t.L;e&&"function"==typeof e.na&&e.na(),t.L=null,zt(t.W),Zt(t.V),t.g&&(e=t.g,t.g=null,e.abort(),e.na())}function Fe(t,e){try{var n=t.l;if(0!=n.G&&(n.g==t||gn(n.i,t)))if(n.I=t.N,!t.J&&gn(n.i,t)&&3==n.G){try{var r=n.Ca.g.parse(e)}catch(o){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){t:if(!n.u){if(n.g){if(!(n.g.F+3e3<t.F))break t;ir(n),Hn(n)}er(n),ue(18)}}else n.ta=i[1],0<n.ta-n.U&&37500>i[2]&&n.N&&0==n.A&&!n.v&&(n.v=he(_(n.ab,n),6e3));if(1>=yn(n.i)&&n.ka){try{n.ka()}catch(o){}n.ka=void 0}}else ar(n,11)}else if((t.J||n.g==t)&&ir(n),!O(e))for(i=n.Ca.g.parse(e),e=0;e<i.length;e++){var o=i[e];if(n.U=o[0],o=o[1],2==n.G)if("c"==o[0]){n.J=o[1],n.la=o[2];var s=o[3];null!=s&&(n.ma=s,n.h.info("VER="+n.ma));var a=o[4];null!=a&&(n.za=a,n.h.info("SVER="+n.za));var u=o[5];null!=u&&"number"==typeof u&&0<u&&(r=1.5*u,n.K=r,n.h.info("backChannelRequestTimeoutMs_="+r)),r=n;var c=t.g;if(c){var h=c.g?c.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(h){var l=r.i;!l.g&&(F(h,"spdy")||F(h,"quic")||F(h,"h2"))&&(l.j=l.l,l.g=new Set,l.h&&(vn(l,l.h),l.h=null))}if(r.D){var f=c.g?c.g.getResponseHeader("X-HTTP-Session-Id"):null;f&&(r.sa=f,We(r.F,r.D,f))}}n.G=3,n.j&&n.j.xa(),n.$&&(n.O=Date.now()-t.F,n.h.info("Handshake RTT: "+n.O+"ms"));var d=t;if((r=n).oa=cr(r,r.H?r.la:null,r.W),d.J){mn(r.i,d);var p=d,y=r.K;y&&p.setTimeout(y),p.B&&(Oe(p),xe(p)),r.g=d}else tr(r);0<n.l.length&&Xn(n)}else"stop"!=o[0]&&"close"!=o[0]||ar(n,7);else 3==n.G&&("stop"==o[0]||"close"==o[0]?"stop"==o[0]?ar(n,7):zn(n):"noop"!=o[0]&&n.j&&n.j.wa(o),n.A=0)}se(4)}catch(o){}}function Me(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(m(t)||"string"==typeof t)C(t,e,void 0);else{if(t.T&&"function"==typeof t.T)var n=t.T();else if(t.R&&"function"==typeof t.R)n=void 0;else if(m(t)||"string"==typeof t){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;r=function(t){if(t.R&&"function"==typeof t.R)return t.R();if("string"==typeof t)return t.split("");if(m(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t),i=r.length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function Ve(t,e){this.h={},this.g=[],this.i=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Ve)for(n=t.T(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function qe(t){if(t.i!=t.g.length){for(var e=0,n=0;e<t.g.length;){var r=t.g[e];Ue(t.h,r)&&(t.g[n++]=r),e++}t.g.length=n}if(t.i!=t.g.length){var i={};for(n=e=0;e<t.g.length;)Ue(i,r=t.g[e])||(t.g[n++]=r,i[r]=1),e++;t.g.length=n}}function Ue(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(d=Te.prototype).setTimeout=function(t){this.P=t},d.gb=function(t){t=t.target;var e=this.L;e&&3==jn(t)?e.l():this.Ia(t)},d.Ia=function(t){try{if(t==this.g)t:{var e=jn(this.g),n=this.g.Da(),r=this.g.ba();if(!(3>e)&&(3!=e||X||this.g&&(this.h.h||this.g.ga()||Bn(this.g)))){this.I||4!=e||7==n||se(8==n||0>=r?3:2),Oe(this);var i=this.g.ba();this.N=i;e:if(Ae(this)){var o=Bn(this.g);t="";var s=o.length,a=4==jn(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Le(this),Pe(this);var u="";break e}this.h.i=new g.TextDecoder}for(n=0;n<s;n++)this.h.h=!0,t+=this.h.i.decode(o[n],{stream:a&&n==s-1});o.splice(0,s),this.h.g+=t,this.C=0,u=this.h.g}else u=this.g.ga();if(this.i=200==i,function(t,e,n,r,i,o,s){t.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+n+"\n"+o+" "+s}))}(this.j,this.u,this.A,this.m,this.X,e,i),this.i){if(this.$&&!this.J){e:{if(this.g){var c,h=this.g;if((c=h.g?h.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!O(c)){var l=c;break e}}l=null}if(!(i=l)){this.i=!1,this.o=3,ue(12),Le(this),Pe(this);break t}ee(this.j,this.m,i,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,Fe(this,i)}this.U?(ke(this,e,u),X&&this.i&&3==e&&(Jt(this.V,this.W,"tick",this.fb),this.W.start())):(ee(this.j,this.m,u,null),Fe(this,u)),4==e&&Le(this),this.i&&!this.I&&(4==e?or(this.l,this):(this.i=!1,xe(this)))}else 400==i&&0<u.indexOf("Unknown SID")?(this.o=3,ue(12)):(this.o=0,ue(13)),Le(this),Pe(this)}}}catch(e){}},d.fb=function(){if(this.g){var t=jn(this.g),e=this.g.ga();this.C<e.length&&(Oe(this),ke(this,t,e),this.i&&4!=t&&xe(this))}},d.cancel=function(){this.I=!0,Le(this)},d.eb=function(){this.B=null;var t=Date.now();0<=t-this.Y?(function(t,e){t.info((function(){return"TIMEOUT: "+e}))}(this.j,this.A),2!=this.K&&(se(3),ue(17)),Le(this),this.o=2,Pe(this)):Re(this,this.Y-t)},(d=Ve.prototype).R=function(){qe(this);for(var t=[],e=0;e<this.g.length;e++)t.push(this.h[this.g[e]]);return t},d.T=function(){return qe(this),this.g.concat()},d.get=function(t,e){return Ue(this.h,t)?this.h[t]:e},d.set=function(t,e){Ue(this.h,t)||(this.i++,this.g.push(t)),this.h[t]=e},d.forEach=function(t,e){for(var n=this.T(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var je=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Be(t,e){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,t instanceof Be){this.g=void 0!==e?e:t.g,Ge(this,t.j),this.s=t.s,Qe(this,t.i),ze(this,t.m),this.l=t.l,e=t.h;var n=new on;n.i=e.i,e.g&&(n.g=new Ve(e.g),n.h=e.h),He(this,n),this.o=t.o}else t&&(n=String(t).match(je))?(this.g=!!e,Ge(this,n[1]||"",!0),this.s=Xe(n[2]||""),Qe(this,n[3]||"",!0),ze(this,n[4]),this.l=Xe(n[5]||"",!0),He(this,n[6]||"",!0),this.o=Xe(n[7]||"")):(this.g=!!e,this.h=new on(null,this.g))}function Ke(t){return new Be(t)}function Ge(t,e,n){t.j=n?Xe(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function Qe(t,e,n){t.i=n?Xe(e,!0):e}function ze(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function He(t,e,n){e instanceof on?(t.h=e,function(t,e){e&&!t.j&&(sn(t),t.i=null,t.g.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(an(this,e),cn(this,n,t))}),t)),t.j=e}(t.h,t.g)):(n||(e=$e(e,nn)),t.h=new on(e,t.g))}function We(t,e,n){t.h.set(e,n)}function Ye(t){return We(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function Xe(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function $e(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,Je),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function Je(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Be.prototype.toString=function(){var t=[],e=this.j;e&&t.push($e(e,Ze,!0),":");var n=this.i;return(n||"file"==e)&&(t.push("//"),(e=this.s)&&t.push($e(e,Ze,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&t.push(":",String(n))),(n=this.l)&&(this.i&&"/"!=n.charAt(0)&&t.push("/"),t.push($e(n,"/"==n.charAt(0)?en:tn,!0))),(n=this.h.toString())&&t.push("?",n),(n=this.o)&&t.push("#",$e(n,rn)),t.join("")};var Ze=/[#\/\?@]/g,tn=/[#\?:]/g,en=/[#\?]/g,nn=/[#\?@]/g,rn=/#/g;function on(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function sn(t){t.g||(t.g=new Ve,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.i,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function an(t,e){sn(t),e=hn(t,e),Ue(t.g.h,e)&&(t.i=null,t.h-=t.g.get(e).length,Ue((t=t.g).h,e)&&(delete t.h[e],t.i--,t.g.length>2*t.i&&qe(t)))}function un(t,e){return sn(t),e=hn(t,e),Ue(t.g.h,e)}function cn(t,e,n){an(t,e),0<n.length&&(t.i=null,t.g.set(hn(t,e),R(n)),t.h+=n.length)}function hn(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}(d=on.prototype).add=function(t,e){sn(this),this.i=null,t=hn(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},d.forEach=function(t,e){sn(this),this.g.forEach((function(n,r){C(n,(function(n){t.call(e,n,r,this)}),this)}),this)},d.T=function(){sn(this);for(var t=this.g.R(),e=this.g.T(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},d.R=function(t){sn(this);var e=[];if("string"==typeof t)un(this,t)&&(e=x(e,this.g.get(hn(this,t))));else{t=this.g.R();for(var n=0;n<t.length;n++)e=x(e,t[n])}return e},d.set=function(t,e){return sn(this),this.i=null,un(this,t=hn(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},d.get=function(t,e){return t&&0<(t=this.R(t)).length?String(t[0]):e},d.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var t=[],e=this.g.T(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.R(r);for(var o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}}return this.i=t.join("&")};var ln=function(t,e){this.h=t,this.g=e};function fn(t){this.l=t||dn,g.PerformanceNavigationTiming?t=0<(t=g.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):t=!!(g.g&&g.g.Ea&&g.g.Ea()&&g.g.Ea().Zb),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var dn=10;function pn(t){return!!t.h||!!t.g&&t.g.size>=t.j}function yn(t){return t.h?1:t.g?t.g.size:0}function gn(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function vn(t,e){t.g?t.g.add(e):t.h=e}function mn(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function wn(t){var e,n;if(null!=t.h)return t.i.concat(t.h.D);if(null!=t.g&&0!==t.g.size){var r=t.i;try{for(var i=f(t.g.values()),o=i.next();!o.done;o=i.next()){var s=o.value;r=r.concat(s.D)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}return R(t.i)}function bn(){}function Tn(){this.g=new bn}function In(t,e,n){var r=n||"";try{Me(t,(function(t,n){var i=t;w(t)&&(i=Pt(t)),e.push(r+n+"="+encodeURIComponent(i))}))}catch(t){throw e.push(r+"type="+encodeURIComponent("_badmap")),t}}function En(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}function _n(t){this.l=t.$b||null,this.j=t.ib||!1}function Sn(t,e){xt.call(this),this.D=t,this.u=e,this.m=void 0,this.readyState=Dn,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}fn.prototype.cancel=function(){var t,e;if(this.i=wn(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){try{for(var n=f(this.g.values()),r=n.next();!r.done;r=n.next()){r.value.cancel()}}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.g.clear()}},bn.prototype.stringify=function(t){return g.JSON.stringify(t,void 0)},bn.prototype.parse=function(t){return g.JSON.parse(t,void 0)},D(_n,de),_n.prototype.g=function(){return new Sn(this.l,this.j)},_n.prototype.i=function(t){return function(){return t}}({}),D(Sn,xt);var Dn=0;function Nn(t){t.j.read().then(t.Sa.bind(t)).catch(t.ha.bind(t))}function An(t){t.readyState=4,t.l=null,t.j=null,t.A=null,kn(t)}function kn(t){t.onreadystatechange&&t.onreadystatechange.call(t)}(d=Sn.prototype).open=function(t,e){if(this.readyState!=Dn)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,kn(this)},d.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;var e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.D||g).fetch(new Request(this.B,e)).then(this.Va.bind(this),this.ha.bind(this))},d.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,An(this)),this.readyState=Dn},d.Va=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,kn(this)),this.g&&(this.readyState=3,kn(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==g.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Nn(this)}else t.text().then(this.Ua.bind(this),this.ha.bind(this))},d.Sa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?An(this):kn(this),3==this.readyState&&Nn(this)}},d.Ua=function(t){this.g&&(this.response=this.responseText=t,An(this))},d.Ta=function(t){this.g&&(this.response=t,An(this))},d.ha=function(){this.g&&An(this)},d.setRequestHeader=function(t,e){this.v.append(t,e)},d.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},d.getAllResponseHeaders=function(){if(!this.h)return"";for(var t=[],e=this.h.entries(),n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(Sn.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}});var Cn=g.JSON.parse;function xn(t){xt.call(this),this.headers=new Ve,this.u=t||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=Rn,this.K=this.L=!1}D(xn,xt);var Rn="",On=/^https?$/i,Pn=["POST","PUT"];function Ln(t){return"content-type"==t.toLowerCase()}function Fn(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,Mn(t),qn(t)}function Mn(t){t.D||(t.D=!0,Rt(t,"complete"),Rt(t,"error"))}function Vn(t){if(t.h&&void 0!==y&&(!t.C[1]||4!=jn(t)||2!=t.ba()))if(t.v&&4==jn(t))Ht(t.Fa,0,t);else if(Rt(t,"readystatechange"),4==jn(t)){t.h=!1;try{var e,n=t.ba();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.H).match(je)[1]||null;if(!o&&g.self&&g.self.location){var s=g.self.location.protocol;o=s.substr(0,s.length-1)}i=!On.test(o?o.toLowerCase():"")}e=i}if(e)Rt(t,"complete"),Rt(t,"success");else{t.m=6;try{var a=2<jn(t)?t.g.statusText:""}catch(t){a=""}t.j=a+" ["+t.ba()+"]",Mn(t)}}finally{qn(t)}}}function qn(t,e){if(t.g){Un(t);var n=t.g,r=t.C[0]?v:null;t.g=null,t.C=null,e||Rt(t,"ready");try{n.onreadystatechange=r}catch(t){}}}function Un(t){t.g&&t.K&&(t.g.ontimeout=null),t.A&&(g.clearTimeout(t.A),t.A=null)}function jn(t){return t.g?t.g.readyState:0}function Bn(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.J){case Rn:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(t){return null}}function Kn(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=function(t){var e="";return U(t,(function(t,n){e+=n,e+=":",e+=t,e+="\r\n"})),e}(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):We(t,e,n))}function Gn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Qn(t){this.za=0,this.l=[],this.h=new te,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=Gn("failFast",!1,t),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=Gn("baseRetryDelayMs",5e3,t),this.$a=Gn("retryDelaySeedMs",1e4,t),this.Ya=Gn("forwardChannelMaxRetries",2,t),this.ra=Gn("forwardChannelRequestTimeoutMs",2e4,t),this.qa=t&&t.xmlHttpFactory||void 0,this.Ba=t&&t.Yb||!1,this.K=void 0,this.H=t&&t.supportsCrossDomainXhr||!1,this.J="",this.i=new fn(t&&t.concurrentRequestLimit),this.Ca=new Tn,this.ja=t&&t.fastHandshake||!1,this.Ra=t&&t.Wb||!1,t&&t.Aa&&this.h.Aa(),t&&t.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&t&&t.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!t||!1!==t.Xb}function zn(t){if(Wn(t),3==t.G){var e=t.V++,n=Ke(t.F);We(n,"SID",t.J),We(n,"RID",e),We(n,"TYPE","terminate"),Jn(t,n),(e=new Te(t,t.h,e,void 0)).K=2,e.v=Ye(Ke(n)),n=!1,g.navigator&&g.navigator.sendBeacon&&(n=g.navigator.sendBeacon(e.v.toString(),"")),!n&&g.Image&&((new Image).src=e.v,n=!0),n||(e.g=hr(e.l,null),e.g.ea(e.v)),e.F=Date.now(),xe(e)}ur(t)}function Hn(t){t.g&&(nr(t),t.g.cancel(),t.g=null)}function Wn(t){Hn(t),t.u&&(g.clearTimeout(t.u),t.u=null),ir(t),t.i.cancel(),t.m&&("number"==typeof t.m&&g.clearTimeout(t.m),t.m=null)}function Yn(t,e){t.l.push(new ln(t.Za++,e)),3==t.G&&Xn(t)}function Xn(t){pn(t.i)||t.m||(t.m=!0,jt(t.Ha,t),t.C=0)}function $n(t,e){var n;n=e?e.m:t.V++;var r=Ke(t.F);We(r,"SID",t.J),We(r,"RID",n),We(r,"AID",t.U),Jn(t,r),t.o&&t.s&&Kn(r,t.o,t.s),n=new Te(t,t.h,n,t.C+1),null===t.o&&(n.H=t.s),e&&(t.l=e.D.concat(t.l)),e=Zn(t,n,1e3),n.setTimeout(Math.round(.5*t.ra)+Math.round(.5*t.ra*Math.random())),vn(t.i,n),De(n,r,e)}function Jn(t,e){t.j&&Me({},(function(t,n){We(e,n,t)}))}function Zn(t,e,n){n=Math.min(t.l.length,n);var r=t.j?_(t.j.Oa,t.j,t):null;t:for(var i=t.l,o=-1;;){var s=["count="+n];-1==o?0<n?(o=i[0].h,s.push("ofs="+o)):o=0:s.push("ofs="+o);for(var a=!0,u=0;u<n;u++){var c=i[u].h,h=i[u].g;if(0>(c-=o))o=Math.max(0,i[u].h-100),a=!1;else try{In(h,s,"req"+c+"_")}catch(t){r&&r(h)}}if(a){r=s.join("&");break t}}return t=t.l.splice(0,n),e.D=t,r}function tr(t){t.g||t.u||(t.Y=1,jt(t.Ga,t),t.A=0)}function er(t){return!(t.g||t.u||3<=t.A)&&(t.Y++,t.u=he(_(t.Ga,t),sr(t,t.A)),t.A++,!0)}function nr(t){null!=t.B&&(g.clearTimeout(t.B),t.B=null)}function rr(t){t.g=new Te(t,t.h,"rpc",t.Y),null===t.o&&(t.g.H=t.s),t.g.O=0;var e=Ke(t.oa);We(e,"RID","rpc"),We(e,"SID",t.J),We(e,"CI",t.N?"0":"1"),We(e,"AID",t.U),Jn(t,e),We(e,"TYPE","xmlhttp"),t.o&&t.s&&Kn(e,t.o,t.s),t.K&&t.g.setTimeout(t.K);var n=t.g;t=t.la,n.K=1,n.v=Ye(Ke(e)),n.s=null,n.U=!0,Ne(n,t)}function ir(t){null!=t.v&&(g.clearTimeout(t.v),t.v=null)}function or(t,e){var n=null;if(t.g==e){ir(t),nr(t),t.g=null;var r=2}else{if(!gn(t.i,e))return;n=e.D,mn(t.i,e),r=1}if(t.I=e.N,0!=t.G)if(e.i)if(1==r){n=e.s?e.s.length:0,e=Date.now()-e.F;var i=t.C;Rt(r=ie(),new ce(r,n,e,i)),Xn(t)}else tr(t);else if(3==(i=e.o)||0==i&&0<t.I||!(1==r&&function(t,e){return!(yn(t.i)>=t.i.j-(t.m?1:0)||(t.m?(t.l=e.D.concat(t.l),0):1==t.G||2==t.G||t.C>=(t.Xa?0:t.Ya)||(t.m=he(_(t.Ha,t,e),sr(t,t.C)),t.C++,0)))}(t,e)||2==r&&er(t)))switch(n&&0<n.length&&(e=t.i,e.i=e.i.concat(n)),i){case 1:ar(t,5);break;case 4:ar(t,10);break;case 3:ar(t,6);break;default:ar(t,2)}}function sr(t,e){var n=t.Pa+Math.floor(Math.random()*t.$a);return t.j||(n*=2),n*e}function ar(t,e){if(t.h.info("Error code "+e),2==e){var n=null;t.j&&(n=null);var r=_(t.jb,t);n||(n=new Be("//www.google.com/images/cleardot.gif"),g.location&&"http"==g.location.protocol||Ge(n,"https"),Ye(n)),function(t,e){var n=new te;if(g.Image){var r=new Image;r.onload=S(En,n,r,"TestLoadImage: loaded",!0,e),r.onerror=S(En,n,r,"TestLoadImage: error",!1,e),r.onabort=S(En,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=S(En,n,r,"TestLoadImage: timeout",!1,e),g.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=t}else e(!1)}(n.toString(),r)}else ue(2);t.G=0,t.j&&t.j.va(e),ur(t),Wn(t)}function ur(t){t.G=0,t.I=-1,t.j&&(0==wn(t.i).length&&0==t.l.length||(t.i.i.length=0,R(t.l),t.l.length=0),t.j.ua())}function cr(t,e,n){var r=function(t){return t instanceof Be?Ke(t):new Be(t,void 0)}(n);if(""!=r.i)e&&Qe(r,e+"."+r.i),ze(r,r.m);else{var i=g.location;r=function(t,e,n,r){var i=new Be(null,void 0);return t&&Ge(i,t),e&&Qe(i,e),n&&ze(i,n),r&&(i.l=r),i}(i.protocol,e?e+"."+i.hostname:i.hostname,+i.port,n)}return t.aa&&U(t.aa,(function(t,e){We(r,e,t)})),e=t.D,n=t.sa,e&&n&&We(r,e,n),We(r,"VER",t.ma),Jn(t,r),r}function hr(t,e,n){if(e&&!t.H)throw Error("Can't create secondary domain capable XhrIo object.");return(e=n&&t.Ba&&!t.qa?new xn(new _n({ib:!0})):new xn(t.qa)).L=t.H,e}function lr(){}function fr(){if(W&&!(10<=Number(at)))throw Error("Environmental error: no available transport.")}function dr(t,e){xt.call(this),this.g=new Qn(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(t?t["X-WebChannel-Client-Profile"]=e.ya:t={"X-WebChannel-Client-Profile":e.ya}),this.g.P=t,(t=e&&e.httpHeadersOverwriteParam)&&!O(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!O(e)&&(this.g.D=e,null!==(t=this.h)&&e in t&&(e in(t=this.h)&&delete t[e])),this.j=new gr(this)}function pr(t){me.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function yr(){we.call(this),this.status=1}function gr(t){this.g=t}(d=xn.prototype).ea=function(t,e,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+t);e=e?e.toUpperCase():"GET",this.H=t,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():ge.g(),this.C=this.u?pe(this.u):pe(ge),this.g.onreadystatechange=_(this.Fa,this);try{this.F=!0,this.g.open(e,String(t),!0),this.F=!1}catch(t){return void Fn(this,t)}t=n||"";var i=new Ve(this.headers);r&&Me(r,(function(t,e){i.set(e,t)})),r=function(t){t:{for(var e=Ln,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return 0>e?null:"string"==typeof t?t.charAt(e):t[e]}(i.T()),n=g.FormData&&t instanceof g.FormData,!(0<=k(Pn,e))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach((function(t,e){this.g.setRequestHeader(e,t)}),this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{Un(this),0<this.B&&((this.K=function(t){return W&&ot()&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=_(this.pa,this)):this.A=Ht(this.pa,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(t){Fn(this,t)}},d.pa=function(){void 0!==y&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Rt(this,"timeout"),this.abort(8))},d.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,Rt(this,"complete"),Rt(this,"abort"),qn(this))},d.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),qn(this,!0)),xn.Z.M.call(this)},d.Fa=function(){this.s||(this.F||this.v||this.l?Vn(this):this.cb())},d.cb=function(){Vn(this)},d.ba=function(){try{return 2<jn(this)?this.g.status:-1}catch(t){return-1}},d.ga=function(){try{return this.g?this.g.responseText:""}catch(t){return""}},d.Qa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Cn(e)}},d.Da=function(){return this.m},d.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(d=Qn.prototype).ma=8,d.G=1,d.hb=function(t){try{this.h.info("Origin Trials invoked: "+t)}catch(t){}},d.Ha=function(t){if(this.m)if(this.m=null,1==this.G){if(!t){this.V=Math.floor(1e5*Math.random()),t=this.V++;var e=new Te(this,this.h,t,void 0),n=this.s;if(this.P&&(n?K(n=j(n),this.P):n=this.P),null===this.o&&(e.H=n),this.ja)t:{for(var r=0,i=0;i<this.l.length;i++){var o=this.l[i];if(void 0===(o="__data__"in o.g&&"string"==typeof(o=o.g.__data__)?o.length:void 0))break;if(4096<(r+=o)){r=i;break t}if(4096===r||i===this.l.length-1){r=i+1;break t}}r=1e3}else r=1e3;r=Zn(this,e,r),We(i=Ke(this.F),"RID",t),We(i,"CVER",22),this.D&&We(i,"X-HTTP-Session-Id",this.D),Jn(this,i),this.o&&n&&Kn(i,this.o,n),vn(this.i,e),this.Ra&&We(i,"TYPE","init"),this.ja?(We(i,"$req",r),We(i,"SID","null"),e.$=!0,De(e,i,null)):De(e,i,r),this.G=2}}else 3==this.G&&(t?$n(this,t):0==this.l.length||pn(this.i)||$n(this))},d.Ga=function(){if(this.u=null,rr(this),this.$&&!(this.L||null==this.g||0>=this.O)){var t=2*this.O;this.h.info("BP detection timer enabled: "+t),this.B=he(_(this.bb,this),t)}},d.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,ue(10),Hn(this),rr(this))},d.ab=function(){null!=this.v&&(this.v=null,Hn(this),er(this),ue(19))},d.jb=function(t){t?(this.h.info("Successfully pinged google.com"),ue(2)):(this.h.info("Failed to ping google.com"),ue(1))},(d=lr.prototype).xa=function(){},d.wa=function(){},d.va=function(){},d.ua=function(){},d.Oa=function(){},fr.prototype.g=function(t,e){return new dr(t,e)},D(dr,xt),dr.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var t=this.g,e=this.l,n=this.h||void 0;t.Wa&&(t.h.info("Origin Trials enabled."),jt(_(t.hb,t,e))),ue(0),t.W=e,t.aa=n||{},t.N=t.X,t.F=cr(t,null,t.W),Xn(t)},dr.prototype.close=function(){zn(this.g)},dr.prototype.u=function(t){if("string"==typeof t){var e={};e.__data__=t,Yn(this.g,e)}else this.v?((e={}).__data__=Pt(t),Yn(this.g,e)):Yn(this.g,t)},dr.prototype.M=function(){this.g.j=null,delete this.j,zn(this.g),delete this.g,dr.Z.M.call(this)},D(pr,me),D(yr,we),D(gr,lr),gr.prototype.xa=function(){Rt(this.g,"a")},gr.prototype.wa=function(t){Rt(this.g,new pr(t))},gr.prototype.va=function(t){Rt(this.g,new yr(t))},gr.prototype.ua=function(){Rt(this.g,"b")},fr.prototype.createWebChannel=fr.prototype.g,dr.prototype.send=dr.prototype.u,dr.prototype.open=dr.prototype.m,dr.prototype.close=dr.prototype.close,le.NO_ERROR=0,le.TIMEOUT=8,le.HTTP_ERROR=6,fe.COMPLETE="complete",ye.EventType=ve,ve.OPEN="a",ve.CLOSE="b",ve.ERROR="c",ve.MESSAGE="d",xt.prototype.listen=xt.prototype.N,xn.prototype.listenOnce=xn.prototype.O,xn.prototype.getLastError=xn.prototype.La,xn.prototype.getLastErrorCode=xn.prototype.Da,xn.prototype.getStatus=xn.prototype.ba,xn.prototype.getResponseJson=xn.prototype.Qa,xn.prototype.getResponseText=xn.prototype.ga,xn.prototype.send=xn.prototype.ea;var vr=function(){return new fr},mr=function(){return ie()},wr=le,br=fe,Tr=ne,Ir={rb:0,ub:1,vb:2,Ob:3,Tb:4,Qb:5,Rb:6,Pb:7,Nb:8,Sb:9,PROXY:10,NOPROXY:11,Lb:12,Hb:13,Ib:14,Gb:15,Jb:16,Kb:17,nb:18,mb:19,ob:20},Er=_n,_r=ye,Sr=xn,Dr=function(){function t(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.t(t)},this.i=function(t){return e.writeSequenceNumber(t)})}return t.prototype.t=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},t.prototype.next=function(){var t=++this.previousValue;return this.i&&this.i(t),t},t}();Dr.o=-1;var Nr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},Ar=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).code=e,r.message=n,r.name="FirebaseError",r.toString=function(){return r.name+": [code="+r.code+"]: "+r.message},r}return o(e,t),e}(Error),kr=new h.Yd("@firebase/firestore");function Cr(){return kr.logLevel}function xr(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(kr.logLevel<=h.in.DEBUG){var r=e.map(Pr);kr.debug.apply(kr,u(["Firestore (8.10.1): "+t],r))}}function Rr(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(kr.logLevel<=h.in.ERROR){var r=e.map(Pr);kr.error.apply(kr,u(["Firestore (8.10.1): "+t],r))}}function Or(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(kr.logLevel<=h.in.WARN){var r=e.map(Pr);kr.warn.apply(kr,u(["Firestore (8.10.1): "+t],r))}}function Pr(t){if("string"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(e){return t}var e}function Lr(t){void 0===t&&(t="Unexpected state");var e="FIRESTORE (8.10.1) INTERNAL ASSERTION FAILED: "+t;throw Rr(e),new Error(e)}function Fr(t,e){t||Lr()}function Mr(t,e){return t}function Vr(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}var qr=function(){function t(){}return t.u=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=62*Math.floor(256/62),n="";n.length<20;)for(var r=Vr(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%62));return n},t}();function Ur(t,e){return t<e?-1:t>e?1:0}function jr(t,e,n){return t.length===e.length&&t.every((function(t,r){return n(t,e[r])}))}function Br(t){return t+"\0"}var Kr=function(){function t(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new Ar(Nr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new Ar(Nr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Ar(Nr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new Ar(Nr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return t.now=function(){return t.fromMillis(Date.now())},t.fromDate=function(e){return t.fromMillis(e.getTime())},t.fromMillis=function(e){var n=Math.floor(e/1e3);return new t(n,Math.floor(1e6*(e-1e3*n)))},t.prototype.toDate=function(){return new Date(this.toMillis())},t.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},t.prototype._compareTo=function(t){return this.seconds===t.seconds?Ur(this.nanoseconds,t.nanoseconds):Ur(this.seconds,t.seconds)},t.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},t.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},t.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},t.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},t}(),Gr=function(){function t(t){this.timestamp=t}return t.fromTimestamp=function(e){return new t(e)},t.min=function(){return new t(new Kr(0,0))},t.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},t.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},t.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},t.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},t.prototype.toTimestamp=function(){return this.timestamp},t}();function Qr(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function zr(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Hr(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}var Wr=function(){function t(t,e,n){void 0===e?e=0:e>t.length&&Lr(),void 0===n?n=t.length-e:n>t.length-e&&Lr(),this.segments=t,this.offset=e,this.len=n}return Object.defineProperty(t.prototype,"length",{get:function(){return this.len},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return 0===t.comparator(this,e)},t.prototype.child=function(e){var n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach((function(t){n.push(t)})):n.push(e),this.construct(n)},t.prototype.limit=function(){return this.offset+this.length},t.prototype.popFirst=function(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)},t.prototype.popLast=function(){return this.construct(this.segments,this.offset,this.length-1)},t.prototype.firstSegment=function(){return this.segments[this.offset]},t.prototype.lastSegment=function(){return this.get(this.length-1)},t.prototype.get=function(t){return this.segments[this.offset+t]},t.prototype.isEmpty=function(){return 0===this.length},t.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},t.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},t.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(i>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0},t}(),Yr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.prototype.canonicalString=function(){return this.toArray().join("/")},e.prototype.toString=function(){return this.canonicalString()},e.fromString=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var r=[],i=0,o=t;i<o.length;i++){var s=o[i];if(s.indexOf("//")>=0)throw new Ar(Nr.INVALID_ARGUMENT,"Invalid segment ("+s+"). Paths must not contain // in them.");r.push.apply(r,s.split("/").filter((function(t){return t.length>0})))}return new e(r)},e.emptyPath=function(){return new e([])},e}(Wr),Xr=/^[_a-zA-Z][_a-zA-Z0-9]*$/,$r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.isValidIdentifier=function(t){return Xr.test(t)},e.prototype.canonicalString=function(){return this.toArray().map((function(t){return t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),e.isValidIdentifier(t)||(t="`"+t+"`"),t})).join(".")},e.prototype.toString=function(){return this.canonicalString()},e.prototype.isKeyField=function(){return 1===this.length&&"__name__"===this.get(0)},e.keyField=function(){return new e(["__name__"])},e.fromServerFormat=function(t){for(var n=[],r="",i=0,o=function(){if(0===r.length)throw new Ar(Nr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");n.push(r),r=""},s=!1;i<t.length;){var a=t[i];if("\\"===a){if(i+1===t.length)throw new Ar(Nr.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var u=t[i+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new Ar(Nr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=u,i+=2}else"`"===a?(s=!s,i++):"."!==a||s?(r+=a,i++):(o(),i++)}if(o(),s)throw new Ar(Nr.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new e(n)},e.emptyPath=function(){return new e([])},e}(Wr),Jr=function(){function t(t){this.fields=t,t.sort($r.comparator)}return t.prototype.covers=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].isPrefixOf(t))return!0;return!1},t.prototype.isEqual=function(t){return jr(this.fields,t.fields,(function(t,e){return t.isEqual(e)}))},t}(),Zr=function(){function t(t){this.binaryString=t}return t.fromBase64String=function(e){return new t(atob(e))},t.fromUint8Array=function(e){return new t(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(e))},t.prototype.toBase64=function(){return t=this.binaryString,btoa(t);var t},t.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)},t.prototype.approximateByteSize=function(){return 2*this.binaryString.length},t.prototype.compareTo=function(t){return Ur(this.binaryString,t.binaryString)},t.prototype.isEqual=function(t){return this.binaryString===t.binaryString},t}();Zr.EMPTY_BYTE_STRING=new Zr("");var ti=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ei(t){if(Fr(!!t),"string"==typeof t){var e=0,n=ti.exec(t);if(Fr(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:ni(t.seconds),nanos:ni(t.nanos)}}function ni(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function ri(t){return"string"==typeof t?Zr.fromBase64String(t):Zr.fromUint8Array(t)}function ii(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function oi(t){var e=t.mapValue.fields.__previous_value__;return ii(e)?oi(e):e}function si(t){var e=ei(t.mapValue.fields.__local_write_time__.timestampValue);return new Kr(e.seconds,e.nanos)}function ai(t){return null==t}function ui(t){return 0===t&&1/t==-1/0}function ci(t){return"number"==typeof t&&Number.isInteger(t)&&!ui(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}var hi=function(){function t(t){this.path=t}return t.fromPath=function(e){return new t(Yr.fromString(e))},t.fromName=function(e){return new t(Yr.fromString(e).popFirst(5))},t.prototype.hasCollectionId=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},t.prototype.isEqual=function(t){return null!==t&&0===Yr.comparator(this.path,t.path)},t.prototype.toString=function(){return this.path.toString()},t.comparator=function(t,e){return Yr.comparator(t.path,e.path)},t.isDocumentKey=function(t){return t.length%2==0},t.fromSegments=function(e){return new t(new Yr(e.slice()))},t}();function li(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?ii(t)?4:10:Lr()}function fi(t,e){var n=li(t);if(n!==li(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return si(t).isEqual(si(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;var n=ei(t.timestampValue),r=ei(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return ri(t.bytesValue).isEqual(ri(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return ni(t.geoPointValue.latitude)===ni(e.geoPointValue.latitude)&&ni(t.geoPointValue.longitude)===ni(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return ni(t.integerValue)===ni(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){var n=ni(t.doubleValue),r=ni(e.doubleValue);return n===r?ui(n)===ui(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return jr(t.arrayValue.values||[],e.arrayValue.values||[],fi);case 10:return function(t,e){var n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(Qr(n)!==Qr(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!fi(n[i],r[i])))return!1;return!0}(t,e);default:return Lr()}}function di(t,e){return void 0!==(t.values||[]).find((function(t){return fi(t,e)}))}function pi(t,e){var n=li(t),r=li(e);if(n!==r)return Ur(n,r);switch(n){case 0:return 0;case 1:return Ur(t.booleanValue,e.booleanValue);case 2:return function(t,e){var n=ni(t.integerValue||t.doubleValue),r=ni(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return yi(t.timestampValue,e.timestampValue);case 4:return yi(si(t),si(e));case 5:return Ur(t.stringValue,e.stringValue);case 6:return function(t,e){var n=ri(t),r=ri(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=Ur(n[i],r[i]);if(0!==o)return o}return Ur(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){var n=Ur(ni(t.latitude),ni(e.latitude));return 0!==n?n:Ur(ni(t.longitude),ni(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=pi(n[i],r[i]);if(o)return o}return Ur(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var a=Ur(r[s],o[s]);if(0!==a)return a;var u=pi(n[r[s]],i[o[s]]);if(0!==u)return u}return Ur(r.length,o.length)}(t.mapValue,e.mapValue);default:throw Lr()}}function yi(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Ur(t,e);var n=ei(t),r=ei(e),i=Ur(n.seconds,r.seconds);return 0!==i?i:Ur(n.nanos,r.nanos)}function gi(t){return vi(t)}function vi(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){var e=ei(t);return"time("+e.seconds+","+e.nanos+")"}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?ri(t.bytesValue).toBase64():"referenceValue"in t?(n=t.referenceValue,hi.fromName(n).toString()):"geoPointValue"in t?"geo("+(e=t.geoPointValue).latitude+","+e.longitude+")":"arrayValue"in t?function(t){for(var e="[",n=!0,r=0,i=t.values||[];r<i.length;r++)n?n=!1:e+=",",e+=vi(i[r]);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){for(var e="{",n=!0,r=0,i=Object.keys(t.fields||{}).sort();r<i.length;r++){var o=i[r];n?n=!1:e+=",",e+=o+":"+vi(t.fields[o])}return e+"}"}(t.mapValue):Lr();var e,n}function mi(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.canonicalString()}}function wi(t){return!!t&&"integerValue"in t}function bi(t){return!!t&&"arrayValue"in t}function Ti(t){return!!t&&"nullValue"in t}function Ii(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Ei(t){return!!t&&"mapValue"in t}function _i(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){var e={mapValue:{fields:{}}};return zr(t.mapValue.fields,(function(t,n){return e.mapValue.fields[t]=_i(n)})),e}if(t.arrayValue){for(var n={arrayValue:{values:[]}},r=0;r<(t.arrayValue.values||[]).length;++r)n.arrayValue.values[r]=_i(t.arrayValue.values[r]);return n}return Object.assign({},t)}var Si=function(){function t(t){this.value=t}return t.empty=function(){return new t({mapValue:{}})},t.prototype.field=function(t){if(t.isEmpty())return this.value;for(var e=this.value,n=0;n<t.length-1;++n)if(!Ei(e=(e.mapValue.fields||{})[t.get(n)]))return null;return(e=(e.mapValue.fields||{})[t.lastSegment()])||null},t.prototype.set=function(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=_i(e)},t.prototype.setAll=function(t){var e=this,n=$r.emptyPath(),r={},i=[];t.forEach((function(t,o){if(!n.isImmediateParentOf(o)){var s=e.getFieldsMap(n);e.applyChanges(s,r,i),r={},i=[],n=o.popLast()}t?r[o.lastSegment()]=_i(t):i.push(o.lastSegment())}));var o=this.getFieldsMap(n);this.applyChanges(o,r,i)},t.prototype.delete=function(t){var e=this.field(t.popLast());Ei(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]},t.prototype.isEqual=function(t){return fi(this.value,t.value)},t.prototype.getFieldsMap=function(t){var e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(var n=0;n<t.length;++n){var r=e.mapValue.fields[t.get(n)];Ei(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=r),e=r}return e.mapValue.fields},t.prototype.applyChanges=function(t,e,n){zr(e,(function(e,n){return t[e]=n}));for(var r=0,i=n;r<i.length;r++){var o=i[r];delete t[o]}},t.prototype.clone=function(){return new t(_i(this.value))},t}();function Di(t){var e=[];return zr(t.fields,(function(t,n){var r=new $r([t]);if(Ei(n)){var i=Di(n.mapValue).fields;if(0===i.length)e.push(r);else for(var o=0,s=i;o<s.length;o++){var a=s[o];e.push(r.child(a))}}else e.push(r)})),new Jr(e)}var Ni=function(){function t(t,e,n,r,i){this.key=t,this.documentType=e,this.version=n,this.data=r,this.documentState=i}return t.newInvalidDocument=function(e){return new t(e,0,Gr.min(),Si.empty(),0)},t.newFoundDocument=function(e,n,r){return new t(e,1,n,r,0)},t.newNoDocument=function(e,n){return new t(e,2,n,Si.empty(),0)},t.newUnknownDocument=function(e,n){return new t(e,3,n,Si.empty(),2)},t.prototype.convertToFoundDocument=function(t,e){return this.version=t,this.documentType=1,this.data=e,this.documentState=0,this},t.prototype.convertToNoDocument=function(t){return this.version=t,this.documentType=2,this.data=Si.empty(),this.documentState=0,this},t.prototype.convertToUnknownDocument=function(t){return this.version=t,this.documentType=3,this.data=Si.empty(),this.documentState=2,this},t.prototype.setHasCommittedMutations=function(){return this.documentState=2,this},t.prototype.setHasLocalMutations=function(){return this.documentState=1,this},Object.defineProperty(t.prototype,"hasLocalMutations",{get:function(){return 1===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasCommittedMutations",{get:function(){return 2===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!1,configurable:!0}),t.prototype.isValidDocument=function(){return 0!==this.documentType},t.prototype.isFoundDocument=function(){return 1===this.documentType},t.prototype.isNoDocument=function(){return 2===this.documentType},t.prototype.isUnknownDocument=function(){return 3===this.documentType},t.prototype.isEqual=function(e){return e instanceof t&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)},t.prototype.clone=function(){return new t(this.key,this.documentType,this.version,this.data.clone(),this.documentState)},t.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+JSON.stringify(this.data.value)+", {documentType: "+this.documentType+"}), {documentState: "+this.documentState+"})"},t}(),Ai=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.h=null};function ki(t,e,n,r,i,o,s){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),new Ai(t,e,n,r,i,o,s)}function Ci(t){var e=Mr(t);if(null===e.h){var n=e.path.canonicalString();null!==e.collectionGroup&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map((function(t){return function(t){return t.field.canonicalString()+t.op.toString()+gi(t.value)}(t)})).join(","),n+="|ob:",n+=e.orderBy.map((function(t){return function(t){return t.field.canonicalString()+t.dir}(t)})).join(","),ai(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=Ki(e.startAt)),e.endAt&&(n+="|ub:",n+=Ki(e.endAt)),e.h=n}return e.h}function xi(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n=0;n<t.orderBy.length;n++)if(!Qi(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(var r=0;r<t.filters.length;r++)if(i=t.filters[r],o=e.filters[r],i.op!==o.op||!i.field.isEqual(o.field)||!fi(i.value,o.value))return!1;var i,o;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Hi(t.startAt,e.startAt)&&Hi(t.endAt,e.endAt)}function Ri(t){return hi.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}var Oi=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).field=e,i.op=n,i.value=r,i}return o(e,t),e.create=function(t,n,r){return t.isKeyField()?"in"===n||"not-in"===n?this.l(t,n,r):new Pi(t,n,r):"array-contains"===n?new Vi(t,r):"in"===n?new qi(t,r):"not-in"===n?new Ui(t,r):"array-contains-any"===n?new ji(t,r):new e(t,n,r)},e.l=function(t,e,n){return"in"===e?new Li(t,n):new Fi(t,n)},e.prototype.matches=function(t){var e=t.data.field(this.field);return"!="===this.op?null!==e&&this.m(pi(e,this.value)):null!==e&&li(this.value)===li(e)&&this.m(pi(e,this.value))},e.prototype.m=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return Lr()}},e.prototype.g=function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0},e}((function(){})),Pi=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,r)||this).key=hi.fromName(r.referenceValue),i}return o(e,t),e.prototype.matches=function(t){var e=hi.comparator(t.key,this.key);return this.m(e)},e}(Oi),Li=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"in",n)||this).keys=Mi("in",n),r}return o(e,t),e.prototype.matches=function(t){return this.keys.some((function(e){return e.isEqual(t.key)}))},e}(Oi),Fi=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"not-in",n)||this).keys=Mi("not-in",n),r}return o(e,t),e.prototype.matches=function(t){return!this.keys.some((function(e){return e.isEqual(t.key)}))},e}(Oi);function Mi(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((function(t){return hi.fromName(t.referenceValue)}))}var Vi=function(t){function e(e,n){return t.call(this,e,"array-contains",n)||this}return o(e,t),e.prototype.matches=function(t){var e=t.data.field(this.field);return bi(e)&&di(e.arrayValue,this.value)},e}(Oi),qi=function(t){function e(e,n){return t.call(this,e,"in",n)||this}return o(e,t),e.prototype.matches=function(t){var e=t.data.field(this.field);return null!==e&&di(this.value.arrayValue,e)},e}(Oi),Ui=function(t){function e(e,n){return t.call(this,e,"not-in",n)||this}return o(e,t),e.prototype.matches=function(t){if(di(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var e=t.data.field(this.field);return null!==e&&!di(this.value.arrayValue,e)},e}(Oi),ji=function(t){function e(e,n){return t.call(this,e,"array-contains-any",n)||this}return o(e,t),e.prototype.matches=function(t){var e=this,n=t.data.field(this.field);return!(!bi(n)||!n.arrayValue.values)&&n.arrayValue.values.some((function(t){return di(e.value.arrayValue,t)}))},e}(Oi),Bi=function(t,e){this.position=t,this.before=e};function Ki(t){return(t.before?"b":"a")+":"+t.position.map((function(t){return gi(t)})).join(",")}var Gi=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function Qi(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function zi(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i];if(r=o.field.isKeyField()?hi.comparator(hi.fromName(s.referenceValue),n.key):pi(s,n.data.field(o.field)),"desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function Hi(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!fi(t.position[n],e.position[n]))return!1;return!0}var Wi=function(t,e,n,r,i,o,s,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=s,this.endAt=a,this.p=null,this.T=null,this.startAt,this.endAt};function Yi(t,e,n,r,i,o,s,a){return new Wi(t,e,n,r,i,o,s,a)}function Xi(t){return new Wi(t)}function $i(t){return!ai(t.limit)&&"F"===t.limitType}function Ji(t){return!ai(t.limit)&&"L"===t.limitType}function Zi(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}function to(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.g())return r.field}return null}function eo(t){return null!==t.collectionGroup}function no(t){var e=Mr(t);if(null===e.p){e.p=[];var n=to(e),r=Zi(e);if(null!==n&&null===r)n.isKeyField()||e.p.push(new Gi(n)),e.p.push(new Gi($r.keyField(),"asc"));else{for(var i=!1,o=0,s=e.explicitOrderBy;o<s.length;o++){var a=s[o];e.p.push(a),a.field.isKeyField()&&(i=!0)}if(!i){var u=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.p.push(new Gi($r.keyField(),u))}}}return e.p}function ro(t){var e=Mr(t);if(!e.T)if("F"===e.limitType)e.T=ki(e.path,e.collectionGroup,no(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=no(e);r<i.length;r++){var o=i[r],s="desc"===o.dir?"asc":"desc";n.push(new Gi(o.field,s))}var a=e.endAt?new Bi(e.endAt.position,!e.endAt.before):null,u=e.startAt?new Bi(e.startAt.position,!e.startAt.before):null;e.T=ki(e.path,e.collectionGroup,n,e.filters,e.limit,a,u)}return e.T}function io(t,e,n){return new Wi(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function oo(t,e){return xi(ro(t),ro(e))&&t.limitType===e.limitType}function so(t){return Ci(ro(t))+"|lt:"+t.limitType}function ao(t){return"Query(target="+function(t){var e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=", filters: ["+t.filters.map((function(t){return(e=t).field.canonicalString()+" "+e.op+" "+gi(e.value);var e})).join(", ")+"]"),ai(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=", orderBy: ["+t.orderBy.map((function(t){return function(t){return t.field.canonicalString()+" ("+t.dir+")"}(t)})).join(", ")+"]"),t.startAt&&(e+=", startAt: "+Ki(t.startAt)),t.endAt&&(e+=", endAt: "+Ki(t.endAt)),"Target("+e+")"}(ro(t))+"; limitType="+t.limitType+")"}function uo(t,e){return e.isFoundDocument()&&function(t,e){var n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):hi.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(var n=0,r=t.explicitOrderBy;n<r.length;n++){var i=r[n];if(!i.field.isKeyField()&&null===e.data.field(i.field))return!1}return!0}(t,e)&&function(t,e){for(var n=0,r=t.filters;n<r.length;n++)if(!r[n].matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!zi(t.startAt,no(t),e)||t.endAt&&zi(t.endAt,no(t),e))}(t,e)}function co(t){return function(e,n){for(var r=!1,i=0,o=no(t);i<o.length;i++){var s=o[i],a=ho(s,e,n);if(0!==a)return a;r=r||s.field.isKeyField()}return 0}}function ho(t,e,n){var r=t.field.isKeyField()?hi.comparator(e.key,n.key):function(t,e,n){var r=e.data.field(t),i=n.data.field(t);return null!==r&&null!==i?pi(r,i):Lr()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return Lr()}}function lo(t,e){if(t.I){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ui(e)?"-0":e}}function fo(t){return{integerValue:""+t}}function po(t,e){return ci(e)?fo(e):lo(t,e)}var yo=function(){this._=void 0};function go(t,e,n){return t instanceof wo?function(t,e){var n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof bo?To(t,e):t instanceof Io?Eo(t,e):function(t,e){var n=mo(t,e),r=So(n)+So(t.A);return wi(n)&&wi(t.A)?fo(r):lo(t.R,r)}(t,e)}function vo(t,e,n){return t instanceof bo?To(t,e):t instanceof Io?Eo(t,e):n}function mo(t,e){return t instanceof _o?wi(n=e)||function(t){return!!t&&"doubleValue"in t}(n)?e:{integerValue:0}:null;var n}var wo=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e}(yo),bo=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return o(e,t),e}(yo);function To(t,e){for(var n=Do(e),r=function(t){n.some((function(e){return fi(e,t)}))||n.push(t)},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var Io=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return o(e,t),e}(yo);function Eo(t,e){for(var n=Do(e),r=function(t){n=n.filter((function(e){return!fi(e,t)}))},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var _o=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).R=e,r.A=n,r}return o(e,t),e}(yo);function So(t){return ni(t.integerValue||t.doubleValue)}function Do(t){return bi(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}var No=function(t,e){this.field=t,this.transform=e},Ao=function(t,e){this.version=t,this.transformResults=e},ko=function(){function t(t,e){this.updateTime=t,this.exists=e}return t.none=function(){return new t},t.exists=function(e){return new t(void 0,e)},t.updateTime=function(e){return new t(e)},Object.defineProperty(t.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},t}();function Co(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}var xo=function(){};function Ro(t,e,n){t instanceof Mo?function(t,e,n){var r=t.value.clone(),i=Uo(t.fieldTransforms,e,n.transformResults);r.setAll(i),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):t instanceof Vo?function(t,e,n){if(Co(t.precondition,e)){var r=Uo(t.fieldTransforms,e,n.transformResults),i=e.data;i.setAll(qo(t)),i.setAll(r),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}else e.convertToUnknownDocument(n.version)}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function Oo(t,e,n){t instanceof Mo?function(t,e,n){if(Co(t.precondition,e)){var r=t.value.clone(),i=jo(t.fieldTransforms,n,e);r.setAll(i),e.convertToFoundDocument(Fo(e),r).setHasLocalMutations()}}(t,e,n):t instanceof Vo?function(t,e,n){if(Co(t.precondition,e)){var r=jo(t.fieldTransforms,n,e),i=e.data;i.setAll(qo(t)),i.setAll(r),e.convertToFoundDocument(Fo(e),i).setHasLocalMutations()}}(t,e,n):function(t,e){Co(t.precondition,e)&&e.convertToNoDocument(Gr.min())}(t,e)}function Po(t,e){for(var n=null,r=0,i=t.fieldTransforms;r<i.length;r++){var o=i[r],s=e.data.field(o.field),a=mo(o.transform,s||null);null!=a&&(null==n&&(n=Si.empty()),n.set(o.field,a))}return n||null}function Lo(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&jr(t,e,(function(t,e){return function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof bo&&e instanceof bo||t instanceof Io&&e instanceof Io?jr(t.elements,e.elements,fi):t instanceof _o&&e instanceof _o?fi(t.A,e.A):t instanceof wo&&e instanceof wo}(t.transform,e.transform)}(t,e)}))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}function Fo(t){return t.isFoundDocument()?t.version:Gr.min()}var Mo=function(t){function e(e,n,r,i){void 0===i&&(i=[]);var o=this;return(o=t.call(this)||this).key=e,o.value=n,o.precondition=r,o.fieldTransforms=i,o.type=0,o}return o(e,t),e}(xo),Vo=function(t){function e(e,n,r,i,o){void 0===o&&(o=[]);var s=this;return(s=t.call(this)||this).key=e,s.data=n,s.fieldMask=r,s.precondition=i,s.fieldTransforms=o,s.type=1,s}return o(e,t),e}(xo);function qo(t){var e=new Map;return t.fieldMask.fields.forEach((function(n){if(!n.isEmpty()){var r=t.data.field(n);e.set(n,r)}})),e}function Uo(t,e,n){var r=new Map;Fr(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],s=o.transform,a=e.data.field(o.field);r.set(o.field,vo(s,a,n[i]))}return r}function jo(t,e,n){for(var r=new Map,i=0,o=t;i<o.length;i++){var s=o[i],a=s.transform,u=n.data.field(s.field);r.set(s.field,go(a,u,e))}return r}var Bo,Ko,Go=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=2,r.fieldTransforms=[],r}return o(e,t),e}(xo),Qo=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=3,r.fieldTransforms=[],r}return o(e,t),e}(xo),zo=function(t){this.count=t};function Ho(t){switch(t){case Nr.OK:return Lr();case Nr.CANCELLED:case Nr.UNKNOWN:case Nr.DEADLINE_EXCEEDED:case Nr.RESOURCE_EXHAUSTED:case Nr.INTERNAL:case Nr.UNAVAILABLE:case Nr.UNAUTHENTICATED:return!1;case Nr.INVALID_ARGUMENT:case Nr.NOT_FOUND:case Nr.ALREADY_EXISTS:case Nr.PERMISSION_DENIED:case Nr.FAILED_PRECONDITION:case Nr.ABORTED:case Nr.OUT_OF_RANGE:case Nr.UNIMPLEMENTED:case Nr.DATA_LOSS:return!0;default:return Lr()}}function Wo(t){if(void 0===t)return Rr("GRPC error has no .code"),Nr.UNKNOWN;switch(t){case Bo.OK:return Nr.OK;case Bo.CANCELLED:return Nr.CANCELLED;case Bo.UNKNOWN:return Nr.UNKNOWN;case Bo.DEADLINE_EXCEEDED:return Nr.DEADLINE_EXCEEDED;case Bo.RESOURCE_EXHAUSTED:return Nr.RESOURCE_EXHAUSTED;case Bo.INTERNAL:return Nr.INTERNAL;case Bo.UNAVAILABLE:return Nr.UNAVAILABLE;case Bo.UNAUTHENTICATED:return Nr.UNAUTHENTICATED;case Bo.INVALID_ARGUMENT:return Nr.INVALID_ARGUMENT;case Bo.NOT_FOUND:return Nr.NOT_FOUND;case Bo.ALREADY_EXISTS:return Nr.ALREADY_EXISTS;case Bo.PERMISSION_DENIED:return Nr.PERMISSION_DENIED;case Bo.FAILED_PRECONDITION:return Nr.FAILED_PRECONDITION;case Bo.ABORTED:return Nr.ABORTED;case Bo.OUT_OF_RANGE:return Nr.OUT_OF_RANGE;case Bo.UNIMPLEMENTED:return Nr.UNIMPLEMENTED;case Bo.DATA_LOSS:return Nr.DATA_LOSS;default:return Lr()}}(Ko=Bo||(Bo={}))[Ko.OK=0]="OK",Ko[Ko.CANCELLED=1]="CANCELLED",Ko[Ko.UNKNOWN=2]="UNKNOWN",Ko[Ko.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ko[Ko.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ko[Ko.NOT_FOUND=5]="NOT_FOUND",Ko[Ko.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ko[Ko.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ko[Ko.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ko[Ko.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ko[Ko.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ko[Ko.ABORTED=10]="ABORTED",Ko[Ko.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ko[Ko.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ko[Ko.INTERNAL=13]="INTERNAL",Ko[Ko.UNAVAILABLE=14]="UNAVAILABLE",Ko[Ko.DATA_LOSS=15]="DATA_LOSS";var Yo=function(){function t(t,e){this.comparator=t,this.root=e||$o.EMPTY}return t.prototype.insert=function(e,n){return new t(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,$o.BLACK,null,null))},t.prototype.remove=function(e){return new t(this.comparator,this.root.remove(e,this.comparator).copy(null,null,$o.BLACK,null,null))},t.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null},t.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1},t.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(t.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),t.prototype.minKey=function(){return this.root.minKey()},t.prototype.maxKey=function(){return this.root.maxKey()},t.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},t.prototype.forEach=function(t){this.inorderTraversal((function(e,n){return t(e,n),!1}))},t.prototype.toString=function(){var t=[];return this.inorderTraversal((function(e,n){return t.push(e+":"+n),!1})),"{"+t.join(", ")+"}"},t.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},t.prototype.getIterator=function(){return new Xo(this.root,null,this.comparator,!1)},t.prototype.getIteratorFrom=function(t){return new Xo(this.root,t,this.comparator,!1)},t.prototype.getReverseIterator=function(){return new Xo(this.root,null,this.comparator,!0)},t.prototype.getReverseIteratorFrom=function(t){return new Xo(this.root,t,this.comparator,!0)},t}(),Xo=function(){function t(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return t.prototype.getNext=function(){var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},t.prototype.hasNext=function(){return this.nodeStack.length>0},t.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},t}(),$o=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:t.EMPTY,this.right=null!=o?o:t.EMPTY,this.size=this.left.size+1+this.right.size}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype.isEmpty=function(){return!1},t.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},t.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},t.prototype.minKey=function(){return this.min().key},t.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},t.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},t.prototype.removeMin=function(){if(this.left.isEmpty())return t.EMPTY;var e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()},t.prototype.remove=function(e,n){var r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===n(e,i.key)){if(i.right.isEmpty())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()},t.prototype.isRed=function(){return this.color},t.prototype.fixUp=function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t},t.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t},t.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t},t.prototype.rotateLeft=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.rotateRight=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},t.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw Lr();if(this.right.isRed())throw Lr();var t=this.left.check();if(t!==this.right.check())throw Lr();return t+(this.isRed()?0:1)},t}();$o.EMPTY=null,$o.RED=!0,$o.BLACK=!1,$o.EMPTY=new(function(){function t(){this.size=0}return Object.defineProperty(t.prototype,"key",{get:function(){throw Lr()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){throw Lr()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){throw Lr()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){throw Lr()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){throw Lr()},enumerable:!1,configurable:!0}),t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.insert=function(t,e,n){return new $o(t,e)},t.prototype.remove=function(t,e){return this},t.prototype.isEmpty=function(){return!0},t.prototype.inorderTraversal=function(t){return!1},t.prototype.reverseTraversal=function(t){return!1},t.prototype.minKey=function(){return null},t.prototype.maxKey=function(){return null},t.prototype.isRed=function(){return!1},t.prototype.checkMaxDepth=function(){return!0},t.prototype.check=function(){return 0},t}());var Jo=function(){function t(t){this.comparator=t,this.data=new Yo(this.comparator)}return t.prototype.has=function(t){return null!==this.data.get(t)},t.prototype.first=function(){return this.data.minKey()},t.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(t.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),t.prototype.indexOf=function(t){return this.data.indexOf(t)},t.prototype.forEach=function(t){this.data.inorderTraversal((function(e,n){return t(e),!1}))},t.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}},t.prototype.forEachWhile=function(t,e){var n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return},t.prototype.firstAfterOrEqual=function(t){var e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null},t.prototype.getIterator=function(){return new Zo(this.data.getIterator())},t.prototype.getIteratorFrom=function(t){return new Zo(this.data.getIteratorFrom(t))},t.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},t.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},t.prototype.isEmpty=function(){return this.data.isEmpty()},t.prototype.unionWith=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach((function(t){e=e.add(t)})),e},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.data.getIterator(),r=e.data.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(0!==this.comparator(i,o))return!1}return!0},t.prototype.toArray=function(){var t=[];return this.forEach((function(e){t.push(e)})),t},t.prototype.toString=function(){var t=[];return this.forEach((function(e){return t.push(e)})),"SortedSet("+t.toString()+")"},t.prototype.copy=function(e){var n=new t(this.comparator);return n.data=e,n},t}(),Zo=function(){function t(t){this.iter=t}return t.prototype.getNext=function(){return this.iter.getNext().key},t.prototype.hasNext=function(){return this.iter.hasNext()},t}(),ts=new Yo(hi.comparator);function es(){return ts}var ns=new Yo(hi.comparator);function rs(){return ns}var is=new Yo(hi.comparator);function os(){return is}var ss=new Jo(hi.comparator);function as(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=ss,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var us=new Jo(Ur);function cs(){return us}var hs=function(){function t(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}return t.createSynthesizedRemoteEventForCurrentChange=function(e,n){var r=new Map;return r.set(e,ls.createSynthesizedTargetChangeForCurrentChange(e,n)),new t(Gr.min(),r,cs(),es(),as())},t}(),ls=function(){function t(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}return t.createSynthesizedTargetChangeForCurrentChange=function(e,n){return new t(Zr.EMPTY_BYTE_STRING,n,as(),as(),as())},t}(),fs=function(t,e,n,r){this.v=t,this.removedTargetIds=e,this.key=n,this.P=r},ds=function(t,e){this.targetId=t,this.V=e},ps=function(t,e,n,r){void 0===n&&(n=Zr.EMPTY_BYTE_STRING),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},ys=function(){function t(){this.S=0,this.D=ms(),this.C=Zr.EMPTY_BYTE_STRING,this.N=!1,this.k=!0}return Object.defineProperty(t.prototype,"current",{get:function(){return this.N},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resumeToken",{get:function(){return this.C},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"F",{get:function(){return 0!==this.S},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"$",{get:function(){return this.k},enumerable:!1,configurable:!0}),t.prototype.O=function(t){t.approximateByteSize()>0&&(this.k=!0,this.C=t)},t.prototype.M=function(){var t=as(),e=as(),n=as();return this.D.forEach((function(r,i){switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:Lr()}})),new ls(this.C,this.N,t,e,n)},t.prototype.L=function(){this.k=!1,this.D=ms()},t.prototype.B=function(t,e){this.k=!0,this.D=this.D.insert(t,e)},t.prototype.q=function(t){this.k=!0,this.D=this.D.remove(t)},t.prototype.U=function(){this.S+=1},t.prototype.K=function(){this.S-=1},t.prototype.j=function(){this.k=!0,this.N=!0},t}(),gs=function(){function t(t){this.W=t,this.G=new Map,this.H=es(),this.J=vs(),this.Y=new Jo(Ur)}return t.prototype.X=function(t){for(var e=0,n=t.v;e<n.length;e++){var r=n[e];t.P&&t.P.isFoundDocument()?this.Z(r,t.P):this.tt(r,t.key,t.P)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)r=o[i],this.tt(r,t.key,t.P)},t.prototype.et=function(t){var e=this;this.forEachTarget(t,(function(n){var r=e.nt(n);switch(t.state){case 0:e.st(n)&&r.O(t.resumeToken);break;case 1:r.K(),r.F||r.L(),r.O(t.resumeToken);break;case 2:r.K(),r.F||e.removeTarget(n);break;case 3:e.st(n)&&(r.j(),r.O(t.resumeToken));break;case 4:e.st(n)&&(e.it(n),r.O(t.resumeToken));break;default:Lr()}}))},t.prototype.forEachTarget=function(t,e){var n=this;t.targetIds.length>0?t.targetIds.forEach(e):this.G.forEach((function(t,r){n.st(r)&&e(r)}))},t.prototype.rt=function(t){var e=t.targetId,n=t.V.count,r=this.ot(e);if(r){var i=r.target;if(Ri(i))if(0===n){var o=new hi(i.path);this.tt(e,o,Ni.newNoDocument(o,Gr.min()))}else Fr(1===n);else this.ct(e)!==n&&(this.it(e),this.Y=this.Y.add(e))}},t.prototype.ut=function(t){var e=this,n=new Map;this.G.forEach((function(r,i){var o=e.ot(i);if(o){if(r.current&&Ri(o.target)){var s=new hi(o.target.path);null!==e.H.get(s)||e.at(i,s)||e.tt(i,s,Ni.newNoDocument(s,t))}r.$&&(n.set(i,r.M()),r.L())}}));var r=as();this.J.forEach((function(t,n){var i=!0;n.forEachWhile((function(t){var n=e.ot(t);return!n||2===n.purpose||(i=!1,!1)})),i&&(r=r.add(t))}));var i=new hs(t,n,this.Y,this.H,r);return this.H=es(),this.J=vs(),this.Y=new Jo(Ur),i},t.prototype.Z=function(t,e){if(this.st(t)){var n=this.at(t,e.key)?2:0;this.nt(t).B(e.key,n),this.H=this.H.insert(e.key,e),this.J=this.J.insert(e.key,this.ht(e.key).add(t))}},t.prototype.tt=function(t,e,n){if(this.st(t)){var r=this.nt(t);this.at(t,e)?r.B(e,1):r.q(e),this.J=this.J.insert(e,this.ht(e).delete(t)),n&&(this.H=this.H.insert(e,n))}},t.prototype.removeTarget=function(t){this.G.delete(t)},t.prototype.ct=function(t){var e=this.nt(t).M();return this.W.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},t.prototype.U=function(t){this.nt(t).U()},t.prototype.nt=function(t){var e=this.G.get(t);return e||(e=new ys,this.G.set(t,e)),e},t.prototype.ht=function(t){var e=this.J.get(t);return e||(e=new Jo(Ur),this.J=this.J.insert(t,e)),e},t.prototype.st=function(t){var e=null!==this.ot(t);return e||xr("WatchChangeAggregator","Detected inactive target",t),e},t.prototype.ot=function(t){var e=this.G.get(t);return e&&e.F?null:this.W.lt(t)},t.prototype.it=function(t){var e=this;this.G.set(t,new ys),this.W.getRemoteKeysForTarget(t).forEach((function(n){e.tt(t,n,null)}))},t.prototype.at=function(t,e){return this.W.getRemoteKeysForTarget(t).has(e)},t}();function vs(){return new Yo(hi.comparator)}function ms(){return new Yo(hi.comparator)}var ws={asc:"ASCENDING",desc:"DESCENDING"},bs={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Ts=function(t,e){this.databaseId=t,this.I=e};function Is(t,e){return t.I?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function Es(t,e){return t.I?e.toBase64():e.toUint8Array()}function _s(t,e){return Is(t,e.toTimestamp())}function Ss(t){return Fr(!!t),Gr.fromTimestamp(function(t){var e=ei(t);return new Kr(e.seconds,e.nanos)}(t))}function Ds(t,e){return function(t){return new Yr(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).canonicalString()}function Ns(t){var e=Yr.fromString(t);return Fr($s(e)),e}function As(t,e){return Ds(t.databaseId,e.path)}function ks(t,e){var n=Ns(e);if(n.get(1)!==t.databaseId.projectId)throw new Ar(Nr.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new Ar(Nr.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new hi(Os(n))}function Cs(t,e){return Ds(t.databaseId,e)}function xs(t){var e=Ns(t);return 4===e.length?Yr.emptyPath():Os(e)}function Rs(t){return new Yr(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function Os(t){return Fr(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function Ps(t,e,n){return{name:As(t,e),fields:n.value.mapValue.fields}}function Ls(t,e,n){var r=ks(t,e.name),i=Ss(e.updateTime),o=new Si({mapValue:{fields:e.fields}}),s=Ni.newFoundDocument(r,i,o);return n&&s.setHasCommittedMutations(),n?s.setHasCommittedMutations():s}function Fs(t,e){var n;if(e instanceof Mo)n={update:Ps(t,e.key,e.value)};else if(e instanceof Go)n={delete:As(t,e.key)};else if(e instanceof Vo)n={update:Ps(t,e.key,e.data),updateMask:Xs(e.fieldMask)};else{if(!(e instanceof Qo))return Lr();n={verify:As(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((function(t){return function(t,e){var n=e.transform;if(n instanceof wo)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof bo)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Io)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof _o)return{fieldPath:e.field.canonicalString(),increment:n.A};throw Lr()}(0,t)}))),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:_s(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:Lr()}(t,e.precondition)),n}function Ms(t,e){var n=e.currentDocument?function(t){return void 0!==t.updateTime?ko.updateTime(Ss(t.updateTime)):void 0!==t.exists?ko.exists(t.exists):ko.none()}(e.currentDocument):ko.none(),r=e.updateTransforms?e.updateTransforms.map((function(e){return function(t,e){var n=null;if("setToServerValue"in e)Fr("REQUEST_TIME"===e.setToServerValue),n=new wo;else if("appendMissingElements"in e){var r=e.appendMissingElements.values||[];n=new bo(r)}else if("removeAllFromArray"in e){var i=e.removeAllFromArray.values||[];n=new Io(i)}else"increment"in e?n=new _o(t,e.increment):Lr();var o=$r.fromServerFormat(e.fieldPath);return new No(o,n)}(t,e)})):[];if(e.update){e.update.name;var i=ks(t,e.update.name),o=new Si({mapValue:{fields:e.update.fields}});if(e.updateMask){var s=function(t){var e=t.fieldPaths||[];return new Jr(e.map((function(t){return $r.fromServerFormat(t)})))}(e.updateMask);return new Vo(i,o,s,n,r)}return new Mo(i,o,n,r)}if(e.delete){var a=ks(t,e.delete);return new Go(a,n)}if(e.verify){var u=ks(t,e.verify);return new Qo(u,n)}return Lr()}function Vs(t,e){return{documents:[Cs(t,e.path)]}}function qs(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=Cs(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=Cs(t,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var i=function(t){if(0!==t.length){var e=t.map((function(t){return function(t){if("=="===t.op){if(Ii(t.value))return{unaryFilter:{field:zs(t.field),op:"IS_NAN"}};if(Ti(t.value))return{unaryFilter:{field:zs(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Ii(t.value))return{unaryFilter:{field:zs(t.field),op:"IS_NOT_NAN"}};if(Ti(t.value))return{unaryFilter:{field:zs(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:zs(t.field),op:Qs(t.op),value:t.value}}}(t)}));return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}}(e.filters);i&&(n.structuredQuery.where=i);var o=function(t){if(0!==t.length)return t.map((function(t){return function(t){return{field:zs(t.field),direction:Gs(t.dir)}}(t)}))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);var s=function(t,e){return t.I||ai(e)?e:{value:e}}(t,e.limit);return null!==s&&(n.structuredQuery.limit=s),e.startAt&&(n.structuredQuery.startAt=Bs(e.startAt)),e.endAt&&(n.structuredQuery.endAt=Bs(e.endAt)),n}function Us(t){var e=xs(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){Fr(1===r);var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var s=[];n.where&&(s=js(n.where));var a=[];n.orderBy&&(a=n.orderBy.map((function(t){return function(t){return new Gi(Hs(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t)})));var u=null;n.limit&&(u=function(t){var e;return ai(e="object"==typeof t?t.value:t)?null:e}(n.limit));var c=null;n.startAt&&(c=Ks(n.startAt));var h=null;return n.endAt&&(h=Ks(n.endAt)),Yi(e,i,a,s,u,"F",c,h)}function js(t){return t?void 0!==t.unaryFilter?[Ys(t)]:void 0!==t.fieldFilter?[Ws(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map((function(t){return js(t)})).reduce((function(t,e){return t.concat(e)})):Lr():[]}function Bs(t){return{before:t.before,values:t.position}}function Ks(t){var e=!!t.before,n=t.values||[];return new Bi(n,e)}function Gs(t){return ws[t]}function Qs(t){return bs[t]}function zs(t){return{fieldPath:t.canonicalString()}}function Hs(t){return $r.fromServerFormat(t.fieldPath)}function Ws(t){return Oi.create(Hs(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Lr()}}(t.fieldFilter.op),t.fieldFilter.value)}function Ys(t){switch(t.unaryFilter.op){case"IS_NAN":var e=Hs(t.unaryFilter.field);return Oi.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=Hs(t.unaryFilter.field);return Oi.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=Hs(t.unaryFilter.field);return Oi.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=Hs(t.unaryFilter.field);return Oi.create(i,"!=",{nullValue:"NULL_VALUE"});default:return Lr()}}function Xs(t){var e=[];return t.fields.forEach((function(t){return e.push(t.canonicalString())})),{fieldPaths:e}}function $s(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}function Js(t){for(var e="",n=0;n<t.length;n++)e.length>0&&(e=ta(e)),e=Zs(t.get(n),e);return ta(e)}function Zs(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="";break;case"":n+="";break;default:n+=o}}return n}function ta(t){return t+""}function ea(t){var e=t.length;if(Fr(e>=2),2===e)return Fr(""===t.charAt(0)&&""===t.charAt(1)),Yr.emptyPath();for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("",o);switch((s<0||s>n)&&Lr(),t.charAt(s+1)){case"":var a=t.substring(o,s),u=void 0;0===i.length?u=a:(u=i+=a,i=""),r.push(u);break;case"":i+=t.substring(o,s),i+="\0";break;case"":i+=t.substring(o,s+1);break;default:Lr()}o=s+2}return new Yr(r)}var na=function(t,e){this.seconds=t,this.nanoseconds=e},ra=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};ra.store="owner",ra.key="owner";var ia=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};ia.store="mutationQueues",ia.keyPath="userId";var oa=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};oa.store="mutations",oa.keyPath="batchId",oa.userMutationsIndex="userMutationsIndex",oa.userMutationsKeyPath=["userId","batchId"];var sa=function(){function t(){}return t.prefixForUser=function(t){return[t]},t.prefixForPath=function(t,e){return[t,Js(e)]},t.key=function(t,e,n){return[t,Js(e),n]},t}();sa.store="documentMutations",sa.PLACEHOLDER=new sa;var aa=function(t,e){this.path=t,this.readTime=e},ua=function(t,e){this.path=t,this.version=e},ca=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};ca.store="remoteDocuments",ca.readTimeIndex="readTimeIndex",ca.readTimeIndexPath="readTime",ca.collectionReadTimeIndex="collectionReadTimeIndex",ca.collectionReadTimeIndexPath=["parentPath","readTime"];var ha=function(t){this.byteSize=t};ha.store="remoteDocumentGlobal",ha.key="remoteDocumentGlobalKey";var la=function(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};la.store="targets",la.keyPath="targetId",la.queryTargetsIndexName="queryTargetsIndex",la.queryTargetsKeyPath=["canonicalId","targetId"];var fa=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};fa.store="targetDocuments",fa.keyPath=["targetId","path"],fa.documentTargetsIndex="documentTargetsIndex",fa.documentTargetsKeyPath=["path","targetId"];var da=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};da.key="targetGlobalKey",da.store="targetGlobal";var pa=function(t,e){this.collectionId=t,this.parent=e};pa.store="collectionParents",pa.keyPath=["collectionId","parent"];var ya=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};ya.store="clientMetadata",ya.keyPath="clientId";var ga=function(t,e,n){this.bundleId=t,this.createTime=e,this.version=n};ga.store="bundles",ga.keyPath="bundleId";var va=function(t,e,n){this.name=t,this.readTime=e,this.bundledQuery=n};va.store="namedQueries",va.keyPath="name";var ma=u(u([],u(u([],u(u([],u(u([],[ia.store,oa.store,sa.store,ca.store,la.store,ra.store,da.store,fa.store]),[ya.store])),[ha.store])),[pa.store])),[ga.store,va.store]),wa="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",ba=function(){function t(){this.onCommittedListeners=[]}return t.prototype.addOnCommittedListener=function(t){this.onCommittedListeners.push(t)},t.prototype.raiseOnCommittedEvent=function(){this.onCommittedListeners.forEach((function(t){return t()}))},t}(),Ta=function(){var t=this;this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))},Ia=function(){function t(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)}),(function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)}))}return t.prototype.catch=function(t){return this.next(void 0,t)},t.prototype.next=function(e,n){var r=this;return this.callbackAttached&&Lr(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new t((function(t,i){r.nextCallback=function(n){r.wrapSuccess(e,n).next(t,i)},r.catchCallback=function(e){r.wrapFailure(n,e).next(t,i)}}))},t.prototype.toPromise=function(){var t=this;return new Promise((function(e,n){t.next(e,n)}))},t.prototype.wrapUserFunction=function(e){try{var n=e();return n instanceof t?n:t.resolve(n)}catch(e){return t.reject(e)}},t.prototype.wrapSuccess=function(e,n){return e?this.wrapUserFunction((function(){return e(n)})):t.resolve(n)},t.prototype.wrapFailure=function(e,n){return e?this.wrapUserFunction((function(){return e(n)})):t.reject(n)},t.resolve=function(e){return new t((function(t,n){t(e)}))},t.reject=function(e){return new t((function(t,n){n(e)}))},t.waitFor=function(e){return new t((function(t,n){var r=0,i=0,o=!1;e.forEach((function(e){++r,e.next((function(){++i,o&&i===r&&t()}),(function(t){return n(t)}))})),o=!0,i===r&&t()}))},t.or=function(e){for(var n=t.resolve(!1),r=function(e){n=n.next((function(n){return n?t.resolve(n):e()}))},i=0,o=e;i<o.length;i++)r(o[i]);return n},t.forEach=function(t,e){var n=this,r=[];return t.forEach((function(t,i){r.push(e.call(n,t,i))})),this.waitFor(r)},t}(),Ea=function(){function t(t,e){var n=this;this.action=t,this.transaction=e,this.aborted=!1,this.ft=new Ta,this.transaction.oncomplete=function(){n.ft.resolve()},this.transaction.onabort=function(){e.error?n.ft.reject(new Da(t,e.error)):n.ft.resolve()},this.transaction.onerror=function(e){var r=xa(e.target.error);n.ft.reject(new Da(t,r))}}return t.open=function(e,n,r,i){try{return new t(n,e.transaction(i,r))}catch(e){throw new Da(n,e)}},Object.defineProperty(t.prototype,"dt",{get:function(){return this.ft.promise},enumerable:!1,configurable:!0}),t.prototype.abort=function(t){t&&this.ft.reject(t),this.aborted||(xr("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},t.prototype.store=function(t){var e=this.transaction.objectStore(t);return new Aa(e)},t}(),_a=function(){function t(e,n,r){this.name=e,this.version=n,this.wt=r,12.2===t._t((0,c.z$)())&&Rr("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return t.delete=function(t){return xr("SimpleDb","Removing database:",t),ka(window.indexedDB.deleteDatabase(t)).toPromise()},t.yt=function(){if("undefined"==typeof indexedDB)return!1;if(t.gt())return!0;var e=(0,c.z$)(),n=t._t(e),r=0<n&&n<10,i=t.Et(e),o=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||o)},t.gt=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.Tt)},t.It=function(t,e){return t.store(e)},t._t=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},t.Et=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},t.prototype.At=function(t){return s(this,void 0,void 0,(function(){var e,n=this;return a(this,(function(r){switch(r.label){case 0:return this.db?[3,2]:(xr("SimpleDb","Opening database:",this.name),e=this,[4,new Promise((function(e,r){var i=indexedDB.open(n.name,n.version);i.onsuccess=function(t){var n=t.target.result;e(n)},i.onblocked=function(){r(new Da(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(e){var n=e.target.error;"VersionError"===n.name?r(new Ar(Nr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):r(new Da(t,n))},i.onupgradeneeded=function(t){xr("SimpleDb",'Database "'+n.name+'" requires upgrade from version:',t.oldVersion);var e=t.target.result;n.wt.Rt(e,i.transaction,t.oldVersion,n.version).next((function(){xr("SimpleDb","Database upgrade to version "+n.version+" complete")}))}}))]);case 1:e.db=r.sent(),r.label=2;case 2:return[2,(this.bt&&(this.db.onversionchange=function(t){return n.bt(t)}),this.db)]}}))}))},t.prototype.vt=function(t){this.bt=t,this.db&&(this.db.onversionchange=function(e){return t(e)})},t.prototype.runTransaction=function(t,e,n,r){return s(this,void 0,void 0,(function(){var i,o,s,u,c;return a(this,(function(h){switch(h.label){case 0:i="readonly"===e,o=0,s=function(){var e,s,c,h,l;return a(this,(function(a){switch(a.label){case 0:++o,a.label=1;case 1:return a.trys.push([1,4,,5]),[4,u.At(t)];case 2:return u.db=a.sent(),e=Ea.open(u.db,t,i?"readonly":"readwrite",n),s=r(e).catch((function(t){return e.abort(t),Ia.reject(t)})).toPromise(),c={},s.catch((function(){})),[4,e.dt];case 3:return[2,(c.value=(a.sent(),s),c)];case 4:return h=a.sent(),l="FirebaseError"!==h.name&&o<3,xr("SimpleDb","Transaction failed with error:",h.message,"Retrying:",l),u.close(),l?[3,5]:[2,{value:Promise.reject(h)}];case 5:return[2]}}))},u=this,h.label=1;case 1:return[5,s()];case 2:if("object"==typeof(c=h.sent()))return[2,c.value];h.label=3;case 3:return[3,1];case 4:return[2]}}))}))},t.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},t}(),Sa=function(){function t(t){this.Pt=t,this.Vt=!1,this.St=null}return Object.defineProperty(t.prototype,"isDone",{get:function(){return this.Vt},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Dt",{get:function(){return this.St},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cursor",{set:function(t){this.Pt=t},enumerable:!1,configurable:!0}),t.prototype.done=function(){this.Vt=!0},t.prototype.Ct=function(t){this.St=t},t.prototype.delete=function(){return ka(this.Pt.delete())},t}(),Da=function(t){function e(e,n){var r=this;return(r=t.call(this,Nr.UNAVAILABLE,"IndexedDB transaction '"+e+"' failed: "+n)||this).name="IndexedDbTransactionError",r}return o(e,t),e}(Ar);function Na(t){return"IndexedDbTransactionError"===t.name}var Aa=function(){function t(t){this.store=t}return t.prototype.put=function(t,e){var n;return void 0!==e?(xr("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(xr("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),ka(n)},t.prototype.add=function(t){return xr("SimpleDb","ADD",this.store.name,t,t),ka(this.store.add(t))},t.prototype.get=function(t){var e=this;return ka(this.store.get(t)).next((function(n){return void 0===n&&(n=null),xr("SimpleDb","GET",e.store.name,t,n),n}))},t.prototype.delete=function(t){return xr("SimpleDb","DELETE",this.store.name,t),ka(this.store.delete(t))},t.prototype.count=function(){return xr("SimpleDb","COUNT",this.store.name),ka(this.store.count())},t.prototype.Nt=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.xt(n,(function(t,e){r.push(e)})).next((function(){return r}))},t.prototype.kt=function(t,e){xr("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.Ft=!1;var r=this.cursor(n);return this.xt(r,(function(t,e,n){return n.delete()}))},t.prototype.$t=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.xt(r,e)},t.prototype.Ot=function(t){var e=this.cursor({});return new Ia((function(n,r){e.onerror=function(t){var e=xa(t.target.error);r(e)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next((function(t){t?r.continue():n()})):n()}}))},t.prototype.xt=function(t,e){var n=[];return new Ia((function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new Sa(i),s=e(i.primaryKey,i.value,o);if(s instanceof Ia){var a=s.catch((function(t){return o.done(),Ia.reject(t)}));n.push(a)}o.isDone?r():null===o.Dt?i.continue():i.continue(o.Dt)}else r()}})).next((function(){return Ia.waitFor(n)}))},t.prototype.options=function(t,e){var n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},t.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.Ft?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},t}();function ka(t){return new Ia((function(e,n){t.onsuccess=function(t){var n=t.target.result;e(n)},t.onerror=function(t){var e=xa(t.target.error);n(e)}}))}var Ca=!1;function xa(t){var e=_a._t((0,c.z$)());if(e>=12.2&&e<13){var n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){var r=new Ar("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return Ca||(Ca=!0,setTimeout((function(){throw r}),0)),r}}return t}var Ra=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Mt=e,r.currentSequenceNumber=n,r}return o(e,t),e}(ba);function Oa(t,e){var n=Mr(t);return _a.It(n.Mt,e)}var Pa=function(){function t(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}return t.prototype.applyToRemoteDocument=function(t,e){for(var n=e.mutationResults,r=0;r<this.mutations.length;r++){var i=this.mutations[r];i.key.isEqual(t.key)&&Ro(i,t,n[r])}},t.prototype.applyToLocalView=function(t){for(var e=0,n=this.baseMutations;e<n.length;e++)(o=n[e]).key.isEqual(t.key)&&Oo(o,t,this.localWriteTime);for(var r=0,i=this.mutations;r<i.length;r++){var o;(o=i[r]).key.isEqual(t.key)&&Oo(o,t,this.localWriteTime)}},t.prototype.applyToLocalDocumentSet=function(t){var e=this;this.mutations.forEach((function(n){var r=t.get(n.key),i=r;e.applyToLocalView(i),r.isValidDocument()||i.convertToNoDocument(Gr.min())}))},t.prototype.keys=function(){return this.mutations.reduce((function(t,e){return t.add(e.key)}),as())},t.prototype.isEqual=function(t){return this.batchId===t.batchId&&jr(this.mutations,t.mutations,(function(t,e){return Lo(t,e)}))&&jr(this.baseMutations,t.baseMutations,(function(t,e){return Lo(t,e)}))},t}(),La=function(){function t(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}return t.from=function(e,n,r){Fr(e.mutations.length===r.length);for(var i=os(),o=e.mutations,s=0;s<o.length;s++)i=i.insert(o[s].key,r[s].version);return new t(e,n,r,i)},t}(),Fa=function(){function t(t,e,n,r,i,o,s){void 0===i&&(i=Gr.min()),void 0===o&&(o=Gr.min()),void 0===s&&(s=Zr.EMPTY_BYTE_STRING),this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}return t.prototype.withSequenceNumber=function(e){return new t(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)},t.prototype.withResumeToken=function(e,n){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e)},t.prototype.withLastLimboFreeSnapshotVersion=function(e){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)},t}(),Ma=function(t){this.Lt=t};function Va(t,e){if(e.document)return Ls(t.Lt,e.document,!!e.hasCommittedMutations);if(e.noDocument){var n=hi.fromSegments(e.noDocument.path),r=Ka(e.noDocument.readTime),i=Ni.newNoDocument(n,r);return e.hasCommittedMutations?i.setHasCommittedMutations():i}if(e.unknownDocument){var o=hi.fromSegments(e.unknownDocument.path);return r=Ka(e.unknownDocument.version),Ni.newUnknownDocument(o,r)}return Lr()}function qa(t,e,n){var r=Ua(n),i=e.key.path.popLast().toArray();if(e.isFoundDocument()){var o=function(t,e){return{name:As(t,e.key),fields:e.data.value.mapValue.fields,updateTime:Is(t,e.version.toTimestamp())}}(t.Lt,e),s=e.hasCommittedMutations;return new ca(null,null,o,s,r,i)}if(e.isNoDocument()){var a=e.key.path.toArray(),u=Ba(e.version);return s=e.hasCommittedMutations,new ca(null,new aa(a,u),null,s,r,i)}if(e.isUnknownDocument()){var c=e.key.path.toArray(),h=Ba(e.version);return new ca(new ua(c,h),null,null,!0,r,i)}return Lr()}function Ua(t){var e=t.toTimestamp();return[e.seconds,e.nanoseconds]}function ja(t){var e=new Kr(t[0],t[1]);return Gr.fromTimestamp(e)}function Ba(t){var e=t.toTimestamp();return new na(e.seconds,e.nanoseconds)}function Ka(t){var e=new Kr(t.seconds,t.nanoseconds);return Gr.fromTimestamp(e)}function Ga(t,e){for(var n=(e.baseMutations||[]).map((function(e){return Ms(t.Lt,e)})),r=0;r<e.mutations.length-1;++r){var i=e.mutations[r];if(r+1<e.mutations.length&&void 0!==e.mutations[r+1].transform){var o=e.mutations[r+1];i.updateTransforms=o.transform.fieldTransforms,e.mutations.splice(r+1,1),++r}}var s=e.mutations.map((function(e){return Ms(t.Lt,e)})),a=Kr.fromMillis(e.localWriteTimeMs);return new Pa(e.batchId,a,n,s)}function Qa(t){var e,n,r=Ka(t.readTime),i=void 0!==t.lastLimboFreeSnapshotVersion?Ka(t.lastLimboFreeSnapshotVersion):Gr.min();return void 0!==t.query.documents?(Fr(1===(n=t.query).documents.length),e=ro(Xi(xs(n.documents[0])))):e=function(t){return ro(Us(t))}(t.query),new Fa(e,t.targetId,0,t.lastListenSequenceNumber,r,i,Zr.fromBase64String(t.resumeToken))}function za(t,e){var n,r=Ba(e.snapshotVersion),i=Ba(e.lastLimboFreeSnapshotVersion);n=Ri(e.target)?Vs(t.Lt,e.target):qs(t.Lt,e.target);var o=e.resumeToken.toBase64();return new la(e.targetId,Ci(e.target),r,o,e.sequenceNumber,i,n)}function Ha(t){var e=Us({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?io(e,e.limit,"L"):e}var Wa=function(){function t(){}return t.prototype.getBundleMetadata=function(t,e){return Ya(t).get(e).next((function(t){if(t)return{id:(e=t).bundleId,createTime:Ka(e.createTime),version:e.version};var e}))},t.prototype.saveBundleMetadata=function(t,e){return Ya(t).put({bundleId:(n=e).id,createTime:Ba(Ss(n.createTime)),version:n.version});var n},t.prototype.getNamedQuery=function(t,e){return Xa(t).get(e).next((function(t){if(t)return{name:(e=t).name,query:Ha(e.bundledQuery),readTime:Ka(e.readTime)};var e}))},t.prototype.saveNamedQuery=function(t,e){return Xa(t).put(function(t){return{name:t.name,readTime:Ba(Ss(t.readTime)),bundledQuery:t.bundledQuery}}(e))},t}();function Ya(t){return Oa(t,ga.store)}function Xa(t){return Oa(t,va.store)}var $a=function(){function t(){this.Bt=new Ja}return t.prototype.addToCollectionParentIndex=function(t,e){return this.Bt.add(e),Ia.resolve()},t.prototype.getCollectionParents=function(t,e){return Ia.resolve(this.Bt.getEntries(e))},t}(),Ja=function(){function t(){this.index={}}return t.prototype.add=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new Jo(Yr.comparator),i=!r.has(n);return this.index[e]=r.add(n),i},t.prototype.has=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)},t.prototype.getEntries=function(t){return(this.index[t]||new Jo(Yr.comparator)).toArray()},t}(),Za=function(){function t(){this.qt=new Ja}return t.prototype.addToCollectionParentIndex=function(t,e){var n=this;if(!this.qt.has(e)){var r=e.lastSegment(),i=e.popLast();t.addOnCommittedListener((function(){n.qt.add(e)}));var o={collectionId:r,parent:Js(i)};return tu(t).put(o)}return Ia.resolve()},t.prototype.getCollectionParents=function(t,e){var n=[],r=IDBKeyRange.bound([e,""],[Br(e),""],!1,!0);return tu(t).Nt(r).next((function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.collectionId!==e)break;n.push(ea(o.parent))}return n}))},t}();function tu(t){return Oa(t,pa.store)}var eu={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},nu=function(){function t(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}return t.withCacheSize=function(e){return new t(e,t.DEFAULT_COLLECTION_PERCENTILE,t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},t}();function ru(t,e,n){var r=t.store(oa.store),i=t.store(sa.store),o=[],s=IDBKeyRange.only(n.batchId),a=0,u=r.$t({range:s},(function(t,e,n){return a++,n.delete()}));o.push(u.next((function(){Fr(1===a)})));for(var c=[],h=0,l=n.mutations;h<l.length;h++){var f=l[h],d=sa.key(e,f.key.path,n.batchId);o.push(i.delete(d)),c.push(f.key)}return Ia.waitFor(o).next((function(){return c}))}function iu(t){if(!t)return 0;var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Lr();e=t.noDocument}return JSON.stringify(e).length}nu.DEFAULT_COLLECTION_PERCENTILE=10,nu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,nu.DEFAULT=new nu(41943040,nu.DEFAULT_COLLECTION_PERCENTILE,nu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),nu.DISABLED=new nu(-1,0,0);var ou=function(){function t(t,e,n,r){this.userId=t,this.R=e,this.Ut=n,this.referenceDelegate=r,this.Kt={}}return t.Qt=function(e,n,r,i){return Fr(""!==e.uid),new t(e.isAuthenticated()?e.uid:"",n,r,i)},t.prototype.checkEmpty=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return au(t).$t({index:oa.userMutationsIndex,range:n},(function(t,n,r){e=!1,r.done()})).next((function(){return e}))},t.prototype.addMutationBatch=function(t,e,n,r){var i=this,o=uu(t),s=au(t);return s.add({}).next((function(a){Fr("number"==typeof a);for(var u=new Pa(a,e,n,r),c=function(t,e,n){var r=n.baseMutations.map((function(e){return Fs(t.Lt,e)})),i=n.mutations.map((function(e){return Fs(t.Lt,e)}));return new oa(e,n.batchId,n.localWriteTime.toMillis(),r,i)}(i.R,i.userId,u),h=[],l=new Jo((function(t,e){return Ur(t.canonicalString(),e.canonicalString())})),f=0,d=r;f<d.length;f++){var p=d[f],y=sa.key(i.userId,p.key.path,a);l=l.add(p.key.path.popLast()),h.push(s.put(c)),h.push(o.put(y,sa.PLACEHOLDER))}return l.forEach((function(e){h.push(i.Ut.addToCollectionParentIndex(t,e))})),t.addOnCommittedListener((function(){i.Kt[a]=u.keys()})),Ia.waitFor(h).next((function(){return u}))}))},t.prototype.lookupMutationBatch=function(t,e){var n=this;return au(t).get(e).next((function(t){return t?(Fr(t.userId===n.userId),Ga(n.R,t)):null}))},t.prototype.jt=function(t,e){var n=this;return this.Kt[e]?Ia.resolve(this.Kt[e]):this.lookupMutationBatch(t,e).next((function(t){if(t){var r=t.keys();return n.Kt[e]=r,r}return null}))},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this,r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),o=null;return au(t).$t({index:oa.userMutationsIndex,range:i},(function(t,e,i){e.userId===n.userId&&(Fr(e.batchId>=r),o=Ga(n.R,e)),i.done()})).next((function(){return o}))},t.prototype.getHighestUnacknowledgedBatchId=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return au(t).$t({index:oa.userMutationsIndex,range:e,reverse:!0},(function(t,e,r){n=e.batchId,r.done()})).next((function(){return n}))},t.prototype.getAllMutationBatches=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return au(t).Nt(oa.userMutationsIndex,n).next((function(t){return t.map((function(t){return Ga(e.R,t)}))}))},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=sa.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return uu(t).$t({range:i},(function(r,i,s){var a=r[0],u=r[1],c=r[2],h=ea(u);if(a===n.userId&&e.path.isEqual(h))return au(t).get(c).next((function(t){if(!t)throw Lr();Fr(t.userId===n.userId),o.push(Ga(n.R,t))}));s.done()})).next((function(){return o}))},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new Jo(Ur),i=[];return e.forEach((function(e){var o=sa.prefixForPath(n.userId,e.path),s=IDBKeyRange.lowerBound(o),a=uu(t).$t({range:s},(function(t,i,o){var s=t[0],a=t[1],u=t[2],c=ea(a);s===n.userId&&e.path.isEqual(c)?r=r.add(u):o.done()}));i.push(a)})),Ia.waitFor(i).next((function(){return n.Wt(t,r)}))},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=this,r=e.path,i=r.length+1,o=sa.prefixForPath(this.userId,r),s=IDBKeyRange.lowerBound(o),a=new Jo(Ur);return uu(t).$t({range:s},(function(t,e,o){var s=t[0],u=t[1],c=t[2],h=ea(u);s===n.userId&&r.isPrefixOf(h)?h.length===i&&(a=a.add(c)):o.done()})).next((function(){return n.Wt(t,a)}))},t.prototype.Wt=function(t,e){var n=this,r=[],i=[];return e.forEach((function(e){i.push(au(t).get(e).next((function(t){if(null===t)throw Lr();Fr(t.userId===n.userId),r.push(Ga(n.R,t))})))})),Ia.waitFor(i).next((function(){return r}))},t.prototype.removeMutationBatch=function(t,e){var n=this;return ru(t.Mt,this.userId,e).next((function(r){return t.addOnCommittedListener((function(){n.Gt(e.batchId)})),Ia.forEach(r,(function(e){return n.referenceDelegate.markPotentiallyOrphaned(t,e)}))}))},t.prototype.Gt=function(t){delete this.Kt[t]},t.prototype.performConsistencyCheck=function(t){var e=this;return this.checkEmpty(t).next((function(n){if(!n)return Ia.resolve();var r=IDBKeyRange.lowerBound(sa.prefixForUser(e.userId)),i=[];return uu(t).$t({range:r},(function(t,n,r){if(t[0]===e.userId){var o=ea(t[1]);i.push(o)}else r.done()})).next((function(){Fr(0===i.length)}))}))},t.prototype.containsKey=function(t,e){return su(t,this.userId,e)},t.prototype.zt=function(t){var e=this;return cu(t).get(this.userId).next((function(t){return t||new ia(e.userId,-1,"")}))},t}();function su(t,e,n){var r=sa.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),s=!1;return uu(t).$t({range:o,Ft:!0},(function(t,n,r){var o=t[0],a=t[1];t[2],o===e&&a===i&&(s=!0),r.done()})).next((function(){return s}))}function au(t){return Oa(t,oa.store)}function uu(t){return Oa(t,sa.store)}function cu(t){return Oa(t,ia.store)}var hu=function(){function t(t){this.Ht=t}return t.prototype.next=function(){return this.Ht+=2,this.Ht},t.Jt=function(){return new t(0)},t.Yt=function(){return new t(-1)},t}(),lu=function(){function t(t,e){this.referenceDelegate=t,this.R=e}return t.prototype.allocateTargetId=function(t){var e=this;return this.Xt(t).next((function(n){var r=new hu(n.highestTargetId);return n.highestTargetId=r.next(),e.Zt(t,n).next((function(){return n.highestTargetId}))}))},t.prototype.getLastRemoteSnapshotVersion=function(t){return this.Xt(t).next((function(t){return Gr.fromTimestamp(new Kr(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))}))},t.prototype.getHighestSequenceNumber=function(t){return this.Xt(t).next((function(t){return t.highestListenSequenceNumber}))},t.prototype.setTargetsMetadata=function(t,e,n){var r=this;return this.Xt(t).next((function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.Zt(t,i)}))},t.prototype.addTargetData=function(t,e){var n=this;return this.te(t,e).next((function(){return n.Xt(t).next((function(r){return r.targetCount+=1,n.ee(e,r),n.Zt(t,r)}))}))},t.prototype.updateTargetData=function(t,e){return this.te(t,e)},t.prototype.removeTargetData=function(t,e){var n=this;return this.removeMatchingKeysForTargetId(t,e.targetId).next((function(){return fu(t).delete(e.targetId)})).next((function(){return n.Xt(t)})).next((function(e){return Fr(e.targetCount>0),e.targetCount-=1,n.Zt(t,e)}))},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return fu(t).$t((function(s,a){var u=Qa(a);u.sequenceNumber<=e&&null===n.get(u.targetId)&&(i++,o.push(r.removeTargetData(t,u)))})).next((function(){return Ia.waitFor(o)})).next((function(){return i}))},t.prototype.forEachTarget=function(t,e){return fu(t).$t((function(t,n){var r=Qa(n);e(r)}))},t.prototype.Xt=function(t){return du(t).get(da.key).next((function(t){return Fr(null!==t),t}))},t.prototype.Zt=function(t,e){return du(t).put(da.key,e)},t.prototype.te=function(t,e){return fu(t).put(za(this.R,e))},t.prototype.ee=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},t.prototype.getTargetCount=function(t){return this.Xt(t).next((function(t){return t.targetCount}))},t.prototype.getTargetData=function(t,e){var n=Ci(e),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return fu(t).$t({range:r,index:la.queryTargetsIndexName},(function(t,n,r){var o=Qa(n);xi(e,o.target)&&(i=o,r.done())})).next((function(){return i}))},t.prototype.addMatchingKeys=function(t,e,n){var r=this,i=[],o=pu(t);return e.forEach((function(e){var s=Js(e.path);i.push(o.put(new fa(n,s))),i.push(r.referenceDelegate.addReference(t,n,e))})),Ia.waitFor(i)},t.prototype.removeMatchingKeys=function(t,e,n){var r=this,i=pu(t);return Ia.forEach(e,(function(e){var o=Js(e.path);return Ia.waitFor([i.delete([n,o]),r.referenceDelegate.removeReference(t,n,e)])}))},t.prototype.removeMatchingKeysForTargetId=function(t,e){var n=pu(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=pu(t),i=as();return r.$t({range:n,Ft:!0},(function(t,e,n){var r=ea(t[1]),o=new hi(r);i=i.add(o)})).next((function(){return i}))},t.prototype.containsKey=function(t,e){var n=Js(e.path),r=IDBKeyRange.bound([n],[Br(n)],!1,!0),i=0;return pu(t).$t({index:fa.documentTargetsIndex,Ft:!0,range:r},(function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())})).next((function(){return i>0}))},t.prototype.lt=function(t,e){return fu(t).get(e).next((function(t){return t?Qa(t):null}))},t}();function fu(t){return Oa(t,la.store)}function du(t){return Oa(t,da.store)}function pu(t){return Oa(t,fa.store)}function yu(t){return s(this,void 0,void 0,(function(){return a(this,(function(e){if(t.code!==Nr.FAILED_PRECONDITION||t.message!==wa)throw t;return xr("LocalStore","Unexpectedly lost primary lease"),[2]}))}))}function gu(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],s=Ur(n,i);return 0===s?Ur(r,o):s}var vu=function(){function t(t){this.ne=t,this.buffer=new Jo(gu),this.se=0}return t.prototype.ie=function(){return++this.se},t.prototype.re=function(t){var e=[t,this.ie()];if(this.buffer.size<this.ne)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();gu(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(t.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),t}(),mu=function(){function t(t,e){this.garbageCollector=t,this.asyncQueue=e,this.oe=!1,this.ce=null}return t.prototype.start=function(t){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.ue(t)},t.prototype.stop=function(){this.ce&&(this.ce.cancel(),this.ce=null)},Object.defineProperty(t.prototype,"started",{get:function(){return null!==this.ce},enumerable:!1,configurable:!0}),t.prototype.ue=function(t){var e=this,n=this.oe?3e5:6e4;xr("LruGarbageCollector","Garbage collection scheduled in "+n+"ms"),this.ce=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",n,(function(){return s(e,void 0,void 0,(function(){var e;return a(this,(function(n){switch(n.label){case 0:this.ce=null,this.oe=!0,n.label=1;case 1:return n.trys.push([1,3,,7]),[4,t.collectGarbage(this.garbageCollector)];case 2:return n.sent(),[3,7];case 3:return Na(e=n.sent())?(xr("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,yu(e)];case 5:n.sent(),n.label=6;case 6:return[3,7];case 7:return[4,this.ue(t)];case 8:return n.sent(),[2]}}))}))}))},t}(),wu=function(){function t(t,e){this.ae=t,this.params=e}return t.prototype.calculateTargetCount=function(t,e){return this.ae.he(t).next((function(t){return Math.floor(e/100*t)}))},t.prototype.nthSequenceNumber=function(t,e){var n=this;if(0===e)return Ia.resolve(Dr.o);var r=new vu(e);return this.ae.forEachTarget(t,(function(t){return r.re(t.sequenceNumber)})).next((function(){return n.ae.le(t,(function(t){return r.re(t)}))})).next((function(){return r.maxValue}))},t.prototype.removeTargets=function(t,e,n){return this.ae.removeTargets(t,e,n)},t.prototype.removeOrphanedDocuments=function(t,e){return this.ae.removeOrphanedDocuments(t,e)},t.prototype.collect=function(t,e){var n=this;return-1===this.params.cacheSizeCollectionThreshold?(xr("LruGarbageCollector","Garbage collection skipped; disabled"),Ia.resolve(eu)):this.getCacheSize(t).next((function(r){return r<n.params.cacheSizeCollectionThreshold?(xr("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.params.cacheSizeCollectionThreshold),eu):n.fe(t,e)}))},t.prototype.getCacheSize=function(t){return this.ae.getCacheSize(t)},t.prototype.fe=function(t,e){var n,r,i,o,s,a,u,c=this,l=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next((function(e){return e>c.params.maximumSequenceNumbersToCollect?(xr("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+c.params.maximumSequenceNumbersToCollect+" from "+e),r=c.params.maximumSequenceNumbersToCollect):r=e,o=Date.now(),c.nthSequenceNumber(t,r)})).next((function(r){return n=r,s=Date.now(),c.removeTargets(t,n,e)})).next((function(e){return i=e,a=Date.now(),c.removeOrphanedDocuments(t,n)})).next((function(t){return u=Date.now(),Cr()<=h.in.DEBUG&&xr("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(o-l)+"ms\n\tDetermined least recently used "+r+" in "+(s-o)+"ms\n\tRemoved "+i+" targets in "+(a-s)+"ms\n\tRemoved "+t+" documents in "+(u-a)+"ms\nTotal Duration: "+(u-l)+"ms"),Ia.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:t})}))},t}(),bu=function(){function t(t,e){this.db=t,this.garbageCollector=function(t,e){return new wu(t,e)}(this,e)}return t.prototype.he=function(t){var e=this.de(t);return this.db.getTargetCache().getTargetCount(t).next((function(t){return e.next((function(e){return t+e}))}))},t.prototype.de=function(t){var e=0;return this.le(t,(function(t){e++})).next((function(){return e}))},t.prototype.forEachTarget=function(t,e){return this.db.getTargetCache().forEachTarget(t,e)},t.prototype.le=function(t,e){return this.we(t,(function(t,n){return e(n)}))},t.prototype.addReference=function(t,e,n){return Tu(t,n)},t.prototype.removeReference=function(t,e,n){return Tu(t,n)},t.prototype.removeTargets=function(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)},t.prototype.markPotentiallyOrphaned=function(t,e){return Tu(t,e)},t.prototype._e=function(t,e){return function(t,e){var n=!1;return cu(t).Ot((function(r){return su(t,r,e).next((function(t){return t&&(n=!0),Ia.resolve(!t)}))})).next((function(){return n}))}(t,e)},t.prototype.removeOrphanedDocuments=function(t,e){var n=this,r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],o=0;return this.we(t,(function(s,a){if(a<=e){var u=n._e(t,s).next((function(e){if(!e)return o++,r.getEntry(t,s).next((function(){return r.removeEntry(s),pu(t).delete([0,Js(s.path)])}))}));i.push(u)}})).next((function(){return Ia.waitFor(i)})).next((function(){return r.apply(t)})).next((function(){return o}))},t.prototype.removeTarget=function(t,e){var n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)},t.prototype.updateLimboDocument=function(t,e){return Tu(t,e)},t.prototype.we=function(t,e){var n,r=pu(t),i=Dr.o;return r.$t({index:fa.documentTargetsIndex},(function(t,r){var o=t[0];t[1];var s=r.path,a=r.sequenceNumber;0===o?(i!==Dr.o&&e(new hi(ea(n)),i),i=a,n=s):i=Dr.o})).next((function(){i!==Dr.o&&e(new hi(ea(n)),i)}))},t.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},t}();function Tu(t,e){return pu(t).put(function(t,e){return new fa(0,Js(t.path),e)}(e,t.currentSequenceNumber))}var Iu=function(){function t(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={}}return t.prototype.get=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],a=o[1];if(this.equalsFn(s,t))return a}},t.prototype.has=function(t){return void 0!==this.get(t)},t.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},t.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},t.prototype.forEach=function(t){zr(this.inner,(function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],a=o[1];t(s,a)}}))},t.prototype.isEmpty=function(){return Hr(this.inner)},t}(),Eu=function(){function t(){this.changes=new Iu((function(t){return t.toString()}),(function(t,e){return t.isEqual(e)})),this.changesApplied=!1}return t.prototype.getReadTime=function(t){var e=this.changes.get(t);return e?e.readTime:Gr.min()},t.prototype.addEntry=function(t,e){this.assertNotApplied(),this.changes.set(t.key,{document:t,readTime:e})},t.prototype.removeEntry=function(t,e){void 0===e&&(e=null),this.assertNotApplied(),this.changes.set(t,{document:Ni.newInvalidDocument(t),readTime:e})},t.prototype.getEntry=function(t,e){this.assertNotApplied();var n=this.changes.get(e);return void 0!==n?Ia.resolve(n.document):this.getFromCache(t,e)},t.prototype.getEntries=function(t,e){return this.getAllFromCache(t,e)},t.prototype.apply=function(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)},t.prototype.assertNotApplied=function(){},t}(),_u=function(){function t(t,e){this.R=t,this.Ut=e}return t.prototype.addEntry=function(t,e,n){return Nu(t).put(Au(e),n)},t.prototype.removeEntry=function(t,e){var n=Nu(t),r=Au(e);return n.delete(r)},t.prototype.updateMetadata=function(t,e){var n=this;return this.getMetadata(t).next((function(r){return r.byteSize+=e,n.me(t,r)}))},t.prototype.getEntry=function(t,e){var n=this;return Nu(t).get(Au(e)).next((function(t){return n.ye(e,t)}))},t.prototype.ge=function(t,e){var n=this;return Nu(t).get(Au(e)).next((function(t){return{document:n.ye(e,t),size:iu(t)}}))},t.prototype.getEntries=function(t,e){var n=this,r=es();return this.pe(t,e,(function(t,e){var i=n.ye(t,e);r=r.insert(t,i)})).next((function(){return r}))},t.prototype.Ee=function(t,e){var n=this,r=es(),i=new Yo(hi.comparator);return this.pe(t,e,(function(t,e){var o=n.ye(t,e);r=r.insert(t,o),i=i.insert(t,iu(e))})).next((function(){return{documents:r,Te:i}}))},t.prototype.pe=function(t,e,n){if(e.isEmpty())return Ia.resolve();var r=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),i=e.getIterator(),o=i.getNext();return Nu(t).$t({range:r},(function(t,e,r){for(var s=hi.fromSegments(t);o&&hi.comparator(o,s)<0;)n(o,null),o=i.getNext();o&&o.isEqual(s)&&(n(o,e),o=i.hasNext()?i.getNext():null),o?r.Ct(o.path.toArray()):r.done()})).next((function(){for(;o;)n(o,null),o=i.hasNext()?i.getNext():null}))},t.prototype.getDocumentsMatchingQuery=function(t,e,n){var r=this,i=es(),o=e.path.length+1,s={};if(n.isEqual(Gr.min())){var a=e.path.toArray();s.range=IDBKeyRange.lowerBound(a)}else{var u=e.path.toArray(),c=Ua(n);s.range=IDBKeyRange.lowerBound([u,c],!0),s.index=ca.collectionReadTimeIndex}return Nu(t).$t(s,(function(t,n,s){if(t.length===o){var a=Va(r.R,n);e.path.isPrefixOf(a.key.path)?uo(e,a)&&(i=i.insert(a.key,a)):s.done()}})).next((function(){return i}))},t.prototype.newChangeBuffer=function(t){return new Su(this,!!t&&t.trackRemovals)},t.prototype.getSize=function(t){return this.getMetadata(t).next((function(t){return t.byteSize}))},t.prototype.getMetadata=function(t){return Du(t).get(ha.key).next((function(t){return Fr(!!t),t}))},t.prototype.me=function(t,e){return Du(t).put(ha.key,e)},t.prototype.ye=function(t,e){if(e){var n=Va(this.R,e);if(!n.isNoDocument()||!n.version.isEqual(Gr.min()))return n}return Ni.newInvalidDocument(t)},t}(),Su=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Ie=e,r.trackRemovals=n,r.Ae=new Iu((function(t){return t.toString()}),(function(t,e){return t.isEqual(e)})),r}return o(e,t),e.prototype.applyChanges=function(t){var e=this,n=[],r=0,i=new Jo((function(t,e){return Ur(t.canonicalString(),e.canonicalString())}));return this.changes.forEach((function(o,s){var a=e.Ae.get(o);if(s.document.isValidDocument()){var u=qa(e.Ie.R,s.document,e.getReadTime(o));i=i.add(o.path.popLast());var c=iu(u);r+=c-a,n.push(e.Ie.addEntry(t,o,u))}else if(r-=a,e.trackRemovals){var h=qa(e.Ie.R,Ni.newNoDocument(o,Gr.min()),e.getReadTime(o));n.push(e.Ie.addEntry(t,o,h))}else n.push(e.Ie.removeEntry(t,o))})),i.forEach((function(r){n.push(e.Ie.Ut.addToCollectionParentIndex(t,r))})),n.push(this.Ie.updateMetadata(t,r)),Ia.waitFor(n)},e.prototype.getFromCache=function(t,e){var n=this;return this.Ie.ge(t,e).next((function(t){return n.Ae.set(e,t.size),t.document}))},e.prototype.getAllFromCache=function(t,e){var n=this;return this.Ie.Ee(t,e).next((function(t){var e=t.documents;return t.Te.forEach((function(t,e){n.Ae.set(t,e)})),e}))},e}(Eu);function Du(t){return Oa(t,ha.store)}function Nu(t){return Oa(t,ca.store)}function Au(t){return t.path.toArray()}var ku=function(){function t(t){this.R=t}return t.prototype.Rt=function(t,e,n,r){var i=this;Fr(n<r&&n>=0&&r<=11);var o=new Ea("createOrUpgrade",e);n<1&&r>=1&&(function(t){t.createObjectStore(ra.store)}(t),function(t){t.createObjectStore(ia.store,{keyPath:ia.keyPath}),t.createObjectStore(oa.store,{keyPath:oa.keyPath,autoIncrement:!0}).createIndex(oa.userMutationsIndex,oa.userMutationsKeyPath,{unique:!0}),t.createObjectStore(sa.store)}(t),Cu(t),function(t){t.createObjectStore(ca.store)}(t));var s=Ia.resolve();return n<3&&r>=3&&(0!==n&&(function(t){t.deleteObjectStore(fa.store),t.deleteObjectStore(la.store),t.deleteObjectStore(da.store)}(t),Cu(t)),s=s.next((function(){return function(t){var e=t.store(da.store),n=new da(0,0,Gr.min().toTimestamp(),0);return e.put(da.key,n)}(o)}))),n<4&&r>=4&&(0!==n&&(s=s.next((function(){return function(t,e){return e.store(oa.store).Nt().next((function(n){t.deleteObjectStore(oa.store),t.createObjectStore(oa.store,{keyPath:oa.keyPath,autoIncrement:!0}).createIndex(oa.userMutationsIndex,oa.userMutationsKeyPath,{unique:!0});var r=e.store(oa.store),i=n.map((function(t){return r.put(t)}));return Ia.waitFor(i)}))}(t,o)}))),s=s.next((function(){!function(t){t.createObjectStore(ya.store,{keyPath:ya.keyPath})}(t)}))),n<5&&r>=5&&(s=s.next((function(){return i.Re(o)}))),n<6&&r>=6&&(s=s.next((function(){return function(t){t.createObjectStore(ha.store)}(t),i.be(o)}))),n<7&&r>=7&&(s=s.next((function(){return i.ve(o)}))),n<8&&r>=8&&(s=s.next((function(){return i.Pe(t,o)}))),n<9&&r>=9&&(s=s.next((function(){!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){var e=t.objectStore(ca.store);e.createIndex(ca.readTimeIndex,ca.readTimeIndexPath,{unique:!1}),e.createIndex(ca.collectionReadTimeIndex,ca.collectionReadTimeIndexPath,{unique:!1})}(e)}))),n<10&&r>=10&&(s=s.next((function(){return i.Ve(o)}))),n<11&&r>=11&&(s=s.next((function(){!function(t){t.createObjectStore(ga.store,{keyPath:ga.keyPath})}(t),function(t){t.createObjectStore(va.store,{keyPath:va.keyPath})}(t)}))),s},t.prototype.be=function(t){var e=0;return t.store(ca.store).$t((function(t,n){e+=iu(n)})).next((function(){var n=new ha(e);return t.store(ha.store).put(ha.key,n)}))},t.prototype.Re=function(t){var e=this,n=t.store(ia.store),r=t.store(oa.store);return n.Nt().next((function(n){return Ia.forEach(n,(function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.Nt(oa.userMutationsIndex,i).next((function(r){return Ia.forEach(r,(function(r){Fr(r.userId===n.userId);var i=Ga(e.R,r);return ru(t,n.userId,i).next((function(){}))}))}))}))}))},t.prototype.ve=function(t){var e=t.store(fa.store),n=t.store(ca.store);return t.store(da.store).get(da.key).next((function(t){var r=[];return n.$t((function(n,i){var o=new Yr(n),s=function(t){return[0,Js(t)]}(o);r.push(e.get(s).next((function(n){return n?Ia.resolve():function(n){return e.put(new fa(0,Js(n),t.highestListenSequenceNumber))}(o)})))})).next((function(){return Ia.waitFor(r)}))}))},t.prototype.Pe=function(t,e){t.createObjectStore(pa.store,{keyPath:pa.keyPath});var n=e.store(pa.store),r=new Ja,i=function(t){if(r.add(t)){var e=t.lastSegment(),i=t.popLast();return n.put({collectionId:e,parent:Js(i)})}};return e.store(ca.store).$t({Ft:!0},(function(t,e){var n=new Yr(t);return i(n.popLast())})).next((function(){return e.store(sa.store).$t({Ft:!0},(function(t,e){t[0];var n=t[1];t[2];var r=ea(n);return i(r.popLast())}))}))},t.prototype.Ve=function(t){var e=this,n=t.store(la.store);return n.$t((function(t,r){var i=Qa(r),o=za(e.R,i);return n.put(o)}))},t}();function Cu(t){t.createObjectStore(fa.store,{keyPath:fa.keyPath}).createIndex(fa.documentTargetsIndex,fa.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(la.store,{keyPath:la.keyPath}).createIndex(la.queryTargetsIndexName,la.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(da.store)}var xu="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Ru=function(){function t(e,n,r,i,o,s,a,u,c,h){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.Se=o,this.window=s,this.document=a,this.De=c,this.Ce=h,this.Ne=null,this.xe=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ke=null,this.inForeground=!1,this.Fe=null,this.$e=null,this.Oe=Number.NEGATIVE_INFINITY,this.Me=function(t){return Promise.resolve()},!t.yt())throw new Ar(Nr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new bu(this,i),this.Le=n+"main",this.R=new Ma(u),this.Be=new _a(this.Le,11,new ku(this.R)),this.qe=new lu(this.referenceDelegate,this.R),this.Ut=new Za,this.Ue=function(t,e){return new _u(t,e)}(this.R,this.Ut),this.Ke=new Wa,this.window&&this.window.localStorage?this.Qe=this.window.localStorage:(this.Qe=null,!1===h&&Rr("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}return t.prototype.start=function(){var t=this;return this.je().then((function(){if(!t.isPrimary&&!t.allowTabSynchronization)throw new Ar(Nr.FAILED_PRECONDITION,xu);return t.We(),t.Ge(),t.ze(),t.runTransaction("getHighestListenSequenceNumber","readonly",(function(e){return t.qe.getHighestSequenceNumber(e)}))})).then((function(e){t.Ne=new Dr(e,t.De)})).then((function(){t.xe=!0})).catch((function(e){return t.Be&&t.Be.close(),Promise.reject(e)}))},t.prototype.He=function(t){var e=this;return this.Me=function(n){return s(e,void 0,void 0,(function(){return a(this,(function(e){return this.started?[2,t(n)]:[2]}))}))},t(this.isPrimary)},t.prototype.setDatabaseDeletedListener=function(t){var e=this;this.Be.vt((function(n){return s(e,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return null===n.newVersion?[4,t()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))}))},t.prototype.setNetworkEnabled=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Se.enqueueAndForget((function(){return s(e,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return this.started?[4,this.je()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))})))},t.prototype.je=function(){var t=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(function(e){return Pu(e).put(new ya(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next((function(){if(t.isPrimary)return t.Je(e).next((function(e){e||(t.isPrimary=!1,t.Se.enqueueRetryable((function(){return t.Me(!1)})))}))})).next((function(){return t.Ye(e)})).next((function(n){return t.isPrimary&&!n?t.Xe(e).next((function(){return!1})):!!n&&t.Ze(e).next((function(){return!0}))}))})).catch((function(e){if(Na(e))return xr("IndexedDbPersistence","Failed to extend owner lease: ",e),t.isPrimary;if(!t.allowTabSynchronization)throw e;return xr("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1})).then((function(e){t.isPrimary!==e&&t.Se.enqueueRetryable((function(){return t.Me(e)})),t.isPrimary=e}))},t.prototype.Je=function(t){var e=this;return Ou(t).get(ra.key).next((function(t){return Ia.resolve(e.tn(t))}))},t.prototype.en=function(t){return Pu(t).delete(this.clientId)},t.prototype.nn=function(){return s(this,void 0,void 0,(function(){var t,e,n,r,i=this;return a(this,(function(o){switch(o.label){case 0:return!this.isPrimary||this.sn(this.Oe,18e5)?[3,2]:(this.Oe=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(function(t){var e=Oa(t,ya.store);return e.Nt().next((function(t){var n=i.rn(t,18e5),r=t.filter((function(t){return-1===n.indexOf(t)}));return Ia.forEach(r,(function(t){return e.delete(t.clientId)})).next((function(){return r}))}))})).catch((function(){return[]}))]);case 1:if(t=o.sent(),this.Qe)for(e=0,n=t;e<n.length;e++)r=n[e],this.Qe.removeItem(this.on(r.clientId));o.label=2;case 2:return[2]}}))}))},t.prototype.ze=function(){var t=this;this.$e=this.Se.enqueueAfterDelay("client_metadata_refresh",4e3,(function(){return t.je().then((function(){return t.nn()})).then((function(){return t.ze()}))}))},t.prototype.tn=function(t){return!!t&&t.ownerId===this.clientId},t.prototype.Ye=function(t){var e=this;return this.Ce?Ia.resolve(!0):Ou(t).get(ra.key).next((function(n){if(null!==n&&e.sn(n.leaseTimestampMs,5e3)&&!e.cn(n.ownerId)){if(e.tn(n)&&e.networkEnabled)return!0;if(!e.tn(n)){if(!n.allowTabSynchronization)throw new Ar(Nr.FAILED_PRECONDITION,xu);return!1}}return!(!e.networkEnabled||!e.inForeground)||Pu(t).Nt().next((function(t){return void 0===e.rn(t,5e3).find((function(t){if(e.clientId!==t.clientId){var n=!e.networkEnabled&&t.networkEnabled,r=!e.inForeground&&t.inForeground,i=e.networkEnabled===t.networkEnabled;if(n||r&&i)return!0}return!1}))}))})).next((function(t){return e.isPrimary!==t&&xr("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t}))},t.prototype.shutdown=function(){return s(this,void 0,void 0,(function(){var t=this;return a(this,(function(e){switch(e.label){case 0:return this.xe=!1,this.un(),this.$e&&(this.$e.cancel(),this.$e=null),this.an(),this.hn(),[4,this.Be.runTransaction("shutdown","readwrite",[ra.store,ya.store],(function(e){var n=new Ra(e,Dr.o);return t.Xe(n).next((function(){return t.en(n)}))}))];case 1:return e.sent(),this.Be.close(),this.ln(),[2]}}))}))},t.prototype.rn=function(t,e){var n=this;return t.filter((function(t){return n.sn(t.updateTimeMs,e)&&!n.cn(t.clientId)}))},t.prototype.fn=function(){var t=this;return this.runTransaction("getActiveClients","readonly",(function(e){return Pu(e).Nt().next((function(e){return t.rn(e,18e5).map((function(t){return t.clientId}))}))}))},Object.defineProperty(t.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.getMutationQueue=function(t){return ou.Qt(t,this.R,this.Ut,this.referenceDelegate)},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getBundleCache=function(){return this.Ke},t.prototype.runTransaction=function(t,e,n){var r=this;xr("IndexedDbPersistence","Starting transaction:",t);var i,o="readonly"===e?"readonly":"readwrite";return this.Be.runTransaction(t,o,ma,(function(o){return i=new Ra(o,r.Ne?r.Ne.next():Dr.o),"readwrite-primary"===e?r.Je(i).next((function(t){return!!t||r.Ye(i)})).next((function(e){if(!e)throw Rr("Failed to obtain primary lease for action '"+t+"'."),r.isPrimary=!1,r.Se.enqueueRetryable((function(){return r.Me(!1)})),new Ar(Nr.FAILED_PRECONDITION,wa);return n(i)})).next((function(t){return r.Ze(i).next((function(){return t}))})):r.dn(i).next((function(){return n(i)}))})).then((function(t){return i.raiseOnCommittedEvent(),t}))},t.prototype.dn=function(t){var e=this;return Ou(t).get(ra.key).next((function(t){if(null!==t&&e.sn(t.leaseTimestampMs,5e3)&&!e.cn(t.ownerId)&&!e.tn(t)&&!(e.Ce||e.allowTabSynchronization&&t.allowTabSynchronization))throw new Ar(Nr.FAILED_PRECONDITION,xu)}))},t.prototype.Ze=function(t){var e=new ra(this.clientId,this.allowTabSynchronization,Date.now());return Ou(t).put(ra.key,e)},t.yt=function(){return _a.yt()},t.prototype.Xe=function(t){var e=this,n=Ou(t);return n.get(ra.key).next((function(t){return e.tn(t)?(xr("IndexedDbPersistence","Releasing primary lease."),n.delete(ra.key)):Ia.resolve()}))},t.prototype.sn=function(t,e){var n=Date.now();return!(t<n-e||t>n&&(Rr("Detected an update time that is in the future: "+t+" > "+n),1))},t.prototype.We=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Fe=function(){t.Se.enqueueAndForget((function(){return t.inForeground="visible"===t.document.visibilityState,t.je()}))},this.document.addEventListener("visibilitychange",this.Fe),this.inForeground="visible"===this.document.visibilityState)},t.prototype.an=function(){this.Fe&&(this.document.removeEventListener("visibilitychange",this.Fe),this.Fe=null)},t.prototype.Ge=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.ke=function(){e.un(),(0,c.G6)()&&navigator.appVersion.match("Version/14")&&e.Se.enterRestrictedMode(!0),e.Se.enqueueAndForget((function(){return e.shutdown()}))},this.window.addEventListener("pagehide",this.ke))},t.prototype.hn=function(){this.ke&&(this.window.removeEventListener("pagehide",this.ke),this.ke=null)},t.prototype.cn=function(t){var e;try{var n=null!==(null===(e=this.Qe)||void 0===e?void 0:e.getItem(this.on(t)));return xr("IndexedDbPersistence","Client '"+t+"' "+(n?"is":"is not")+" zombied in LocalStorage"),n}catch(t){return Rr("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},t.prototype.un=function(){if(this.Qe)try{this.Qe.setItem(this.on(this.clientId),String(Date.now()))}catch(t){Rr("Failed to set zombie client id.",t)}},t.prototype.ln=function(){if(this.Qe)try{this.Qe.removeItem(this.on(this.clientId))}catch(t){}},t.prototype.on=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},t}();function Ou(t){return Oa(t,ra.store)}function Pu(t){return Oa(t,ya.store)}function Lu(t,e){var n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}var Fu=function(t,e){this.progress=t,this.wn=e},Mu=function(){function t(t,e,n){this.Ue=t,this._n=e,this.Ut=n}return t.prototype.mn=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKey(t,e).next((function(r){return n.yn(t,e,r)}))},t.prototype.yn=function(t,e,n){return this.Ue.getEntry(t,e).next((function(t){for(var e=0,r=n;e<r.length;e++)r[e].applyToLocalView(t);return t}))},t.prototype.gn=function(t,e){t.forEach((function(t,n){for(var r=0,i=e;r<i.length;r++)i[r].applyToLocalView(n)}))},t.prototype.pn=function(t,e){var n=this;return this.Ue.getEntries(t,e).next((function(e){return n.En(t,e).next((function(){return e}))}))},t.prototype.En=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKeys(t,e).next((function(t){return n.gn(e,t)}))},t.prototype.getDocumentsMatchingQuery=function(t,e,n){return function(t){return hi.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.Tn(t,e.path):eo(e)?this.In(t,e,n):this.An(t,e,n)},t.prototype.Tn=function(t,e){return this.mn(t,new hi(e)).next((function(t){var e=rs();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e}))},t.prototype.In=function(t,e,n){var r=this,i=e.collectionGroup,o=rs();return this.Ut.getCollectionParents(t,i).next((function(s){return Ia.forEach(s,(function(s){var a=function(t,e){return new Wi(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,s.child(i));return r.An(t,a,n).next((function(t){t.forEach((function(t,e){o=o.insert(t,e)}))}))})).next((function(){return o}))}))},t.prototype.An=function(t,e,n){var r,i,o=this;return this.Ue.getDocumentsMatchingQuery(t,e,n).next((function(n){return r=n,o._n.getAllMutationBatchesAffectingQuery(t,e)})).next((function(e){return i=e,o.Rn(t,i,r).next((function(t){r=t;for(var e=0,n=i;e<n.length;e++)for(var o=n[e],s=0,a=o.mutations;s<a.length;s++){var u=a[s],c=u.key,h=r.get(c);null==h&&(h=Ni.newInvalidDocument(c),r=r.insert(c,h)),Oo(u,h,o.localWriteTime),h.isFoundDocument()||(r=r.remove(c))}}))})).next((function(){return r.forEach((function(t,n){uo(e,n)||(r=r.remove(t))})),r}))},t.prototype.Rn=function(t,e,n){for(var r=as(),i=0,o=e;i<o.length;i++)for(var s=0,a=o[i].mutations;s<a.length;s++){var u=a[s];u instanceof Vo&&null===n.get(u.key)&&(r=r.add(u.key))}var c=n;return this.Ue.getEntries(t,r).next((function(t){return t.forEach((function(t,e){e.isFoundDocument()&&(c=c.insert(t,e))})),c}))},t}(),Vu=function(){function t(t,e,n,r){this.targetId=t,this.fromCache=e,this.bn=n,this.vn=r}return t.Pn=function(e,n){for(var r=as(),i=as(),o=0,s=n.docChanges;o<s.length;o++){var a=s[o];switch(a.type){case 0:r=r.add(a.doc.key);break;case 1:i=i.add(a.doc.key)}}return new t(e,n.fromCache,r,i)},t}(),qu=function(){function t(){}return t.prototype.Vn=function(t){this.Sn=t},t.prototype.getDocumentsMatchingQuery=function(t,e,n,r){var i=this;return function(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}(e)||n.isEqual(Gr.min())?this.Dn(t,e):this.Sn.pn(t,r).next((function(o){var s=i.Cn(e,o);return($i(e)||Ji(e))&&i.Nn(e.limitType,s,r,n)?i.Dn(t,e):(Cr()<=h.in.DEBUG&&xr("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),ao(e)),i.Sn.getDocumentsMatchingQuery(t,e,n).next((function(t){return s.forEach((function(e){t=t.insert(e.key,e)})),t})))}))},t.prototype.Cn=function(t,e){var n=new Jo(co(t));return e.forEach((function(e,r){uo(t,r)&&(n=n.add(r))})),n},t.prototype.Nn=function(t,e,n,r){if(n.size!==e.size)return!0;var i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)},t.prototype.Dn=function(t,e){return Cr()<=h.in.DEBUG&&xr("QueryEngine","Using full collection scan to execute query:",ao(e)),this.Sn.getDocumentsMatchingQuery(t,e,Gr.min())},t}(),Uu=function(){function t(t,e,n,r){this.persistence=t,this.xn=e,this.R=r,this.kn=new Yo(Ur),this.Fn=new Iu((function(t){return Ci(t)}),xi),this.$n=Gr.min(),this._n=t.getMutationQueue(n),this.On=t.getRemoteDocumentCache(),this.qe=t.getTargetCache(),this.Mn=new Mu(this.On,this._n,this.persistence.getIndexManager()),this.Ke=t.getBundleCache(),this.xn.Vn(this.Mn)}return t.prototype.collectGarbage=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",(function(n){return t.collect(n,e.kn)}))},t}();function ju(t,e,n,r){return new Uu(t,e,n,r)}function Bu(t,e){return s(this,void 0,void 0,(function(){var n,r,i,o;return a(this,(function(s){switch(s.label){case 0:return n=Mr(t),r=n._n,i=n.Mn,[4,n.persistence.runTransaction("Handle user change","readonly",(function(t){var o;return n._n.getAllMutationBatches(t).next((function(s){return o=s,r=n.persistence.getMutationQueue(e),i=new Mu(n.On,r,n.persistence.getIndexManager()),r.getAllMutationBatches(t)})).next((function(e){for(var n=[],r=[],s=as(),a=0,u=o;a<u.length;a++){var c=u[a];n.push(c.batchId);for(var h=0,l=c.mutations;h<l.length;h++){var f=l[h];s=s.add(f.key)}}for(var d=0,p=e;d<p.length;d++){var y=p[d];r.push(y.batchId);for(var g=0,v=y.mutations;g<v.length;g++){var m=v[g];s=s.add(m.key)}}return i.pn(t,s).next((function(t){return{Ln:t,removedBatchIds:n,addedBatchIds:r}}))}))}))];case 1:return o=s.sent(),[2,(n._n=r,n.Mn=i,n.xn.Vn(n.Mn),o)]}}))}))}function Ku(t,e){var n=Mr(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(function(t){var r=e.batch.keys(),i=n.On.newChangeBuffer({trackRemovals:!0});return function(t,e,n,r){var i=n.batch,o=i.keys(),s=Ia.resolve();return o.forEach((function(t){s=s.next((function(){return r.getEntry(e,t)})).next((function(e){var o=n.docVersions.get(t);Fr(null!==o),e.version.compareTo(o)<0&&(i.applyToRemoteDocument(e,n),e.isValidDocument()&&r.addEntry(e,n.commitVersion))}))})),s.next((function(){return t._n.removeMutationBatch(e,i)}))}(n,t,e,i).next((function(){return i.apply(t)})).next((function(){return n._n.performConsistencyCheck(t)})).next((function(){return n.Mn.pn(t,r)}))}))}function Gu(t){var e=Mr(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(function(t){return e.qe.getLastRemoteSnapshotVersion(t)}))}function Qu(t,e){var n=Mr(t),r=e.snapshotVersion,i=n.kn;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(function(t){var o=n.On.newChangeBuffer({trackRemovals:!0});i=n.kn;var s=[];e.targetChanges.forEach((function(e,o){var a=i.get(o);if(a){s.push(n.qe.removeMatchingKeys(t,e.removedDocuments,o).next((function(){return n.qe.addMatchingKeys(t,e.addedDocuments,o)})));var u=e.resumeToken;if(u.approximateByteSize()>0){var c=a.withResumeToken(u,r).withSequenceNumber(t.currentSequenceNumber);i=i.insert(o,c),function(t,e,n){return Fr(e.resumeToken.approximateByteSize()>0),0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(a,c,e)&&s.push(n.qe.updateTargetData(t,c))}}}));var a=es();if(e.documentUpdates.forEach((function(r,i){e.resolvedLimboDocuments.has(r)&&s.push(n.persistence.referenceDelegate.updateLimboDocument(t,r))})),s.push(zu(t,o,e.documentUpdates,r,void 0).next((function(t){a=t}))),!r.isEqual(Gr.min())){var u=n.qe.getLastRemoteSnapshotVersion(t).next((function(e){return n.qe.setTargetsMetadata(t,t.currentSequenceNumber,r)}));s.push(u)}return Ia.waitFor(s).next((function(){return o.apply(t)})).next((function(){return n.Mn.En(t,a)})).next((function(){return a}))})).then((function(t){return n.kn=i,t}))}function zu(t,e,n,r,i){var o=as();return n.forEach((function(t){return o=o.add(t)})),e.getEntries(t,o).next((function(t){var o=es();return n.forEach((function(n,s){var a=t.get(n),u=(null==i?void 0:i.get(n))||r;s.isNoDocument()&&s.version.isEqual(Gr.min())?(e.removeEntry(n,u),o=o.insert(n,s)):!a.isValidDocument()||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(e.addEntry(s,u),o=o.insert(n,s)):xr("LocalStore","Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",s.version)})),o}))}function Hu(t,e){var n=Mr(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(function(t){return void 0===e&&(e=-1),n._n.getNextMutationBatchAfterBatchId(t,e)}))}function Wu(t,e){var n=Mr(t);return n.persistence.runTransaction("Allocate target","readwrite",(function(t){var r;return n.qe.getTargetData(t,e).next((function(i){return i?(r=i,Ia.resolve(r)):n.qe.allocateTargetId(t).next((function(i){return r=new Fa(e,i,0,t.currentSequenceNumber),n.qe.addTargetData(t,r).next((function(){return r}))}))}))})).then((function(t){var r=n.kn.get(t.targetId);return(null===r||t.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.kn=n.kn.insert(t.targetId,t),n.Fn.set(e,t.targetId)),t}))}function Yu(t,e,n){return s(this,void 0,void 0,(function(){var r,i,o,s;return a(this,(function(a){switch(a.label){case 0:r=Mr(t),i=r.kn.get(e),o=n?"readwrite":"readwrite-primary",a.label=1;case 1:return a.trys.push([1,4,,5]),n?[3,3]:[4,r.persistence.runTransaction("Release target",o,(function(t){return r.persistence.referenceDelegate.removeTarget(t,i)}))];case 2:a.sent(),a.label=3;case 3:return[3,5];case 4:if(!Na(s=a.sent()))throw s;return xr("LocalStore","Failed to update sequence numbers for target "+e+": "+s),[3,5];case 5:return r.kn=r.kn.remove(e),r.Fn.delete(i.target),[2]}}))}))}function Xu(t,e,n){var r=Mr(t),i=Gr.min(),o=as();return r.persistence.runTransaction("Execute query","readonly",(function(t){return function(t,e,n){var r=Mr(t),i=r.Fn.get(n);return void 0!==i?Ia.resolve(r.kn.get(i)):r.qe.getTargetData(e,n)}(r,t,ro(e)).next((function(e){if(e)return i=e.lastLimboFreeSnapshotVersion,r.qe.getMatchingKeysForTargetId(t,e.targetId).next((function(t){o=t}))})).next((function(){return r.xn.getDocumentsMatchingQuery(t,e,n?i:Gr.min(),n?o:as())})).next((function(t){return{documents:t,Bn:o}}))}))}function $u(t,e){var n=Mr(t),r=Mr(n.qe),i=n.kn.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",(function(t){return r.lt(t,e).next((function(t){return t?t.target:null}))}))}function Ju(t){var e=Mr(t);return e.persistence.runTransaction("Get new document changes","readonly",(function(t){return function(t,e,n){var r=Mr(t),i=es(),o=Ua(n),s=Nu(e),a=IDBKeyRange.lowerBound(o,!0);return s.$t({index:ca.readTimeIndex,range:a},(function(t,e){var n=Va(r.R,e);i=i.insert(n.key,n),o=e.readTime})).next((function(){return{wn:i,readTime:ja(o)}}))}(e.On,t,e.$n)})).then((function(t){var n=t.wn,r=t.readTime;return e.$n=r,n}))}function Zu(t){return s(this,void 0,void 0,(function(){var e;return a(this,(function(n){return[2,(e=Mr(t)).persistence.runTransaction("Synchronize last document change read time","readonly",(function(t){return function(t){var e=Nu(t),n=Gr.min();return e.$t({index:ca.readTimeIndex,reverse:!0},(function(t,e,r){e.readTime&&(n=ja(e.readTime)),r.done()})).next((function(){return n}))}(t)})).then((function(t){e.$n=t}))]}))}))}function tc(t,e,n,r){return s(this,void 0,void 0,(function(){var i,o,s,u,c,h,l,f,d,p;return a(this,(function(a){switch(a.label){case 0:for(i=Mr(t),o=as(),s=es(),u=os(),c=0,h=n;c<h.length;c++)l=h[c],f=e.qn(l.metadata.name),l.document&&(o=o.add(f)),s=s.insert(f,e.Un(l)),u=u.insert(f,e.Kn(l.metadata.readTime));return d=i.On.newChangeBuffer({trackRemovals:!0}),[4,Wu(i,function(t){return ro(Xi(Yr.fromString("__bundle__/docs/"+t)))}(r))];case 1:return p=a.sent(),[2,i.persistence.runTransaction("Apply bundle documents","readwrite",(function(t){return zu(t,d,s,Gr.min(),u).next((function(e){return d.apply(t),e})).next((function(e){return i.qe.removeMatchingKeysForTargetId(t,p.targetId).next((function(){return i.qe.addMatchingKeys(t,o,p.targetId)})).next((function(){return i.Mn.En(t,e)})).next((function(){return e}))}))}))]}}))}))}function ec(t,e,n){return void 0===n&&(n=as()),s(this,void 0,void 0,(function(){var r,i;return a(this,(function(o){switch(o.label){case 0:return[4,Wu(t,ro(Ha(e.bundledQuery)))];case 1:return r=o.sent(),[2,(i=Mr(t)).persistence.runTransaction("Save named query","readwrite",(function(t){var o=Ss(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return i.Ke.saveNamedQuery(t,e);var s=r.withResumeToken(Zr.EMPTY_BYTE_STRING,o);return i.kn=i.kn.insert(s.targetId,s),i.qe.updateTargetData(t,s).next((function(){return i.qe.removeMatchingKeysForTargetId(t,r.targetId)})).next((function(){return i.qe.addMatchingKeys(t,n,r.targetId)})).next((function(){return i.Ke.saveNamedQuery(t,e)}))}))]}}))}))}var nc=function(){function t(t){this.R=t,this.Qn=new Map,this.jn=new Map}return t.prototype.getBundleMetadata=function(t,e){return Ia.resolve(this.Qn.get(e))},t.prototype.saveBundleMetadata=function(t,e){var n;return this.Qn.set(e.id,{id:(n=e).id,version:n.version,createTime:Ss(n.createTime)}),Ia.resolve()},t.prototype.getNamedQuery=function(t,e){return Ia.resolve(this.jn.get(e))},t.prototype.saveNamedQuery=function(t,e){return this.jn.set(e.name,function(t){return{name:t.name,query:Ha(t.bundledQuery),readTime:Ss(t.readTime)}}(e)),Ia.resolve()},t}(),rc=function(){function t(){this.Wn=new Jo(ic.Gn),this.zn=new Jo(ic.Hn)}return t.prototype.isEmpty=function(){return this.Wn.isEmpty()},t.prototype.addReference=function(t,e){var n=new ic(t,e);this.Wn=this.Wn.add(n),this.zn=this.zn.add(n)},t.prototype.Jn=function(t,e){var n=this;t.forEach((function(t){return n.addReference(t,e)}))},t.prototype.removeReference=function(t,e){this.Yn(new ic(t,e))},t.prototype.Xn=function(t,e){var n=this;t.forEach((function(t){return n.removeReference(t,e)}))},t.prototype.Zn=function(t){var e=this,n=new hi(new Yr([])),r=new ic(n,t),i=new ic(n,t+1),o=[];return this.zn.forEachInRange([r,i],(function(t){e.Yn(t),o.push(t.key)})),o},t.prototype.ts=function(){var t=this;this.Wn.forEach((function(e){return t.Yn(e)}))},t.prototype.Yn=function(t){this.Wn=this.Wn.delete(t),this.zn=this.zn.delete(t)},t.prototype.es=function(t){var e=new hi(new Yr([])),n=new ic(e,t),r=new ic(e,t+1),i=as();return this.zn.forEachInRange([n,r],(function(t){i=i.add(t.key)})),i},t.prototype.containsKey=function(t){var e=new ic(t,0),n=this.Wn.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)},t}(),ic=function(){function t(t,e){this.key=t,this.ns=e}return t.Gn=function(t,e){return hi.comparator(t.key,e.key)||Ur(t.ns,e.ns)},t.Hn=function(t,e){return Ur(t.ns,e.ns)||hi.comparator(t.key,e.key)},t}(),oc=function(){function t(t,e){this.Ut=t,this.referenceDelegate=e,this._n=[],this.ss=1,this.rs=new Jo(ic.Gn)}return t.prototype.checkEmpty=function(t){return Ia.resolve(0===this._n.length)},t.prototype.addMutationBatch=function(t,e,n,r){var i=this.ss;this.ss++,this._n.length>0&&this._n[this._n.length-1];var o=new Pa(i,e,n,r);this._n.push(o);for(var s=0,a=r;s<a.length;s++){var u=a[s];this.rs=this.rs.add(new ic(u.key,i)),this.Ut.addToCollectionParentIndex(t,u.key.path.popLast())}return Ia.resolve(o)},t.prototype.lookupMutationBatch=function(t,e){return Ia.resolve(this.os(e))},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=e+1,r=this.cs(n),i=r<0?0:r;return Ia.resolve(this._n.length>i?this._n[i]:null)},t.prototype.getHighestUnacknowledgedBatchId=function(){return Ia.resolve(0===this._n.length?-1:this.ss-1)},t.prototype.getAllMutationBatches=function(t){return Ia.resolve(this._n.slice())},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=new ic(e,0),i=new ic(e,Number.POSITIVE_INFINITY),o=[];return this.rs.forEachInRange([r,i],(function(t){var e=n.os(t.ns);o.push(e)})),Ia.resolve(o)},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new Jo(Ur);return e.forEach((function(t){var e=new ic(t,0),i=new ic(t,Number.POSITIVE_INFINITY);n.rs.forEachInRange([e,i],(function(t){r=r.add(t.ns)}))})),Ia.resolve(this.us(r))},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=e.path,r=n.length+1,i=n;hi.isDocumentKey(i)||(i=i.child(""));var o=new ic(new hi(i),0),s=new Jo(Ur);return this.rs.forEachWhile((function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(s=s.add(t.ns)),!0)}),o),Ia.resolve(this.us(s))},t.prototype.us=function(t){var e=this,n=[];return t.forEach((function(t){var r=e.os(t);null!==r&&n.push(r)})),n},t.prototype.removeMutationBatch=function(t,e){var n=this;Fr(0===this.hs(e.batchId,"removed")),this._n.shift();var r=this.rs;return Ia.forEach(e.mutations,(function(i){var o=new ic(i.key,e.batchId);return r=r.delete(o),n.referenceDelegate.markPotentiallyOrphaned(t,i.key)})).next((function(){n.rs=r}))},t.prototype.Gt=function(t){},t.prototype.containsKey=function(t,e){var n=new ic(e,0),r=this.rs.firstAfterOrEqual(n);return Ia.resolve(e.isEqual(r&&r.key))},t.prototype.performConsistencyCheck=function(t){return this._n.length,Ia.resolve()},t.prototype.hs=function(t,e){return this.cs(t)},t.prototype.cs=function(t){return 0===this._n.length?0:t-this._n[0].batchId},t.prototype.os=function(t){var e=this.cs(t);return e<0||e>=this._n.length?null:this._n[e]},t}(),sc=function(){function t(t,e){this.Ut=t,this.ls=e,this.docs=new Yo(hi.comparator),this.size=0}return t.prototype.addEntry=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.ls(e);return this.docs=this.docs.insert(r,{document:e.clone(),size:s,readTime:n}),this.size+=s-o,this.Ut.addToCollectionParentIndex(t,r.path.popLast())},t.prototype.removeEntry=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},t.prototype.getEntry=function(t,e){var n=this.docs.get(e);return Ia.resolve(n?n.document.clone():Ni.newInvalidDocument(e))},t.prototype.getEntries=function(t,e){var n=this,r=es();return e.forEach((function(t){var e=n.docs.get(t);r=r.insert(t,e?e.document.clone():Ni.newInvalidDocument(t))})),Ia.resolve(r)},t.prototype.getDocumentsMatchingQuery=function(t,e,n){for(var r=es(),i=new hi(e.path.child("")),o=this.docs.getIteratorFrom(i);o.hasNext();){var s=o.getNext(),a=s.key,u=s.value,c=u.document,h=u.readTime;if(!e.path.isPrefixOf(a.path))break;h.compareTo(n)<=0||uo(e,c)&&(r=r.insert(c.key,c.clone()))}return Ia.resolve(r)},t.prototype.fs=function(t,e){return Ia.forEach(this.docs,(function(t){return e(t)}))},t.prototype.newChangeBuffer=function(t){return new ac(this)},t.prototype.getSize=function(t){return Ia.resolve(this.size)},t}(),ac=function(t){function e(e){var n=this;return(n=t.call(this)||this).Ie=e,n}return o(e,t),e.prototype.applyChanges=function(t){var e=this,n=[];return this.changes.forEach((function(r,i){i.document.isValidDocument()?n.push(e.Ie.addEntry(t,i.document,e.getReadTime(r))):e.Ie.removeEntry(r)})),Ia.waitFor(n)},e.prototype.getFromCache=function(t,e){return this.Ie.getEntry(t,e)},e.prototype.getAllFromCache=function(t,e){return this.Ie.getEntries(t,e)},e}(Eu),uc=function(){function t(t){this.persistence=t,this.ds=new Iu((function(t){return Ci(t)}),xi),this.lastRemoteSnapshotVersion=Gr.min(),this.highestTargetId=0,this.ws=0,this._s=new rc,this.targetCount=0,this.ys=hu.Jt()}return t.prototype.forEachTarget=function(t,e){return this.ds.forEach((function(t,n){return e(n)})),Ia.resolve()},t.prototype.getLastRemoteSnapshotVersion=function(t){return Ia.resolve(this.lastRemoteSnapshotVersion)},t.prototype.getHighestSequenceNumber=function(t){return Ia.resolve(this.ws)},t.prototype.allocateTargetId=function(t){return this.highestTargetId=this.ys.next(),Ia.resolve(this.highestTargetId)},t.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.ws&&(this.ws=e),Ia.resolve()},t.prototype.te=function(t){this.ds.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.ys=new hu(e),this.highestTargetId=e),t.sequenceNumber>this.ws&&(this.ws=t.sequenceNumber)},t.prototype.addTargetData=function(t,e){return this.te(e),this.targetCount+=1,Ia.resolve()},t.prototype.updateTargetData=function(t,e){return this.te(e),Ia.resolve()},t.prototype.removeTargetData=function(t,e){return this.ds.delete(e.target),this._s.Zn(e.targetId),this.targetCount-=1,Ia.resolve()},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return this.ds.forEach((function(s,a){a.sequenceNumber<=e&&null===n.get(a.targetId)&&(r.ds.delete(s),o.push(r.removeMatchingKeysForTargetId(t,a.targetId)),i++)})),Ia.waitFor(o).next((function(){return i}))},t.prototype.getTargetCount=function(t){return Ia.resolve(this.targetCount)},t.prototype.getTargetData=function(t,e){var n=this.ds.get(e)||null;return Ia.resolve(n)},t.prototype.addMatchingKeys=function(t,e,n){return this._s.Jn(e,n),Ia.resolve()},t.prototype.removeMatchingKeys=function(t,e,n){this._s.Xn(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach((function(e){i.push(r.markPotentiallyOrphaned(t,e))})),Ia.waitFor(i)},t.prototype.removeMatchingKeysForTargetId=function(t,e){return this._s.Zn(e),Ia.resolve()},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=this._s.es(e);return Ia.resolve(n)},t.prototype.containsKey=function(t,e){return Ia.resolve(this._s.containsKey(e))},t}(),cc=function(){function t(t,e){var n=this;this.gs={},this.Ne=new Dr(0),this.xe=!1,this.xe=!0,this.referenceDelegate=t(this),this.qe=new uc(this),this.Ut=new $a,this.Ue=function(t,e){return new sc(t,(function(t){return n.referenceDelegate.ps(t)}))}(this.Ut),this.R=new Ma(e),this.Ke=new nc(this.R)}return t.prototype.start=function(){return Promise.resolve()},t.prototype.shutdown=function(){return this.xe=!1,Promise.resolve()},Object.defineProperty(t.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.setDatabaseDeletedListener=function(){},t.prototype.setNetworkEnabled=function(){},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getMutationQueue=function(t){var e=this.gs[t.toKey()];return e||(e=new oc(this.Ut,this.referenceDelegate),this.gs[t.toKey()]=e),e},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getBundleCache=function(){return this.Ke},t.prototype.runTransaction=function(t,e,n){var r=this;xr("MemoryPersistence","Starting transaction:",t);var i=new hc(this.Ne.next());return this.referenceDelegate.Es(),n(i).next((function(t){return r.referenceDelegate.Ts(i).next((function(){return t}))})).toPromise().then((function(t){return i.raiseOnCommittedEvent(),t}))},t.prototype.Is=function(t,e){return Ia.or(Object.values(this.gs).map((function(n){return function(){return n.containsKey(t,e)}})))},t}(),hc=function(t){function e(e){var n=this;return(n=t.call(this)||this).currentSequenceNumber=e,n}return o(e,t),e}(ba),lc=function(){function t(t){this.persistence=t,this.As=new rc,this.Rs=null}return t.bs=function(e){return new t(e)},Object.defineProperty(t.prototype,"vs",{get:function(){if(this.Rs)return this.Rs;throw Lr()},enumerable:!1,configurable:!0}),t.prototype.addReference=function(t,e,n){return this.As.addReference(n,e),this.vs.delete(n.toString()),Ia.resolve()},t.prototype.removeReference=function(t,e,n){return this.As.removeReference(n,e),this.vs.add(n.toString()),Ia.resolve()},t.prototype.markPotentiallyOrphaned=function(t,e){return this.vs.add(e.toString()),Ia.resolve()},t.prototype.removeTarget=function(t,e){var n=this;this.As.Zn(e.targetId).forEach((function(t){return n.vs.add(t.toString())}));var r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next((function(t){t.forEach((function(t){return n.vs.add(t.toString())}))})).next((function(){return r.removeTargetData(t,e)}))},t.prototype.Es=function(){this.Rs=new Set},t.prototype.Ts=function(t){var e=this,n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Ia.forEach(this.vs,(function(r){var i=hi.fromPath(r);return e.Ps(t,i).next((function(t){t||n.removeEntry(i)}))})).next((function(){return e.Rs=null,n.apply(t)}))},t.prototype.updateLimboDocument=function(t,e){var n=this;return this.Ps(t,e).next((function(t){t?n.vs.delete(e.toString()):n.vs.add(e.toString())}))},t.prototype.ps=function(t){return 0},t.prototype.Ps=function(t,e){var n=this;return Ia.or([function(){return Ia.resolve(n.As.containsKey(e))},function(){return n.persistence.getTargetCache().containsKey(t,e)},function(){return n.persistence.Is(t,e)}])},t}(),fc=function(){function t(t){this.uid=t}return t.prototype.isAuthenticated=function(){return null!=this.uid},t.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},t.prototype.isEqual=function(t){return t.uid===this.uid},t}();function dc(t,e){return"firestore_clients_"+t+"_"+e}function pc(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.isAuthenticated()&&(r+="_"+e.uid),r}function yc(t,e){return"firestore_targets_"+t+"_"+e}fc.UNAUTHENTICATED=new fc(null),fc.GOOGLE_CREDENTIALS=new fc("google-credentials-uid"),fc.FIRST_PARTY=new fc("first-party-uid"),fc.MOCK_USER=new fc("mock-user");var gc=function(){function t(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}return t.Vs=function(e,n,r){var i,o=JSON.parse(r),s="object"==typeof o&&-1!==["pending","acknowledged","rejected"].indexOf(o.state)&&(void 0===o.error||"object"==typeof o.error);return s&&o.error&&(s="string"==typeof o.error.message&&"string"==typeof o.error.code)&&(i=new Ar(o.error.code,o.error.message)),s?new t(e,n,o.state,i):(Rr("SharedClientState","Failed to parse mutation state for ID '"+n+"': "+r),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),vc=function(){function t(t,e,n){this.targetId=t,this.state=e,this.error=n}return t.Vs=function(e,n){var r,i=JSON.parse(n),o="object"==typeof i&&-1!==["not-current","current","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(r=new Ar(i.error.code,i.error.message)),o?new t(e,i.state,r):(Rr("SharedClientState","Failed to parse target state for ID '"+e+"': "+n),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),mc=function(){function t(t,e){this.clientId=t,this.activeTargetIds=e}return t.Vs=function(e,n){for(var r=JSON.parse(n),i="object"==typeof r&&r.activeTargetIds instanceof Array,o=cs(),s=0;i&&s<r.activeTargetIds.length;++s)i=ci(r.activeTargetIds[s]),o=o.add(r.activeTargetIds[s]);return i?new t(e,o):(Rr("SharedClientState","Failed to parse client data for instance '"+e+"': "+n),null)},t}(),wc=function(){function t(t,e){this.clientId=t,this.onlineState=e}return t.Vs=function(e){var n=JSON.parse(e);return"object"==typeof n&&-1!==["Unknown","Online","Offline"].indexOf(n.onlineState)&&"string"==typeof n.clientId?new t(n.clientId,n.onlineState):(Rr("SharedClientState","Failed to parse online state: "+e),null)},t}(),bc=function(){function t(){this.activeTargetIds=cs()}return t.prototype.Ds=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},t.prototype.Cs=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},t.prototype.Ss=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},t}(),Tc=function(){function t(t,e,n,r,i){this.window=t,this.Se=e,this.persistenceKey=n,this.Ns=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.xs=this.ks.bind(this),this.Fs=new Yo(Ur),this.started=!1,this.$s=[];var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Os=dc(this.persistenceKey,this.Ns),this.Ms=function(t){return"firestore_sequence_number_"+t}(this.persistenceKey),this.Fs=this.Fs.insert(this.Ns,new bc),this.Ls=new RegExp("^firestore_clients_"+o+"_([^_]*)$"),this.Bs=new RegExp("^firestore_mutations_"+o+"_(\\d+)(?:_(.*))?$"),this.qs=new RegExp("^firestore_targets_"+o+"_(\\d+)$"),this.Us=function(t){return"firestore_online_state_"+t}(this.persistenceKey),this.Ks=function(t){return"firestore_bundle_loaded_"+t}(this.persistenceKey),this.window.addEventListener("storage",this.xs)}return t.yt=function(t){return!(!t||!t.localStorage)},t.prototype.start=function(){return s(this,void 0,void 0,(function(){var t,e,n,r,i,o,s,u,c,h,l,f=this;return a(this,(function(a){switch(a.label){case 0:return[4,this.syncEngine.fn()];case 1:for(t=a.sent(),e=0,n=t;e<n.length;e++)(r=n[e])!==this.Ns&&(i=this.getItem(dc(this.persistenceKey,r)))&&(o=mc.Vs(r,i))&&(this.Fs=this.Fs.insert(o.clientId,o));for(this.Qs(),(s=this.storage.getItem(this.Us))&&(u=this.js(s))&&this.Ws(u),c=0,h=this.$s;c<h.length;c++)l=h[c],this.ks(l);return this.$s=[],this.window.addEventListener("pagehide",(function(){return f.shutdown()})),this.started=!0,[2]}}))}))},t.prototype.writeSequenceNumber=function(t){this.setItem(this.Ms,JSON.stringify(t))},t.prototype.getAllActiveQueryTargets=function(){return this.Gs(this.Fs)},t.prototype.isActiveQueryTarget=function(t){var e=!1;return this.Fs.forEach((function(n,r){r.activeTargetIds.has(t)&&(e=!0)})),e},t.prototype.addPendingMutation=function(t){this.zs(t,"pending")},t.prototype.updateMutationState=function(t,e,n){this.zs(t,e,n),this.Hs(t)},t.prototype.addLocalQueryTarget=function(t){var e="not-current";if(this.isActiveQueryTarget(t)){var n=this.storage.getItem(yc(this.persistenceKey,t));if(n){var r=vc.Vs(t,n);r&&(e=r.state)}}return this.Js.Ds(t),this.Qs(),e},t.prototype.removeLocalQueryTarget=function(t){this.Js.Cs(t),this.Qs()},t.prototype.isLocalQueryTarget=function(t){return this.Js.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){this.removeItem(yc(this.persistenceKey,t))},t.prototype.updateQueryState=function(t,e,n){this.Ys(t,e,n)},t.prototype.handleUserChange=function(t,e,n){var r=this;e.forEach((function(t){r.Hs(t)})),this.currentUser=t,n.forEach((function(t){r.addPendingMutation(t)}))},t.prototype.setOnlineState=function(t){this.Xs(t)},t.prototype.notifyBundleLoaded=function(){this.Zs()},t.prototype.shutdown=function(){this.started&&(this.window.removeEventListener("storage",this.xs),this.removeItem(this.Os),this.started=!1)},t.prototype.getItem=function(t){var e=this.storage.getItem(t);return xr("SharedClientState","READ",t,e),e},t.prototype.setItem=function(t,e){xr("SharedClientState","SET",t,e),this.storage.setItem(t,e)},t.prototype.removeItem=function(t){xr("SharedClientState","REMOVE",t),this.storage.removeItem(t)},t.prototype.ks=function(t){var e=this,n=t;if(n.storageArea===this.storage){if(xr("SharedClientState","EVENT",n.key,n.newValue),n.key===this.Os)return void Rr("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Se.enqueueRetryable((function(){return s(e,void 0,void 0,(function(){var t,e,r,i,o,s;return a(this,(function(a){if(this.started){if(null!==n.key)if(this.Ls.test(n.key)){if(null==n.newValue)return t=this.ti(n.key),[2,this.ei(t,null)];if(e=this.ni(n.key,n.newValue))return[2,this.ei(e.clientId,e)]}else if(this.Bs.test(n.key)){if(null!==n.newValue&&(r=this.si(n.key,n.newValue)))return[2,this.ii(r)]}else if(this.qs.test(n.key)){if(null!==n.newValue&&(i=this.ri(n.key,n.newValue)))return[2,this.oi(i)]}else if(n.key===this.Us){if(null!==n.newValue&&(o=this.js(n.newValue)))return[2,this.Ws(o)]}else if(n.key===this.Ms)(s=function(t){var e=Dr.o;if(null!=t)try{var n=JSON.parse(t);Fr("number"==typeof n),e=n}catch(t){Rr("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(n.newValue))!==Dr.o&&this.sequenceNumberHandler(s);else if(n.key===this.Ks)return[2,this.syncEngine.ci()]}else this.$s.push(n);return[2]}))}))}))}},Object.defineProperty(t.prototype,"Js",{get:function(){return this.Fs.get(this.Ns)},enumerable:!1,configurable:!0}),t.prototype.Qs=function(){this.setItem(this.Os,this.Js.Ss())},t.prototype.zs=function(t,e,n){var r=new gc(this.currentUser,t,e,n),i=pc(this.persistenceKey,this.currentUser,t);this.setItem(i,r.Ss())},t.prototype.Hs=function(t){var e=pc(this.persistenceKey,this.currentUser,t);this.removeItem(e)},t.prototype.Xs=function(t){var e={clientId:this.Ns,onlineState:t};this.storage.setItem(this.Us,JSON.stringify(e))},t.prototype.Ys=function(t,e,n){var r=yc(this.persistenceKey,t),i=new vc(t,e,n);this.setItem(r,i.Ss())},t.prototype.Zs=function(){this.setItem(this.Ks,"value-not-used")},t.prototype.ti=function(t){var e=this.Ls.exec(t);return e?e[1]:null},t.prototype.ni=function(t,e){var n=this.ti(t);return mc.Vs(n,e)},t.prototype.si=function(t,e){var n=this.Bs.exec(t),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return gc.Vs(new fc(i),r,e)},t.prototype.ri=function(t,e){var n=this.qs.exec(t),r=Number(n[1]);return vc.Vs(r,e)},t.prototype.js=function(t){return wc.Vs(t)},t.prototype.ii=function(t){return s(this,void 0,void 0,(function(){return a(this,(function(e){return t.user.uid===this.currentUser.uid?[2,this.syncEngine.ui(t.batchId,t.state,t.error)]:(xr("SharedClientState","Ignoring mutation for non-active user "+t.user.uid),[2])}))}))},t.prototype.oi=function(t){return this.syncEngine.ai(t.targetId,t.state,t.error)},t.prototype.ei=function(t,e){var n=this,r=e?this.Fs.insert(t,e):this.Fs.remove(t),i=this.Gs(this.Fs),o=this.Gs(r),s=[],a=[];return o.forEach((function(t){i.has(t)||s.push(t)})),i.forEach((function(t){o.has(t)||a.push(t)})),this.syncEngine.hi(s,a).then((function(){n.Fs=r}))},t.prototype.Ws=function(t){this.Fs.get(t.clientId)&&this.onlineStateHandler(t.onlineState)},t.prototype.Gs=function(t){var e=cs();return t.forEach((function(t,n){e=e.unionWith(n.activeTargetIds)})),e},t}(),Ic=function(){function t(){this.li=new bc,this.fi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}return t.prototype.addPendingMutation=function(t){},t.prototype.updateMutationState=function(t,e,n){},t.prototype.addLocalQueryTarget=function(t){return this.li.Ds(t),this.fi[t]||"not-current"},t.prototype.updateQueryState=function(t,e,n){this.fi[t]=e},t.prototype.removeLocalQueryTarget=function(t){this.li.Cs(t)},t.prototype.isLocalQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){delete this.fi[t]},t.prototype.getAllActiveQueryTargets=function(){return this.li.activeTargetIds},t.prototype.isActiveQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.start=function(){return this.li=new bc,Promise.resolve()},t.prototype.handleUserChange=function(t,e,n){},t.prototype.setOnlineState=function(t){},t.prototype.shutdown=function(){},t.prototype.writeSequenceNumber=function(t){},t.prototype.notifyBundleLoaded=function(){},t}(),Ec=function(){function t(){}return t.prototype.di=function(t){},t.prototype.shutdown=function(){},t}(),_c=function(){function t(){var t=this;this.wi=function(){return t._i()},this.mi=function(){return t.yi()},this.gi=[],this.pi()}return t.prototype.di=function(t){this.gi.push(t)},t.prototype.shutdown=function(){window.removeEventListener("online",this.wi),window.removeEventListener("offline",this.mi)},t.prototype.pi=function(){window.addEventListener("online",this.wi),window.addEventListener("offline",this.mi)},t.prototype._i=function(){xr("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(0)},t.prototype.yi=function(){xr("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(1)},t.yt=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},t}(),Sc={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},Dc=function(){function t(t){this.Ei=t.Ei,this.Ti=t.Ti}return t.prototype.Ii=function(t){this.Ai=t},t.prototype.Ri=function(t){this.bi=t},t.prototype.onMessage=function(t){this.vi=t},t.prototype.close=function(){this.Ti()},t.prototype.send=function(t){this.Ei(t)},t.prototype.Pi=function(){this.Ai()},t.prototype.Vi=function(t){this.bi(t)},t.prototype.Si=function(t){this.vi(t)},t}(),Nc=function(t){function e(e){var n=this;return(n=t.call(this,e)||this).forceLongPolling=e.forceLongPolling,n.autoDetectLongPolling=e.autoDetectLongPolling,n.useFetchStreams=e.useFetchStreams,n}return o(e,t),e.prototype.Fi=function(t,e,n,r){return new Promise((function(i,o){var s=new Sr;s.listenOnce(br.COMPLETE,(function(){try{switch(s.getLastErrorCode()){case wr.NO_ERROR:var e=s.getResponseJson();xr("Connection","XHR received:",JSON.stringify(e)),i(e);break;case wr.TIMEOUT:xr("Connection",'RPC "'+t+'" timed out'),o(new Ar(Nr.DEADLINE_EXCEEDED,"Request time out"));break;case wr.HTTP_ERROR:var n=s.getStatus();if(xr("Connection",'RPC "'+t+'" failed with status:',n,"response text:",s.getResponseText()),n>0){var r=s.getResponseJson().error;if(r&&r.status&&r.message){var a=function(t){var e=t.toLowerCase().replace(/_/g,"-");return Object.values(Nr).indexOf(e)>=0?e:Nr.UNKNOWN}(r.status);o(new Ar(a,r.message))}else o(new Ar(Nr.UNKNOWN,"Server responded with status "+s.getStatus()))}else o(new Ar(Nr.UNAVAILABLE,"Connection failed."));break;default:Lr()}}finally{xr("Connection",'RPC "'+t+'" completed.')}}));var a=JSON.stringify(r);s.send(e,"POST",a,n,15)}))},e.prototype.Oi=function(t,e){var n=[this.Di,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=vr(),i=mr(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(o.xmlHttpFactory=new Er({})),this.ki(o.initMessageHeaders,e),(0,c.uI)()||(0,c.b$)()||(0,c.d)()||(0,c.w1)()||(0,c.Mn)()||(0,c.ru)()||(o.httpHeadersOverwriteParam="$httpHeaders");var s=n.join("");xr("Connection","Creating WebChannel: "+s,o);var a=r.createWebChannel(s,o),u=!1,h=!1,l=new Dc({Ei:function(t){h?xr("Connection","Not sending because WebChannel is closed:",t):(u||(xr("Connection","Opening WebChannel transport."),a.open(),u=!0),xr("Connection","WebChannel sending:",t),a.send(t))},Ti:function(){return a.close()}}),f=function(t,e,n){t.listen(e,(function(t){try{n(t)}catch(t){setTimeout((function(){throw t}),0)}}))};return f(a,_r.EventType.OPEN,(function(){h||xr("Connection","WebChannel transport opened.")})),f(a,_r.EventType.CLOSE,(function(){h||(h=!0,xr("Connection","WebChannel transport closed"),l.Vi())})),f(a,_r.EventType.ERROR,(function(t){h||(h=!0,Or("Connection","WebChannel transport errored:",t),l.Vi(new Ar(Nr.UNAVAILABLE,"The operation could not be completed")))})),f(a,_r.EventType.MESSAGE,(function(t){var e;if(!h){var n=t.data[0];Fr(!!n);var r=n,i=r.error||(null===(e=r[0])||void 0===e?void 0:e.error);if(i){xr("Connection","WebChannel received error:",i);var o=i.status,s=function(t){var e=Bo[t];if(void 0!==e)return Wo(e)}(o),u=i.message;void 0===s&&(s=Nr.INTERNAL,u="Unknown error status: "+o+" with message "+i.message),h=!0,l.Vi(new Ar(s,u)),a.close()}else xr("Connection","WebChannel received:",n),l.Si(n)}})),f(i,Tr.STAT_EVENT,(function(t){t.stat===Ir.PROXY?xr("Connection","Detected buffering proxy"):t.stat===Ir.NOPROXY&&xr("Connection","Detected no buffering proxy")})),setTimeout((function(){l.Pi()}),0),l},e}(function(){function t(t){this.databaseInfo=t,this.databaseId=t.databaseId;var e=t.ssl?"https":"http";this.Di=e+"://"+t.host,this.Ci="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}return t.prototype.Ni=function(t,e,n,r){var i=this.xi(t,e);xr("RestConnection","Sending: ",i,n);var o={};return this.ki(o,r),this.Fi(t,i,o,n).then((function(t){return xr("RestConnection","Received: ",t),t}),(function(e){throw Or("RestConnection",t+" failed with error: ",e,"url: ",i,"request:",n),e}))},t.prototype.$i=function(t,e,n,r){return this.Ni(t,e,n,r)},t.prototype.ki=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.10.1",t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n])},t.prototype.xi=function(t,e){var n=Sc[t];return this.Di+"/v1/"+e+":"+n},t}());function Ac(){return"undefined"!=typeof window?window:null}function kc(){return"undefined"!=typeof document?document:null}function Cc(t){return new Ts(t,!0)}var xc=function(){function t(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Se=t,this.timerId=e,this.Mi=n,this.Li=r,this.Bi=i,this.qi=0,this.Ui=null,this.Ki=Date.now(),this.reset()}return t.prototype.reset=function(){this.qi=0},t.prototype.Qi=function(){this.qi=this.Bi},t.prototype.ji=function(t){var e=this;this.cancel();var n=Math.floor(this.qi+this.Wi()),r=Math.max(0,Date.now()-this.Ki),i=Math.max(0,n-r);i>0&&xr("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.qi+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.Ui=this.Se.enqueueAfterDelay(this.timerId,i,(function(){return e.Ki=Date.now(),t()})),this.qi*=this.Li,this.qi<this.Mi&&(this.qi=this.Mi),this.qi>this.Bi&&(this.qi=this.Bi)},t.prototype.Gi=function(){null!==this.Ui&&(this.Ui.skipDelay(),this.Ui=null)},t.prototype.cancel=function(){null!==this.Ui&&(this.Ui.cancel(),this.Ui=null)},t.prototype.Wi=function(){return(Math.random()-.5)*this.qi},t}(),Rc=function(){function t(t,e,n,r,i,o){this.Se=t,this.zi=n,this.Hi=r,this.Ji=i,this.listener=o,this.state=0,this.Yi=0,this.Xi=null,this.stream=null,this.Zi=new xc(t,e)}return t.prototype.tr=function(){return 1===this.state||2===this.state||4===this.state},t.prototype.er=function(){return 2===this.state},t.prototype.start=function(){3!==this.state?this.auth():this.nr()},t.prototype.stop=function(){return s(this,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return this.tr()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},t.prototype.sr=function(){this.state=0,this.Zi.reset()},t.prototype.ir=function(){var t=this;this.er()&&null===this.Xi&&(this.Xi=this.Se.enqueueAfterDelay(this.zi,6e4,(function(){return t.rr()})))},t.prototype.cr=function(t){this.ur(),this.stream.send(t)},t.prototype.rr=function(){return s(this,void 0,void 0,(function(){return a(this,(function(t){return this.er()?[2,this.close(0)]:[2]}))}))},t.prototype.ur=function(){this.Xi&&(this.Xi.cancel(),this.Xi=null)},t.prototype.close=function(t,e){return s(this,void 0,void 0,(function(){return a(this,(function(n){switch(n.label){case 0:return this.ur(),this.Zi.cancel(),this.Yi++,3!==t?this.Zi.reset():e&&e.code===Nr.RESOURCE_EXHAUSTED?(Rr(e.toString()),Rr("Using maximum backoff delay to prevent overloading the backend."),this.Zi.Qi()):e&&e.code===Nr.UNAUTHENTICATED&&this.Ji.invalidateToken(),null!==this.stream&&(this.ar(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.Ri(e)];case 1:return n.sent(),[2]}}))}))},t.prototype.ar=function(){},t.prototype.auth=function(){var t=this;this.state=1;var e=this.hr(this.Yi),n=this.Yi;this.Ji.getToken().then((function(e){t.Yi===n&&t.lr(e)}),(function(n){e((function(){var e=new Ar(Nr.UNKNOWN,"Fetching auth token failed: "+n.message);return t.dr(e)}))}))},t.prototype.lr=function(t){var e=this,n=this.hr(this.Yi);this.stream=this.wr(t),this.stream.Ii((function(){n((function(){return e.state=2,e.listener.Ii()}))})),this.stream.Ri((function(t){n((function(){return e.dr(t)}))})),this.stream.onMessage((function(t){n((function(){return e.onMessage(t)}))}))},t.prototype.nr=function(){var t=this;this.state=4,this.Zi.ji((function(){return s(t,void 0,void 0,(function(){return a(this,(function(t){return this.state=0,this.start(),[2]}))}))}))},t.prototype.dr=function(t){return xr("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},t.prototype.hr=function(t){var e=this;return function(n){e.Se.enqueueAndForget((function(){return e.Yi===t?n():(xr("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())}))}},t}(),Oc=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"listen_stream_connection_backoff","listen_stream_idle",n,r,o)||this).R=i,s}return o(e,t),e.prototype.wr=function(t){return this.Hi.Oi("Listen",t)},e.prototype.onMessage=function(t){this.Zi.reset();var e=function(t,e){var n;if("targetChange"in e){e.targetChange;var r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:Lr()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],o=function(t,e){return t.I?(Fr(void 0===e||"string"==typeof e),Zr.fromBase64String(e||"")):(Fr(void 0===e||e instanceof Uint8Array),Zr.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),s=(a=e.targetChange.cause)&&function(t){var e=void 0===t.code?Nr.UNKNOWN:Wo(t.code);return new Ar(e,t.message||"")}(a);n=new ps(r,i,o,s||null)}else if("documentChange"in e){e.documentChange,(r=e.documentChange).document,r.document.name,r.document.updateTime,i=ks(t,r.document.name),o=Ss(r.document.updateTime);var a=new Si({mapValue:{fields:r.document.fields}}),u=(s=Ni.newFoundDocument(i,o,a),r.targetIds||[]),c=r.removedTargetIds||[];n=new fs(u,c,s.key,s)}else if("documentDelete"in e)e.documentDelete,(r=e.documentDelete).document,i=ks(t,r.document),o=r.readTime?Ss(r.readTime):Gr.min(),a=Ni.newNoDocument(i,o),s=r.removedTargetIds||[],n=new fs([],s,a.key,a);else if("documentRemove"in e)e.documentRemove,(r=e.documentRemove).document,i=ks(t,r.document),o=r.removedTargetIds||[],n=new fs([],o,i,null);else{if(!("filter"in e))return Lr();e.filter;var h=e.filter;h.targetId,r=h.count||0,i=new zo(r),o=h.targetId,n=new ds(o,i)}return n}(this.R,t),n=function(t){if(!("targetChange"in t))return Gr.min();var e=t.targetChange;return e.targetIds&&e.targetIds.length?Gr.min():e.readTime?Ss(e.readTime):Gr.min()}(t);return this.listener._r(e,n)},e.prototype.mr=function(t){var e={};e.database=Rs(this.R),e.addTarget=function(t,e){var n,r=e.target;return(n=Ri(r)?{documents:Vs(t,r)}:{query:qs(t,r)}).targetId=e.targetId,e.resumeToken.approximateByteSize()>0?n.resumeToken=Es(t,e.resumeToken):e.snapshotVersion.compareTo(Gr.min())>0&&(n.readTime=Is(t,e.snapshotVersion.toTimestamp())),n}(this.R,t);var n=function(t,e){var n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Lr()}}(0,e.purpose);return null==n?null:{"goog-listen-tags":n}}(this.R,t);n&&(e.labels=n),this.cr(e)},e.prototype.yr=function(t){var e={};e.database=Rs(this.R),e.removeTarget=t,this.cr(e)},e}(Rc),Pc=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"write_stream_connection_backoff","write_stream_idle",n,r,o)||this).R=i,s.gr=!1,s}return o(e,t),Object.defineProperty(e.prototype,"pr",{get:function(){return this.gr},enumerable:!1,configurable:!0}),e.prototype.start=function(){this.gr=!1,this.lastStreamToken=void 0,t.prototype.start.call(this)},e.prototype.ar=function(){this.gr&&this.Er([])},e.prototype.wr=function(t){return this.Hi.Oi("Write",t)},e.prototype.onMessage=function(t){if(Fr(!!t.streamToken),this.lastStreamToken=t.streamToken,this.gr){this.Zi.reset();var e=function(t,e){return t&&t.length>0?(Fr(void 0!==e),t.map((function(t){return function(t,e){var n=t.updateTime?Ss(t.updateTime):Ss(e);return n.isEqual(Gr.min())&&(n=Ss(e)),new Ao(n,t.transformResults||[])}(t,e)}))):[]}(t.writeResults,t.commitTime),n=Ss(t.commitTime);return this.listener.Tr(n,e)}return Fr(!t.writeResults||0===t.writeResults.length),this.gr=!0,this.listener.Ir()},e.prototype.Ar=function(){var t={};t.database=Rs(this.R),this.cr(t)},e.prototype.Er=function(t){var e=this,n={streamToken:this.lastStreamToken,writes:t.map((function(t){return Fs(e.R,t)}))};this.cr(n)},e}(Rc),Lc=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).credentials=e,i.Hi=n,i.R=r,i.Rr=!1,i}return o(e,t),e.prototype.br=function(){if(this.Rr)throw new Ar(Nr.FAILED_PRECONDITION,"The client has already been terminated.")},e.prototype.Ni=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then((function(i){return r.Hi.Ni(t,e,n,i)})).catch((function(t){throw"FirebaseError"===t.name?(t.code===Nr.UNAUTHENTICATED&&r.credentials.invalidateToken(),t):new Ar(Nr.UNKNOWN,t.toString())}))},e.prototype.$i=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then((function(i){return r.Hi.$i(t,e,n,i)})).catch((function(t){throw"FirebaseError"===t.name?(t.code===Nr.UNAUTHENTICATED&&r.credentials.invalidateToken(),t):new Ar(Nr.UNKNOWN,t.toString())}))},e.prototype.terminate=function(){this.Rr=!0},e}((function(){})),Fc=function(){function t(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.vr=0,this.Pr=null,this.Vr=!0}return t.prototype.Sr=function(){var t=this;0===this.vr&&(this.Dr("Unknown"),this.Pr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(function(){return t.Pr=null,t.Cr("Backend didn't respond within 10 seconds."),t.Dr("Offline"),Promise.resolve()})))},t.prototype.Nr=function(t){"Online"===this.state?this.Dr("Unknown"):(this.vr++,this.vr>=1&&(this.kr(),this.Cr("Connection failed 1 times. Most recent error: "+t.toString()),this.Dr("Offline")))},t.prototype.set=function(t){this.kr(),this.vr=0,"Online"===t&&(this.Vr=!1),this.Dr(t)},t.prototype.Dr=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},t.prototype.Cr=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Vr?(Rr(e),this.Vr=!1):xr("OnlineStateTracker",e)},t.prototype.kr=function(){null!==this.Pr&&(this.Pr.cancel(),this.Pr=null)},t}(),Mc=function(t,e,n,r,i){var o=this;this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.Fr=[],this.$r=new Map,this.Or=new Set,this.Mr=[],this.Lr=i,this.Lr.di((function(t){n.enqueueAndForget((function(){return s(o,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return zc(this)?(xr("RemoteStore","Restarting streams for network reachability change."),[4,function(t){return s(this,void 0,void 0,(function(){var e;return a(this,(function(n){switch(n.label){case 0:return(e=Mr(t)).Or.add(4),[4,qc(e)];case 1:return n.sent(),e.Br.set("Unknown"),e.Or.delete(4),[4,Vc(e)];case 2:return n.sent(),[2]}}))}))}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))}))})),this.Br=new Fc(n,r)};function Vc(t){return s(this,void 0,void 0,(function(){var e,n;return a(this,(function(r){switch(r.label){case 0:if(!zc(t))return[3,4];e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!0)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}}))}))}function qc(t){return s(this,void 0,void 0,(function(){var e,n;return a(this,(function(r){switch(r.label){case 0:e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!1)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}}))}))}function Uc(t,e){var n=Mr(t);n.$r.has(e.targetId)||(n.$r.set(e.targetId,e),Qc(n)?Gc(n):ah(n).er()&&Bc(n,e))}function jc(t,e){var n=Mr(t),r=ah(n);n.$r.delete(e),r.er()&&Kc(n,e),0===n.$r.size&&(r.er()?r.ir():zc(n)&&n.Br.set("Unknown"))}function Bc(t,e){t.qr.U(e.targetId),ah(t).mr(e)}function Kc(t,e){t.qr.U(e),ah(t).yr(e)}function Gc(t){t.qr=new gs({getRemoteKeysForTarget:function(e){return t.remoteSyncer.getRemoteKeysForTarget(e)},lt:function(e){return t.$r.get(e)||null}}),ah(t).start(),t.Br.Sr()}function Qc(t){return zc(t)&&!ah(t).tr()&&t.$r.size>0}function zc(t){return 0===Mr(t).Or.size}function Hc(t){t.qr=void 0}function Wc(t){return s(this,void 0,void 0,(function(){return a(this,(function(e){return t.$r.forEach((function(e,n){Bc(t,e)})),[2]}))}))}function Yc(t,e){return s(this,void 0,void 0,(function(){return a(this,(function(n){return Hc(t),Qc(t)?(t.Br.Nr(e),Gc(t)):t.Br.set("Unknown"),[2]}))}))}function Xc(t,e,n){return s(this,void 0,void 0,(function(){var r,i,o;return a(this,(function(u){switch(u.label){case 0:if(t.Br.set("Online"),!(e instanceof ps&&2===e.state&&e.cause))return[3,6];u.label=1;case 1:return u.trys.push([1,3,,5]),[4,function(t,e){return s(this,void 0,void 0,(function(){var n,r,i,o;return a(this,(function(s){switch(s.label){case 0:n=e.cause,r=0,i=e.targetIds,s.label=1;case 1:return r<i.length?(o=i[r],t.$r.has(o)?[4,t.remoteSyncer.rejectListen(o,n)]:[3,3]):[3,5];case 2:s.sent(),t.$r.delete(o),t.qr.removeTarget(o),s.label=3;case 3:s.label=4;case 4:return r++,[3,1];case 5:return[2]}}))}))}(t,e)];case 2:return u.sent(),[3,5];case 3:return r=u.sent(),xr("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),[4,$c(t,r)];case 4:return u.sent(),[3,5];case 5:return[3,13];case 6:if(e instanceof fs?t.qr.X(e):e instanceof ds?t.qr.rt(e):t.qr.et(e),n.isEqual(Gr.min()))return[3,13];u.label=7;case 7:return u.trys.push([7,11,,13]),[4,Gu(t.localStore)];case 8:return i=u.sent(),n.compareTo(i)>=0?[4,function(t,e){var n=t.qr.ut(e);return n.targetChanges.forEach((function(n,r){if(n.resumeToken.approximateByteSize()>0){var i=t.$r.get(r);i&&t.$r.set(r,i.withResumeToken(n.resumeToken,e))}})),n.targetMismatches.forEach((function(e){var n=t.$r.get(e);if(n){t.$r.set(e,n.withResumeToken(Zr.EMPTY_BYTE_STRING,n.snapshotVersion)),Kc(t,e);var r=new Fa(n.target,e,1,n.sequenceNumber);Bc(t,r)}})),t.remoteSyncer.applyRemoteEvent(n)}(t,n)]:[3,10];case 9:u.sent(),u.label=10;case 10:return[3,13];case 11:return xr("RemoteStore","Failed to raise snapshot:",o=u.sent()),[4,$c(t,o)];case 12:return u.sent(),[3,13];case 13:return[2]}}))}))}function $c(t,e,n){return s(this,void 0,void 0,(function(){var r=this;return a(this,(function(i){switch(i.label){case 0:if(!Na(e))throw e;return t.Or.add(1),[4,qc(t)];case 1:return i.sent(),t.Br.set("Offline"),n||(n=function(){return Gu(t.localStore)}),t.asyncQueue.enqueueRetryable((function(){return s(r,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return xr("RemoteStore","Retrying IndexedDB access"),[4,n()];case 1:return e.sent(),t.Or.delete(1),[4,Vc(t)];case 2:return e.sent(),[2]}}))}))})),[2]}}))}))}function Jc(t,e){return e().catch((function(n){return $c(t,n,e)}))}function Zc(t){return s(this,void 0,void 0,(function(){var e,n,r,i,o;return a(this,(function(s){switch(s.label){case 0:e=Mr(t),n=uh(e),r=e.Fr.length>0?e.Fr[e.Fr.length-1].batchId:-1,s.label=1;case 1:if(!function(t){return zc(t)&&t.Fr.length<10}(e))return[3,7];s.label=2;case 2:return s.trys.push([2,4,,6]),[4,Hu(e.localStore,r)];case 3:return null===(i=s.sent())?(0===e.Fr.length&&n.ir(),[3,7]):(r=i.batchId,function(t,e){t.Fr.push(e);var n=uh(t);n.er()&&n.pr&&n.Er(e.mutations)}(e,i),[3,6]);case 4:return o=s.sent(),[4,$c(e,o)];case 5:return s.sent(),[3,6];case 6:return[3,1];case 7:return th(e)&&eh(e),[2]}}))}))}function th(t){return zc(t)&&!uh(t).tr()&&t.Fr.length>0}function eh(t){uh(t).start()}function nh(t){return s(this,void 0,void 0,(function(){return a(this,(function(e){return uh(t).Ar(),[2]}))}))}function rh(t){return s(this,void 0,void 0,(function(){var e,n,r,i;return a(this,(function(o){for(e=uh(t),n=0,r=t.Fr;n<r.length;n++)i=r[n],e.Er(i.mutations);return[2]}))}))}function ih(t,e,n){return s(this,void 0,void 0,(function(){var r,i;return a(this,(function(o){switch(o.label){case 0:return r=t.Fr.shift(),i=La.from(r,e,n),[4,Jc(t,(function(){return t.remoteSyncer.applySuccessfulWrite(i)}))];case 1:return o.sent(),[4,Zc(t)];case 2:return o.sent(),[2]}}))}))}function oh(t,e){return s(this,void 0,void 0,(function(){return a(this,(function(n){switch(n.label){case 0:return e&&uh(t).pr?[4,function(t,e){return s(this,void 0,void 0,(function(){var n,r;return a(this,(function(i){switch(i.label){case 0:return Ho(r=e.code)&&r!==Nr.ABORTED?(n=t.Fr.shift(),uh(t).sr(),[4,Jc(t,(function(){return t.remoteSyncer.rejectFailedWrite(n.batchId,e)}))]):[3,3];case 1:return i.sent(),[4,Zc(t)];case 2:i.sent(),i.label=3;case 3:return[2]}}))}))}(t,e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return th(t)&&eh(t),[2]}}))}))}function sh(t,e){return s(this,void 0,void 0,(function(){var n;return a(this,(function(r){switch(r.label){case 0:return n=Mr(t),e?(n.Or.delete(2),[4,Vc(n)]):[3,2];case 1:return r.sent(),[3,5];case 2:return e?[3,4]:(n.Or.add(2),[4,qc(n)]);case 3:r.sent(),n.Br.set("Unknown"),r.label=4;case 4:r.label=5;case 5:return[2]}}))}))}function ah(t){var e=this;return t.Ur||(t.Ur=function(t,e,n){var r=Mr(t);return r.br(),new Oc(e,r.Hi,r.credentials,r.R,n)}(t.datastore,t.asyncQueue,{Ii:Wc.bind(null,t),Ri:Yc.bind(null,t),_r:Xc.bind(null,t)}),t.Mr.push((function(n){return s(e,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return n?(t.Ur.sr(),Qc(t)?Gc(t):t.Br.set("Unknown"),[3,3]):[3,1];case 1:return[4,t.Ur.stop()];case 2:e.sent(),Hc(t),e.label=3;case 3:return[2]}}))}))}))),t.Ur}function uh(t){var e=this;return t.Kr||(t.Kr=function(t,e,n){var r=Mr(t);return r.br(),new Pc(e,r.Hi,r.credentials,r.R,n)}(t.datastore,t.asyncQueue,{Ii:nh.bind(null,t),Ri:oh.bind(null,t),Ir:rh.bind(null,t),Tr:ih.bind(null,t)}),t.Mr.push((function(n){return s(e,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return n?(t.Kr.sr(),[4,Zc(t)]):[3,2];case 1:return e.sent(),[3,4];case 2:return[4,t.Kr.stop()];case 3:e.sent(),t.Fr.length>0&&(xr("RemoteStore","Stopping write stream with "+t.Fr.length+" pending writes"),t.Fr=[]),e.label=4;case 4:return[2]}}))}))}))),t.Kr}var ch=function(){function t(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new Ta,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((function(t){}))}return t.createAndSchedule=function(e,n,r,i,o){var s=new t(e,n,Date.now()+r,i,o);return s.start(r),s},t.prototype.start=function(t){var e=this;this.timerHandle=setTimeout((function(){return e.handleDelayElapsed()}),t)},t.prototype.skipDelay=function(){return this.handleDelayElapsed()},t.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Ar(Nr.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},t.prototype.handleDelayElapsed=function(){var t=this;this.asyncQueue.enqueueAndForget((function(){return null!==t.timerHandle?(t.clearTimeout(),t.op().then((function(e){return t.deferred.resolve(e)}))):Promise.resolve()}))},t.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},t}();function hh(t,e){if(Rr("AsyncQueue",e+": "+t),Na(t))return new Ar(Nr.UNAVAILABLE,e+": "+t);throw t}var lh=function(){function t(t){this.comparator=t?function(e,n){return t(e,n)||hi.comparator(e.key,n.key)}:function(t,e){return hi.comparator(t.key,e.key)},this.keyedMap=rs(),this.sortedSet=new Yo(this.comparator)}return t.emptySet=function(e){return new t(e.comparator)},t.prototype.has=function(t){return null!=this.keyedMap.get(t)},t.prototype.get=function(t){return this.keyedMap.get(t)},t.prototype.first=function(){return this.sortedSet.minKey()},t.prototype.last=function(){return this.sortedSet.maxKey()},t.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},t.prototype.indexOf=function(t){var e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1},Object.defineProperty(t.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t){this.sortedSet.inorderTraversal((function(e,n){return t(e),!1}))},t.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},t.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0},t.prototype.toString=function(){var t=[];return this.forEach((function(e){t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},t.prototype.copy=function(e,n){var r=new t;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r},t}(),fh=function(){function t(){this.Qr=new Yo(hi.comparator)}return t.prototype.track=function(t){var e=t.doc.key,n=this.Qr.get(e);n?0!==t.type&&3===n.type?this.Qr=this.Qr.insert(e,t):3===t.type&&1!==n.type?this.Qr=this.Qr.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Qr=this.Qr.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Qr=this.Qr.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Qr=this.Qr.remove(e):1===t.type&&2===n.type?this.Qr=this.Qr.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Qr=this.Qr.insert(e,{type:2,doc:t.doc}):Lr():this.Qr=this.Qr.insert(e,t)},t.prototype.jr=function(){var t=[];return this.Qr.inorderTraversal((function(e,n){t.push(n)})),t},t}(),dh=function(){function t(t,e,n,r,i,o,s,a){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=s,this.excludesMetadataChanges=a}return t.fromInitialDocuments=function(e,n,r,i){var o=[];return n.forEach((function(t){o.push({type:0,doc:t})})),new t(e,n,lh.emptySet(n),o,r,i,!0,!1)},Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&oo(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},t}(),ph=function(){this.Wr=void 0,this.listeners=[]},yh=function(){this.queries=new Iu((function(t){return so(t)}),oo),this.onlineState="Unknown",this.Gr=new Set};function gh(t,e){return s(this,void 0,void 0,(function(){var n,r,i,o,s,u,c;return a(this,(function(a){switch(a.label){case 0:if(n=Mr(t),r=e.query,i=!1,(o=n.queries.get(r))||(i=!0,o=new ph),!i)return[3,4];a.label=1;case 1:return a.trys.push([1,3,,4]),s=o,[4,n.onListen(r)];case 2:return s.Wr=a.sent(),[3,4];case 3:return u=a.sent(),c=hh(u,"Initialization of query '"+ao(e.query)+"' failed"),[2,void e.onError(c)];case 4:return n.queries.set(r,o),o.listeners.push(e),e.zr(n.onlineState),o.Wr&&e.Hr(o.Wr)&&bh(n),[2]}}))}))}function vh(t,e){return s(this,void 0,void 0,(function(){var n,r,i,o,s;return a(this,(function(a){return n=Mr(t),r=e.query,i=!1,(o=n.queries.get(r))&&(s=o.listeners.indexOf(e))>=0&&(o.listeners.splice(s,1),i=0===o.listeners.length),i?[2,(n.queries.delete(r),n.onUnlisten(r))]:[2]}))}))}function mh(t,e){for(var n=Mr(t),r=!1,i=0,o=e;i<o.length;i++){var s=o[i],a=s.query,u=n.queries.get(a);if(u){for(var c=0,h=u.listeners;c<h.length;c++)h[c].Hr(s)&&(r=!0);u.Wr=s}}r&&bh(n)}function wh(t,e,n){var r=Mr(t),i=r.queries.get(e);if(i)for(var o=0,s=i.listeners;o<s.length;o++)s[o].onError(n);r.queries.delete(e)}function bh(t){t.Gr.forEach((function(t){t.next()}))}var Th=function(){function t(t,e,n){this.query=t,this.Jr=e,this.Yr=!1,this.Xr=null,this.onlineState="Unknown",this.options=n||{}}return t.prototype.Hr=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new dh(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}var o=!1;return this.Yr?this.Zr(t)&&(this.Jr.next(t),o=!0):this.eo(t,this.onlineState)&&(this.no(t),o=!0),this.Xr=t,o},t.prototype.onError=function(t){this.Jr.error(t)},t.prototype.zr=function(t){this.onlineState=t;var e=!1;return this.Xr&&!this.Yr&&this.eo(this.Xr,t)&&(this.no(this.Xr),e=!0),e},t.prototype.eo=function(t,e){if(!t.fromCache)return!0;var n="Offline"!==e;return!(this.options.so&&n||t.docs.isEmpty()&&"Offline"!==e)},t.prototype.Zr=function(t){if(t.docChanges.length>0)return!0;var e=this.Xr&&this.Xr.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges},t.prototype.no=function(t){t=dh.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.Yr=!0,this.Jr.next(t)},t}(),Ih=function(){function t(t,e){this.payload=t,this.byteLength=e}return t.prototype.io=function(){return"metadata"in this.payload},t}(),Eh=function(){function t(t){this.R=t}return t.prototype.qn=function(t){return ks(this.R,t)},t.prototype.Un=function(t){return t.metadata.exists?Ls(this.R,t.document,!1):Ni.newNoDocument(this.qn(t.metadata.name),this.Kn(t.metadata.readTime))},t.prototype.Kn=function(t){return Ss(t)},t}();!function(){function t(t,e,n){this.ro=t,this.localStore=e,this.R=n,this.queries=[],this.documents=[],this.progress=_h(t)}t.prototype.oo=function(t){this.progress.bytesLoaded+=t.byteLength;var e=this.progress.documentsLoaded;return t.payload.namedQuery?this.queries.push(t.payload.namedQuery):t.payload.documentMetadata?(this.documents.push({metadata:t.payload.documentMetadata}),t.payload.documentMetadata.exists||++e):t.payload.document&&(this.documents[this.documents.length-1].document=t.payload.document,++e),e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null},t.prototype.co=function(t){for(var e=new Map,n=new Eh(this.R),r=0,i=t;r<i.length;r++){var o=i[r];if(o.metadata.queries)for(var s=n.qn(o.metadata.name),a=0,u=o.metadata.queries;a<u.length;a++){var c=u[a],h=(e.get(c)||as()).add(s);e.set(c,h)}}return e},t.prototype.complete=function(){return s(this,void 0,void 0,(function(){var t,e,n,r,i;return a(this,(function(o){switch(o.label){case 0:return[4,tc(this.localStore,new Eh(this.R),this.documents,this.ro.id)];case 1:t=o.sent(),e=this.co(this.documents),n=0,r=this.queries,o.label=2;case 2:return n<r.length?(i=r[n],[4,ec(this.localStore,i,e.get(i.name))]):[3,5];case 3:o.sent(),o.label=4;case 4:return n++,[3,2];case 5:return[2,(this.progress.taskState="Success",new Fu(Object.assign({},this.progress),t))]}}))}))}}();function _h(t){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}var Sh=function(t){this.key=t},Dh=function(t){this.key=t},Nh=function(){function t(t,e){this.query=t,this.uo=e,this.ao=null,this.current=!1,this.ho=as(),this.mutatedKeys=as(),this.lo=co(t),this.fo=new lh(this.lo)}return Object.defineProperty(t.prototype,"wo",{get:function(){return this.uo},enumerable:!1,configurable:!0}),t.prototype._o=function(t,e){var n=this,r=e?e.mo:new fh,i=e?e.fo:this.fo,o=e?e.mutatedKeys:this.mutatedKeys,s=i,a=!1,u=$i(this.query)&&i.size===this.query.limit?i.last():null,c=Ji(this.query)&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal((function(t,e){var h=i.get(t),l=uo(n.query,e)?e:null,f=!!h&&n.mutatedKeys.has(h.key),d=!!l&&(l.hasLocalMutations||n.mutatedKeys.has(l.key)&&l.hasCommittedMutations),p=!1;h&&l?h.data.isEqual(l.data)?f!==d&&(r.track({type:3,doc:l}),p=!0):n.yo(h,l)||(r.track({type:2,doc:l}),p=!0,(u&&n.lo(l,u)>0||c&&n.lo(l,c)<0)&&(a=!0)):!h&&l?(r.track({type:0,doc:l}),p=!0):h&&!l&&(r.track({type:1,doc:h}),p=!0,(u||c)&&(a=!0)),p&&(l?(s=s.add(l),o=d?o.add(t):o.delete(t)):(s=s.delete(t),o=o.delete(t)))})),$i(this.query)||Ji(this.query))for(;s.size>this.query.limit;){var h=$i(this.query)?s.last():s.first();s=s.delete(h.key),o=o.delete(h.key),r.track({type:1,doc:h})}return{fo:s,mo:r,Nn:a,mutatedKeys:o}},t.prototype.yo=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},t.prototype.applyChanges=function(t,e,n){var r=this,i=this.fo;this.fo=t.fo,this.mutatedKeys=t.mutatedKeys;var o=t.mo.jr();o.sort((function(t,e){return function(t,e){var n=function(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Lr()}};return n(t)-n(e)}(t.type,e.type)||r.lo(t.doc,e.doc)})),this.po(n);var s=e?this.Eo():[],a=0===this.ho.size&&this.current?1:0,u=a!==this.ao;return this.ao=a,0!==o.length||u?{snapshot:new dh(this.query,t.fo,i,o,t.mutatedKeys,0===a,u,!1),To:s}:{To:s}},t.prototype.zr=function(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({fo:this.fo,mo:new fh,mutatedKeys:this.mutatedKeys,Nn:!1},!1)):{To:[]}},t.prototype.Io=function(t){return!this.uo.has(t)&&!!this.fo.has(t)&&!this.fo.get(t).hasLocalMutations},t.prototype.po=function(t){var e=this;t&&(t.addedDocuments.forEach((function(t){return e.uo=e.uo.add(t)})),t.modifiedDocuments.forEach((function(t){})),t.removedDocuments.forEach((function(t){return e.uo=e.uo.delete(t)})),this.current=t.current)},t.prototype.Eo=function(){var t=this;if(!this.current)return[];var e=this.ho;this.ho=as(),this.fo.forEach((function(e){t.Io(e.key)&&(t.ho=t.ho.add(e.key))}));var n=[];return e.forEach((function(e){t.ho.has(e)||n.push(new Dh(e))})),this.ho.forEach((function(t){e.has(t)||n.push(new Sh(t))})),n},t.prototype.Ao=function(t){this.uo=t.Bn,this.ho=as();var e=this._o(t.documents);return this.applyChanges(e,!0)},t.prototype.Ro=function(){return dh.fromInitialDocuments(this.query,this.fo,this.mutatedKeys,0===this.ao)},t}(),Ah=function(t,e,n){this.query=t,this.targetId=e,this.view=n},kh=function(t){this.key=t,this.bo=!1},Ch=function(){function t(t,e,n,r,i,o){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.vo={},this.Po=new Iu((function(t){return so(t)}),oo),this.Vo=new Map,this.So=new Set,this.Do=new Yo(hi.comparator),this.Co=new Map,this.No=new rc,this.xo={},this.ko=new Map,this.Fo=hu.Yt(),this.onlineState="Unknown",this.$o=void 0}return Object.defineProperty(t.prototype,"isPrimaryClient",{get:function(){return!0===this.$o},enumerable:!1,configurable:!0}),t}();function xh(t,e){return s(this,void 0,void 0,(function(){var n,r,i,o,s,u;return a(this,(function(a){switch(a.label){case 0:return n=sl(t),(o=n.Po.get(e))?(r=o.targetId,n.sharedClientState.addLocalQueryTarget(r),i=o.view.Ro(),[3,4]):[3,1];case 1:return[4,Wu(n.localStore,ro(e))];case 2:return s=a.sent(),u=n.sharedClientState.addLocalQueryTarget(s.targetId),r=s.targetId,[4,Rh(n,e,r,"current"===u)];case 3:i=a.sent(),n.isPrimaryClient&&Uc(n.remoteStore,s),a.label=4;case 4:return[2,i]}}))}))}function Rh(t,e,n,r){return s(this,void 0,void 0,(function(){var i,o,u,c,h,l;return a(this,(function(f){switch(f.label){case 0:return t.Oo=function(e,n,r){return function(t,e,n,r){return s(this,void 0,void 0,(function(){var i,o,s;return a(this,(function(a){switch(a.label){case 0:return(i=e.view._o(n)).Nn?[4,Xu(t.localStore,e.query,!1).then((function(t){var n=t.documents;return e.view._o(n,i)}))]:[3,2];case 1:i=a.sent(),a.label=2;case 2:return o=r&&r.targetChanges.get(e.targetId),s=e.view.applyChanges(i,t.isPrimaryClient,o),[2,(Qh(t,e.targetId,s.To),s.snapshot)]}}))}))}(t,e,n,r)},[4,Xu(t.localStore,e,!0)];case 1:return i=f.sent(),o=new Nh(e,i.Bn),u=o._o(i.documents),c=ls.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==t.onlineState),h=o.applyChanges(u,t.isPrimaryClient,c),Qh(t,n,h.To),l=new Ah(e,n,o),[2,(t.Po.set(e,l),t.Vo.has(n)?t.Vo.get(n).push(e):t.Vo.set(n,[e]),h.snapshot)]}}))}))}function Oh(t,e){return s(this,void 0,void 0,(function(){var n,r,i;return a(this,(function(o){switch(o.label){case 0:return n=Mr(t),r=n.Po.get(e),(i=n.Vo.get(r.targetId)).length>1?[2,(n.Vo.set(r.targetId,i.filter((function(t){return!oo(t,e)}))),void n.Po.delete(e))]:n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)?[3,2]:[4,Yu(n.localStore,r.targetId,!1).then((function(){n.sharedClientState.clearQueryState(r.targetId),jc(n.remoteStore,r.targetId),Kh(n,r.targetId)})).catch(yu)]):[3,3];case 1:o.sent(),o.label=2;case 2:return[3,5];case 3:return Kh(n,r.targetId),[4,Yu(n.localStore,r.targetId,!0)];case 4:o.sent(),o.label=5;case 5:return[2]}}))}))}function Ph(t,e,n){return s(this,void 0,void 0,(function(){var r,i,o,s;return a(this,(function(a){switch(a.label){case 0:r=al(t),a.label=1;case 1:return a.trys.push([1,5,,6]),[4,function(t,e){var n,r=Mr(t),i=Kr.now(),o=e.reduce((function(t,e){return t.add(e.key)}),as());return r.persistence.runTransaction("Locally write mutations","readwrite",(function(t){return r.Mn.pn(t,o).next((function(o){n=o;for(var s=[],a=0,u=e;a<u.length;a++){var c=u[a],h=Po(c,n.get(c.key));null!=h&&s.push(new Vo(c.key,h,Di(h.value.mapValue),ko.exists(!0)))}return r._n.addMutationBatch(t,i,s,e)}))})).then((function(t){return t.applyToLocalDocumentSet(n),{batchId:t.batchId,changes:n}}))}(r.localStore,e)];case 2:return i=a.sent(),r.sharedClientState.addPendingMutation(i.batchId),function(t,e,n){var r=t.xo[t.currentUser.toKey()];r||(r=new Yo(Ur)),r=r.insert(e,n),t.xo[t.currentUser.toKey()]=r}(r,i.batchId,n),[4,Wh(r,i.changes)];case 3:return a.sent(),[4,Zc(r.remoteStore)];case 4:return a.sent(),[3,6];case 5:return o=a.sent(),s=hh(o,"Failed to persist write"),n.reject(s),[3,6];case 6:return[2]}}))}))}function Lh(t,e){return s(this,void 0,void 0,(function(){var n,r;return a(this,(function(i){switch(i.label){case 0:n=Mr(t),i.label=1;case 1:return i.trys.push([1,4,,6]),[4,Qu(n.localStore,e)];case 2:return r=i.sent(),e.targetChanges.forEach((function(t,e){var r=n.Co.get(e);r&&(Fr(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?r.bo=!0:t.modifiedDocuments.size>0?Fr(r.bo):t.removedDocuments.size>0&&(Fr(r.bo),r.bo=!1))})),[4,Wh(n,r,e)];case 3:return i.sent(),[3,6];case 4:return[4,yu(i.sent())];case 5:return i.sent(),[3,6];case 6:return[2]}}))}))}function Fh(t,e,n){var r=Mr(t);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){var i=[];r.Po.forEach((function(t,n){var r=n.view.zr(e);r.snapshot&&i.push(r.snapshot)})),function(t,e){var n=Mr(t);n.onlineState=e;var r=!1;n.queries.forEach((function(t,n){for(var i=0,o=n.listeners;i<o.length;i++)o[i].zr(e)&&(r=!0)})),r&&bh(n)}(r.eventManager,e),i.length&&r.vo._r(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function Mh(t,e,n){return s(this,void 0,void 0,(function(){var r,i,o,s,u,c;return a(this,(function(a){switch(a.label){case 0:return(r=Mr(t)).sharedClientState.updateQueryState(e,"rejected",n),i=r.Co.get(e),(o=i&&i.key)?(s=(s=new Yo(hi.comparator)).insert(o,Ni.newNoDocument(o,Gr.min())),u=as().add(o),c=new hs(Gr.min(),new Map,new Jo(Ur),s,u),[4,Lh(r,c)]):[3,2];case 1:return a.sent(),r.Do=r.Do.remove(o),r.Co.delete(e),Hh(r),[3,4];case 2:return[4,Yu(r.localStore,e,!1).then((function(){return Kh(r,e,n)})).catch(yu)];case 3:a.sent(),a.label=4;case 4:return[2]}}))}))}function Vh(t,e){return s(this,void 0,void 0,(function(){var n,r,i;return a(this,(function(o){switch(o.label){case 0:n=Mr(t),r=e.batch.batchId,o.label=1;case 1:return o.trys.push([1,4,,6]),[4,Ku(n.localStore,e)];case 2:return i=o.sent(),Bh(n,r,null),jh(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),[4,Wh(n,i)];case 3:return o.sent(),[3,6];case 4:return[4,yu(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}}))}))}function qh(t,e,n){return s(this,void 0,void 0,(function(){var r,i;return a(this,(function(o){switch(o.label){case 0:r=Mr(t),o.label=1;case 1:return o.trys.push([1,4,,6]),[4,function(t,e){var n=Mr(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",(function(t){var r;return n._n.lookupMutationBatch(t,e).next((function(e){return Fr(null!==e),r=e.keys(),n._n.removeMutationBatch(t,e)})).next((function(){return n._n.performConsistencyCheck(t)})).next((function(){return n.Mn.pn(t,r)}))}))}(r.localStore,e)];case 2:return i=o.sent(),Bh(r,e,n),jh(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),[4,Wh(r,i)];case 3:return o.sent(),[3,6];case 4:return[4,yu(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}}))}))}function Uh(t,e){return s(this,void 0,void 0,(function(){var n,r,i,o,s;return a(this,(function(a){switch(a.label){case 0:zc((n=Mr(t)).remoteStore)||xr("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,function(t){var e=Mr(t);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(function(t){return e._n.getHighestUnacknowledgedBatchId(t)}))}(n.localStore)];case 2:return-1===(r=a.sent())?[2,void e.resolve()]:((i=n.ko.get(r)||[]).push(e),n.ko.set(r,i),[3,4]);case 3:return o=a.sent(),s=hh(o,"Initialization of waitForPendingWrites() operation failed"),e.reject(s),[3,4];case 4:return[2]}}))}))}function jh(t,e){(t.ko.get(e)||[]).forEach((function(t){t.resolve()})),t.ko.delete(e)}function Bh(t,e,n){var r=Mr(t),i=r.xo[r.currentUser.toKey()];if(i){var o=i.get(e);o&&(n?o.reject(n):o.resolve(),i=i.remove(e)),r.xo[r.currentUser.toKey()]=i}}function Kh(t,e,n){void 0===n&&(n=null),t.sharedClientState.removeLocalQueryTarget(e);for(var r=0,i=t.Vo.get(e);r<i.length;r++){var o=i[r];t.Po.delete(o),n&&t.vo.Mo(o,n)}t.Vo.delete(e),t.isPrimaryClient&&t.No.Zn(e).forEach((function(e){t.No.containsKey(e)||Gh(t,e)}))}function Gh(t,e){t.So.delete(e.path.canonicalString());var n=t.Do.get(e);null!==n&&(jc(t.remoteStore,n),t.Do=t.Do.remove(e),t.Co.delete(n),Hh(t))}function Qh(t,e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];o instanceof Sh?(t.No.addReference(o.key,e),zh(t,o)):o instanceof Dh?(xr("SyncEngine","Document no longer in limbo: "+o.key),t.No.removeReference(o.key,e),t.No.containsKey(o.key)||Gh(t,o.key)):Lr()}}function zh(t,e){var n=e.key,r=n.path.canonicalString();t.Do.get(n)||t.So.has(r)||(xr("SyncEngine","New document in limbo: "+n),t.So.add(r),Hh(t))}function Hh(t){for(;t.So.size>0&&t.Do.size<t.maxConcurrentLimboResolutions;){var e=t.So.values().next().value;t.So.delete(e);var n=new hi(Yr.fromString(e)),r=t.Fo.next();t.Co.set(r,new kh(n)),t.Do=t.Do.insert(n,r),Uc(t.remoteStore,new Fa(ro(Xi(n.path)),r,2,Dr.o))}}function Wh(t,e,n){return s(this,void 0,void 0,(function(){var r,i,o,u;return a(this,(function(c){switch(c.label){case 0:return r=Mr(t),i=[],o=[],u=[],r.Po.isEmpty()?[3,3]:(r.Po.forEach((function(t,s){u.push(r.Oo(s,e,n).then((function(t){if(t){r.isPrimaryClient&&r.sharedClientState.updateQueryState(s.targetId,t.fromCache?"not-current":"current"),i.push(t);var e=Vu.Pn(s.targetId,t);o.push(e)}})))})),[4,Promise.all(u)]);case 1:return c.sent(),r.vo._r(i),[4,function(t,e){return s(this,void 0,void 0,(function(){var n,r,i,o,s,u,c,h,l;return a(this,(function(a){switch(a.label){case 0:n=Mr(t),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(function(t){return Ia.forEach(e,(function(e){return Ia.forEach(e.bn,(function(r){return n.persistence.referenceDelegate.addReference(t,e.targetId,r)})).next((function(){return Ia.forEach(e.vn,(function(r){return n.persistence.referenceDelegate.removeReference(t,e.targetId,r)}))}))}))}))];case 2:return a.sent(),[3,4];case 3:if(!Na(r=a.sent()))throw r;return xr("LocalStore","Failed to update sequence numbers: "+r),[3,4];case 4:for(i=0,o=e;i<o.length;i++)s=o[i],u=s.targetId,s.fromCache||(c=n.kn.get(u),h=c.snapshotVersion,l=c.withLastLimboFreeSnapshotVersion(h),n.kn=n.kn.insert(u,l));return[2]}}))}))}(r.localStore,o)];case 2:c.sent(),c.label=3;case 3:return[2]}}))}))}function Yh(t,e){return s(this,void 0,void 0,(function(){var n,r;return a(this,(function(i){switch(i.label){case 0:return(n=Mr(t)).currentUser.isEqual(e)?[3,3]:(xr("SyncEngine","User change. New user:",e.toKey()),[4,Bu(n.localStore,e)]);case 1:return r=i.sent(),n.currentUser=e,function(t,e){t.ko.forEach((function(t){t.forEach((function(t){t.reject(new Ar(Nr.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),t.ko.clear()}(n),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),[4,Wh(n,r.Ln)];case 2:i.sent(),i.label=3;case 3:return[2]}}))}))}function Xh(t,e){var n=Mr(t),r=n.Co.get(e);if(r&&r.bo)return as().add(r.key);var i=as(),o=n.Vo.get(e);if(!o)return i;for(var s=0,a=o;s<a.length;s++){var u=a[s],c=n.Po.get(u);i=i.unionWith(c.view.wo)}return i}function $h(t,e){return s(this,void 0,void 0,(function(){var n,r,i;return a(this,(function(o){switch(o.label){case 0:return[4,Xu((n=Mr(t)).localStore,e.query,!0)];case 1:return r=o.sent(),i=e.view.Ao(r),[2,(n.isPrimaryClient&&Qh(n,e.targetId,i.To),i)]}}))}))}function Jh(t){return s(this,void 0,void 0,(function(){var e;return a(this,(function(n){return[2,Ju((e=Mr(t)).localStore).then((function(t){return Wh(e,t)}))]}))}))}function Zh(t,e,n,r){return s(this,void 0,void 0,(function(){var i,o;return a(this,(function(s){switch(s.label){case 0:return[4,function(t,e){var n=Mr(t),r=Mr(n._n);return n.persistence.runTransaction("Lookup mutation documents","readonly",(function(t){return r.jt(t,e).next((function(e){return e?n.Mn.pn(t,e):Ia.resolve(null)}))}))}((i=Mr(t)).localStore,e)];case 1:return null===(o=s.sent())?[3,6]:"pending"!==n?[3,3]:[4,Zc(i.remoteStore)];case 2:return s.sent(),[3,4];case 3:"acknowledged"===n||"rejected"===n?(Bh(i,e,r||null),jh(i,e),function(t,e){Mr(Mr(t)._n).Gt(e)}(i.localStore,e)):Lr(),s.label=4;case 4:return[4,Wh(i,o)];case 5:return s.sent(),[3,7];case 6:xr("SyncEngine","Cannot apply mutation batch with id: "+e),s.label=7;case 7:return[2]}}))}))}function tl(t,e){return s(this,void 0,void 0,(function(){var n,r,i,o,s,u,c,h;return a(this,(function(a){switch(a.label){case 0:return sl(n=Mr(t)),al(n),!0!==e||!0===n.$o?[3,3]:(r=n.sharedClientState.getAllActiveQueryTargets(),[4,el(n,r.toArray())]);case 1:return i=a.sent(),n.$o=!0,[4,sh(n.remoteStore,!0)];case 2:for(a.sent(),o=0,s=i;o<s.length;o++)u=s[o],Uc(n.remoteStore,u);return[3,7];case 3:return!1!==e||!1===n.$o?[3,7]:(c=[],h=Promise.resolve(),n.Vo.forEach((function(t,e){n.sharedClientState.isLocalQueryTarget(e)?c.push(e):h=h.then((function(){return Kh(n,e),Yu(n.localStore,e,!0)})),jc(n.remoteStore,e)})),[4,h]);case 4:return a.sent(),[4,el(n,c)];case 5:return a.sent(),function(t){var e=Mr(t);e.Co.forEach((function(t,n){jc(e.remoteStore,n)})),e.No.ts(),e.Co=new Map,e.Do=new Yo(hi.comparator)}(n),n.$o=!1,[4,sh(n.remoteStore,!1)];case 6:a.sent(),a.label=7;case 7:return[2]}}))}))}function el(t,e,n){return s(this,void 0,void 0,(function(){var n,r,i,o,s,u,c,h,l,f,d,p,y,g;return a(this,(function(a){switch(a.label){case 0:n=Mr(t),r=[],i=[],o=0,s=e,a.label=1;case 1:return o<s.length?(u=s[o],c=void 0,(h=n.Vo.get(u))&&0!==h.length?[4,Wu(n.localStore,ro(h[0]))]:[3,7]):[3,13];case 2:c=a.sent(),l=0,f=h,a.label=3;case 3:return l<f.length?(d=f[l],p=n.Po.get(d),[4,$h(n,p)]):[3,6];case 4:(y=a.sent()).snapshot&&i.push(y.snapshot),a.label=5;case 5:return l++,[3,3];case 6:return[3,11];case 7:return[4,$u(n.localStore,u)];case 8:return g=a.sent(),[4,Wu(n.localStore,g)];case 9:return c=a.sent(),[4,Rh(n,nl(g),u,!1)];case 10:a.sent(),a.label=11;case 11:r.push(c),a.label=12;case 12:return o++,[3,1];case 13:return[2,(n.vo._r(i),r)]}}))}))}function nl(t){return Yi(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function rl(t){var e=Mr(t);return Mr(Mr(e.localStore).persistence).fn()}function il(t,e,n,r){return s(this,void 0,void 0,(function(){var i,o,s;return a(this,(function(a){switch(a.label){case 0:return(i=Mr(t)).$o?(xr("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!i.Vo.has(e))return[3,8];switch(n){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,Ju(i.localStore)];case 3:return o=a.sent(),s=hs.createSynthesizedRemoteEventForCurrentChange(e,"current"===n),[4,Wh(i,o,s)];case 4:return a.sent(),[3,8];case 5:return[4,Yu(i.localStore,e,!0)];case 6:return a.sent(),Kh(i,e,r),[3,8];case 7:Lr(),a.label=8;case 8:return[2]}}))}))}function ol(t,e,n){return s(this,void 0,void 0,(function(){var r,i,o,s,u,c,h,l,f,d;return a(this,(function(p){switch(p.label){case 0:if(!(r=sl(t)).$o)return[3,10];i=0,o=e,p.label=1;case 1:return i<o.length?(s=o[i],r.Vo.has(s)?(xr("SyncEngine","Adding an already active target "+s),[3,5]):[4,$u(r.localStore,s)]):[3,6];case 2:return u=p.sent(),[4,Wu(r.localStore,u)];case 3:return c=p.sent(),[4,Rh(r,nl(u),c.targetId,!1)];case 4:p.sent(),Uc(r.remoteStore,c),p.label=5;case 5:return i++,[3,1];case 6:h=function(t){return a(this,(function(e){switch(e.label){case 0:return r.Vo.has(t)?[4,Yu(r.localStore,t,!1).then((function(){jc(r.remoteStore,t),Kh(r,t)})).catch(yu)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))},l=0,f=n,p.label=7;case 7:return l<f.length?(d=f[l],[5,h(d)]):[3,10];case 8:p.sent(),p.label=9;case 9:return l++,[3,7];case 10:return[2]}}))}))}function sl(t){var e=Mr(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=Lh.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Xh.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Mh.bind(null,e),e.vo._r=mh.bind(null,e.eventManager),e.vo.Mo=wh.bind(null,e.eventManager),e}function al(t){var e=Mr(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Vh.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=qh.bind(null,e),e}var ul=function(){function t(){this.synchronizeTabs=!1}return t.prototype.initialize=function(t){return s(this,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return this.R=Cc(t.databaseInfo.databaseId),this.sharedClientState=this.Bo(t),this.persistence=this.qo(t),[4,this.persistence.start()];case 1:return e.sent(),this.gcScheduler=this.Uo(t),this.localStore=this.Ko(t),[2]}}))}))},t.prototype.Uo=function(t){return null},t.prototype.Ko=function(t){return ju(this.persistence,new qu,t.initialUser,this.R)},t.prototype.qo=function(t){return new cc(lc.bs,this.R)},t.prototype.Bo=function(t){return new Ic},t.prototype.terminate=function(){return s(this,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return this.gcScheduler&&this.gcScheduler.stop(),[4,this.sharedClientState.shutdown()];case 1:return t.sent(),[4,this.persistence.shutdown()];case 2:return t.sent(),[2]}}))}))},t}(),cl=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).Qo=e,i.cacheSizeBytes=n,i.forceOwnership=r,i.synchronizeTabs=!1,i}return o(e,t),e.prototype.initialize=function(e){return s(this,void 0,void 0,(function(){var n=this;return a(this,(function(r){switch(r.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return r.sent(),[4,Zu(this.localStore)];case 2:return r.sent(),[4,this.Qo.initialize(this,e)];case 3:return r.sent(),[4,al(this.Qo.syncEngine)];case 4:return r.sent(),[4,Zc(this.Qo.remoteStore)];case 5:return r.sent(),[4,this.persistence.He((function(){return n.gcScheduler&&!n.gcScheduler.started&&n.gcScheduler.start(n.localStore),Promise.resolve()}))];case 6:return r.sent(),[2]}}))}))},e.prototype.Ko=function(t){return ju(this.persistence,new qu,t.initialUser,this.R)},e.prototype.Uo=function(t){var e=this.persistence.referenceDelegate.garbageCollector;return new mu(e,t.asyncQueue)},e.prototype.qo=function(t){var e=Lu(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?nu.withCacheSize(this.cacheSizeBytes):nu.DEFAULT;return new Ru(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,Ac(),kc(),this.R,this.sharedClientState,!!this.forceOwnership)},e.prototype.Bo=function(t){return new Ic},e}(ul),hl=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n,!1)||this).Qo=e,r.cacheSizeBytes=n,r.synchronizeTabs=!0,r}return o(e,t),e.prototype.initialize=function(e){return s(this,void 0,void 0,(function(){var n,r=this;return a(this,(function(i){switch(i.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return i.sent(),n=this.Qo.syncEngine,this.sharedClientState instanceof Tc?(this.sharedClientState.syncEngine={ui:Zh.bind(null,n),ai:il.bind(null,n),hi:ol.bind(null,n),fn:rl.bind(null,n),ci:Jh.bind(null,n)},[4,this.sharedClientState.start()]):[3,3];case 2:i.sent(),i.label=3;case 3:return[4,this.persistence.He((function(t){return s(r,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return[4,tl(this.Qo.syncEngine,t)];case 1:return e.sent(),this.gcScheduler&&(t&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):t||this.gcScheduler.stop()),[2]}}))}))}))];case 4:return i.sent(),[2]}}))}))},e.prototype.Bo=function(t){var e=Ac();if(!Tc.yt(e))throw new Ar(Nr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=Lu(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new Tc(e,t.asyncQueue,n,t.clientId,t.initialUser)},e}(cl),ll=function(){function t(){}return t.prototype.initialize=function(t,e){return s(this,void 0,void 0,(function(){var n=this;return a(this,(function(r){switch(r.label){case 0:return this.localStore?[3,2]:(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(t){return Fh(n.syncEngine,t,1)},this.remoteStore.remoteSyncer.handleCredentialChange=Yh.bind(null,this.syncEngine),[4,sh(this.remoteStore,this.syncEngine.isPrimaryClient)]);case 1:r.sent(),r.label=2;case 2:return[2]}}))}))},t.prototype.createEventManager=function(t){return new yh},t.prototype.createDatastore=function(t){var e,n=Cc(t.databaseInfo.databaseId),r=(e=t.databaseInfo,new Nc(e));return function(t,e,n){return new Lc(t,e,n)}(t.credentials,r,n)},t.prototype.createRemoteStore=function(t){var e,n,r,i,o,s=this;return e=this.localStore,n=this.datastore,r=t.asyncQueue,i=function(t){return Fh(s.syncEngine,t,0)},o=_c.yt()?new _c:new Ec,new Mc(e,n,r,i,o)},t.prototype.createSyncEngine=function(t,e){return function(t,e,n,r,i,o,s){var a=new Ch(t,e,n,r,i,o);return s&&(a.$o=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)},t.prototype.terminate=function(){return function(t){return s(this,void 0,void 0,(function(){var e;return a(this,(function(n){switch(n.label){case 0:return e=Mr(t),xr("RemoteStore","RemoteStore shutting down."),e.Or.add(5),[4,qc(e)];case 1:return n.sent(),e.Lr.shutdown(),e.Br.set("Unknown"),[2]}}))}))}(this.remoteStore)},t}();var fl=function(){function t(t){this.observer=t,this.muted=!1}return t.prototype.next=function(t){this.observer.next&&this.jo(this.observer.next,t)},t.prototype.error=function(t){this.observer.error?this.jo(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},t.prototype.Wo=function(){this.muted=!0},t.prototype.jo=function(t,e){var n=this;this.muted||setTimeout((function(){n.muted||t(e)}),0)},t}(),dl=(function(){function t(t,e){var n=this;this.Go=t,this.R=e,this.metadata=new Ta,this.buffer=new Uint8Array,this.zo=new TextDecoder("utf-8"),this.Ho().then((function(t){t&&t.io()?n.metadata.resolve(t.payload.metadata):n.metadata.reject(new Error("The first element of the bundle is not a metadata, it is\n             "+JSON.stringify(null==t?void 0:t.payload)))}),(function(t){return n.metadata.reject(t)}))}t.prototype.close=function(){return this.Go.cancel()},t.prototype.getMetadata=function(){return s(this,void 0,void 0,(function(){return a(this,(function(t){return[2,this.metadata.promise]}))}))},t.prototype.Lo=function(){return s(this,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return[4,this.getMetadata()];case 1:return[2,(t.sent(),this.Ho())]}}))}))},t.prototype.Ho=function(){return s(this,void 0,void 0,(function(){var t,e,n,r;return a(this,(function(i){switch(i.label){case 0:return[4,this.Jo()];case 1:return null===(t=i.sent())?[2,null]:(e=this.zo.decode(t),n=Number(e),isNaN(n)&&this.Yo("length string ("+e+") is not valid number"),[4,this.Xo(n)]);case 2:return r=i.sent(),[2,new Ih(JSON.parse(r),t.length+n)]}}))}))},t.prototype.Zo=function(){return this.buffer.findIndex((function(t){return t==="{".charCodeAt(0)}))},t.prototype.Jo=function(){return s(this,void 0,void 0,(function(){var t,e;return a(this,(function(n){switch(n.label){case 0:return this.Zo()<0?[4,this.tc()]:[3,3];case 1:if(n.sent())return[3,3];n.label=2;case 2:return[3,0];case 3:return 0===this.buffer.length?[2,null]:((t=this.Zo())<0&&this.Yo("Reached the end of bundle when a length string is expected."),e=this.buffer.slice(0,t),[2,(this.buffer=this.buffer.slice(t),e)])}}))}))},t.prototype.Xo=function(t){return s(this,void 0,void 0,(function(){var e;return a(this,(function(n){switch(n.label){case 0:return this.buffer.length<t?[4,this.tc()]:[3,3];case 1:n.sent()&&this.Yo("Reached the end of bundle when more is expected."),n.label=2;case 2:return[3,0];case 3:return e=this.zo.decode(this.buffer.slice(0,t)),[2,(this.buffer=this.buffer.slice(t),e)]}}))}))},t.prototype.Yo=function(t){throw this.Go.cancel(),new Error("Invalid bundle format: "+t)},t.prototype.tc=function(){return s(this,void 0,void 0,(function(){var t,e;return a(this,(function(n){switch(n.label){case 0:return[4,this.Go.read()];case 1:return(t=n.sent()).done||((e=new Uint8Array(this.buffer.length+t.value.length)).set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e),[2,t.done]}}))}))}}(),function(){function t(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}return t.prototype.lookup=function(t){return s(this,void 0,void 0,(function(){var e,n=this;return a(this,(function(r){switch(r.label){case 0:if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new Ar(Nr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(t,e){return s(this,void 0,void 0,(function(){var n,r,i,o,s,u;return a(this,(function(a){switch(a.label){case 0:return n=Mr(t),r=Rs(n.R)+"/documents",i={documents:e.map((function(t){return As(n.R,t)}))},[4,n.$i("BatchGetDocuments",r,i)];case 1:return o=a.sent(),s=new Map,o.forEach((function(t){var e=function(t,e){return"found"in e?function(t,e){Fr(!!e.found),e.found.name,e.found.updateTime;var n=ks(t,e.found.name),r=Ss(e.found.updateTime),i=new Si({mapValue:{fields:e.found.fields}});return Ni.newFoundDocument(n,r,i)}(t,e):"missing"in e?function(t,e){Fr(!!e.missing),Fr(!!e.readTime);var n=ks(t,e.missing),r=Ss(e.readTime);return Ni.newNoDocument(n,r)}(t,e):Lr()}(n.R,t);s.set(e.key.toString(),e)})),u=[],[2,(e.forEach((function(t){var e=s.get(t.toString());Fr(!!e),u.push(e)})),u)]}}))}))}(this.datastore,t)];case 1:return[2,((e=r.sent()).forEach((function(t){return n.recordVersion(t)})),e)]}}))}))},t.prototype.set=function(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.update=function(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t.toString())},t.prototype.delete=function(t){this.write(new Go(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.commit=function(){return s(this,void 0,void 0,(function(){var t,e=this;return a(this,(function(n){switch(n.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;return t=this.readVersions,this.mutations.forEach((function(e){t.delete(e.key.toString())})),t.forEach((function(t,n){var r=hi.fromPath(n);e.mutations.push(new Qo(r,e.precondition(r)))})),[4,function(t,e){return s(this,void 0,void 0,(function(){var n,r,i;return a(this,(function(o){switch(o.label){case 0:return n=Mr(t),r=Rs(n.R)+"/documents",i={writes:e.map((function(t){return Fs(n.R,t)}))},[4,n.Ni("Commit",r,i)];case 1:return o.sent(),[2]}}))}))}(this.datastore,this.mutations)];case 1:return n.sent(),this.committed=!0,[2]}}))}))},t.prototype.recordVersion=function(t){var e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw Lr();e=Gr.min()}var n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new Ar(Nr.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)},t.prototype.precondition=function(t){var e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?ko.updateTime(e):ko.none()},t.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(Gr.min()))throw new Ar(Nr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return ko.updateTime(e)}return ko.exists(!0)},t.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations.push(t)},t.prototype.ensureCommitNotCalled=function(){},t}()),pl=function(){function t(t,e,n,r){this.asyncQueue=t,this.datastore=e,this.updateFunction=n,this.deferred=r,this.ec=5,this.Zi=new xc(this.asyncQueue,"transaction_retry")}return t.prototype.run=function(){this.ec-=1,this.nc()},t.prototype.nc=function(){var t=this;this.Zi.ji((function(){return s(t,void 0,void 0,(function(){var t,e,n=this;return a(this,(function(r){return t=new dl(this.datastore),(e=this.sc(t))&&e.then((function(e){n.asyncQueue.enqueueAndForget((function(){return t.commit().then((function(){n.deferred.resolve(e)})).catch((function(t){n.ic(t)}))}))})).catch((function(t){n.ic(t)})),[2]}))}))}))},t.prototype.sc=function(t){try{var e=this.updateFunction(t);return!ai(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}},t.prototype.ic=function(t){var e=this;this.ec>0&&this.rc(t)?(this.ec-=1,this.asyncQueue.enqueueAndForget((function(){return e.nc(),Promise.resolve()}))):this.deferred.reject(t)},t.prototype.rc=function(t){if("FirebaseError"===t.name){var e=t.code;return"aborted"===e||"failed-precondition"===e||!Ho(e)}return!1},t}(),yl=function(){function t(t,e,n){var r=this;this.credentials=t,this.asyncQueue=e,this.databaseInfo=n,this.user=fc.UNAUTHENTICATED,this.clientId=qr.u(),this.credentialListener=function(){return Promise.resolve()},this.credentials.setChangeListener(e,(function(t){return s(r,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return xr("FirestoreClient","Received user=",t.uid),[4,this.credentialListener(t)];case 1:return e.sent(),this.user=t,[2]}}))}))}))}return t.prototype.getConfiguration=function(){return s(this,void 0,void 0,(function(){return a(this,(function(t){return[2,{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100}]}))}))},t.prototype.setCredentialChangeListener=function(t){this.credentialListener=t},t.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new Ar(Nr.FAILED_PRECONDITION,"The client has already been terminated.")},t.prototype.terminate=function(){var t=this;this.asyncQueue.enterRestrictedMode();var e=new Ta;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((function(){return s(t,void 0,void 0,(function(){var t,n;return a(this,(function(r){switch(r.label){case 0:return r.trys.push([0,5,,6]),this.onlineComponents?[4,this.onlineComponents.terminate()]:[3,2];case 1:r.sent(),r.label=2;case 2:return this.offlineComponents?[4,this.offlineComponents.terminate()]:[3,4];case 3:r.sent(),r.label=4;case 4:return this.credentials.removeChangeListener(),e.resolve(),[3,6];case 5:return t=r.sent(),n=hh(t,"Failed to shutdown persistence"),e.reject(n),[3,6];case 6:return[2]}}))}))})),e.promise},t}();function gl(t,e){return s(this,void 0,void 0,(function(){var n,r,i=this;return a(this,(function(o){switch(o.label){case 0:return t.asyncQueue.verifyOperationInProgress(),xr("FirestoreClient","Initializing OfflineComponentProvider"),[4,t.getConfiguration()];case 1:return n=o.sent(),[4,e.initialize(n)];case 2:return o.sent(),r=n.initialUser,t.setCredentialChangeListener((function(t){return s(i,void 0,void 0,(function(){return a(this,(function(n){switch(n.label){case 0:return r.isEqual(t)?[3,2]:[4,Bu(e.localStore,t)];case 1:n.sent(),r=t,n.label=2;case 2:return[2]}}))}))})),e.persistence.setDatabaseDeletedListener((function(){return t.terminate()})),t.offlineComponents=e,[2]}}))}))}function vl(t,e){return s(this,void 0,void 0,(function(){var n,r;return a(this,(function(i){switch(i.label){case 0:return t.asyncQueue.verifyOperationInProgress(),[4,ml(t)];case 1:return n=i.sent(),xr("FirestoreClient","Initializing OnlineComponentProvider"),[4,t.getConfiguration()];case 2:return r=i.sent(),[4,e.initialize(n,r)];case 3:return i.sent(),t.setCredentialChangeListener((function(t){return function(t,e){return s(this,void 0,void 0,(function(){var n,r;return a(this,(function(i){switch(i.label){case 0:return(n=Mr(t)).asyncQueue.verifyOperationInProgress(),xr("RemoteStore","RemoteStore received new credentials"),r=zc(n),n.Or.add(3),[4,qc(n)];case 1:return i.sent(),r&&n.Br.set("Unknown"),[4,n.remoteSyncer.handleCredentialChange(e)];case 2:return i.sent(),n.Or.delete(3),[4,Vc(n)];case 3:return i.sent(),[2]}}))}))}(e.remoteStore,t)})),t.onlineComponents=e,[2]}}))}))}function ml(t){return s(this,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return t.offlineComponents?[3,2]:(xr("FirestoreClient","Using default OfflineComponentProvider"),[4,gl(t,new ul)]);case 1:e.sent(),e.label=2;case 2:return[2,t.offlineComponents]}}))}))}function wl(t){return s(this,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return t.onlineComponents?[3,2]:(xr("FirestoreClient","Using default OnlineComponentProvider"),[4,vl(t,new ll)]);case 1:e.sent(),e.label=2;case 2:return[2,t.onlineComponents]}}))}))}function bl(t){return ml(t).then((function(t){return t.persistence}))}function Tl(t){return ml(t).then((function(t){return t.localStore}))}function Il(t){return wl(t).then((function(t){return t.remoteStore}))}function El(t){return wl(t).then((function(t){return t.syncEngine}))}function _l(t){return s(this,void 0,void 0,(function(){var e,n;return a(this,(function(r){switch(r.label){case 0:return[4,wl(t)];case 1:return e=r.sent(),[2,((n=e.eventManager).onListen=xh.bind(null,e.syncEngine),n.onUnlisten=Oh.bind(null,e.syncEngine),n)]}}))}))}function Sl(t,e,n){var r=this;void 0===n&&(n={});var i=new Ta;return t.asyncQueue.enqueueAndForget((function(){return s(r,void 0,void 0,(function(){var r;return a(this,(function(o){switch(o.label){case 0:return r=function(t,e,n,r,i){var o=new fl({next:function(o){e.enqueueAndForget((function(){return vh(t,s)}));var a=o.docs.has(n);!a&&o.fromCache?i.reject(new Ar(Nr.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&o.fromCache&&r&&"server"===r.source?i.reject(new Ar(Nr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(o)},error:function(t){return i.reject(t)}}),s=new Th(Xi(n.path),o,{includeMetadataChanges:!0,so:!0});return gh(t,s)},[4,_l(t)];case 1:return[2,r.apply(void 0,[o.sent(),t.asyncQueue,e,n,i])]}}))}))})),i.promise}function Dl(t,e,n){var r=this;void 0===n&&(n={});var i=new Ta;return t.asyncQueue.enqueueAndForget((function(){return s(r,void 0,void 0,(function(){var r;return a(this,(function(o){switch(o.label){case 0:return r=function(t,e,n,r,i){var o=new fl({next:function(n){e.enqueueAndForget((function(){return vh(t,s)})),n.fromCache&&"server"===r.source?i.reject(new Ar(Nr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:function(t){return i.reject(t)}}),s=new Th(n,o,{includeMetadataChanges:!0,so:!0});return gh(t,s)},[4,_l(t)];case 1:return[2,r.apply(void 0,[o.sent(),t.asyncQueue,e,n,i])]}}))}))})),i.promise}var Nl=function(t,e,n,r,i,o,s,a){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=s,this.useFetchStreams=a},Al=function(){function t(t,e){this.projectId=t,this.database=e||"(default)"}return Object.defineProperty(t.prototype,"isDefaultDatabase",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database},t}(),kl=new Map,Cl=function(t,e){this.user=e,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization="Bearer "+t},xl=function(){function t(){this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(null)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t,e){this.changeListener=e,t.enqueueRetryable((function(){return e(fc.UNAUTHENTICATED)}))},t.prototype.removeChangeListener=function(){this.changeListener=null},t}(),Rl=function(){function t(t){this.token=t,this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(this.token)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t,e){var n=this;this.changeListener=e,t.enqueueRetryable((function(){return e(n.token.user)}))},t.prototype.removeChangeListener=function(){this.changeListener=null},t}(),Ol=function(){function t(t){var e=this;this.currentUser=fc.UNAUTHENTICATED,this.oc=new Ta,this.cc=0,this.forceRefresh=!1,this.auth=null,this.asyncQueue=null,this.uc=function(){e.cc++,e.currentUser=e.ac(),e.oc.resolve(),e.changeListener&&e.asyncQueue.enqueueRetryable((function(){return e.changeListener(e.currentUser)}))};var n=function(t){xr("FirebaseCredentialsProvider","Auth detected"),e.auth=t,e.auth.addAuthTokenListener(e.uc)};t.onInit((function(t){return n(t)})),setTimeout((function(){if(!e.auth){var r=t.getImmediate({optional:!0});r?n(r):(xr("FirebaseCredentialsProvider","Auth not yet detected"),e.oc.resolve())}}),0)}return t.prototype.getToken=function(){var t=this,e=this.cc,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((function(n){return t.cc!==e?(xr("FirebaseCredentialsProvider","getToken aborted due to token change."),t.getToken()):n?(Fr("string"==typeof n.accessToken),new Cl(n.accessToken,t.currentUser)):null})):Promise.resolve(null)},t.prototype.invalidateToken=function(){this.forceRefresh=!0},t.prototype.setChangeListener=function(t,e){var n=this;this.asyncQueue=t,this.asyncQueue.enqueueRetryable((function(){return s(n,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return[4,this.oc.promise];case 1:return t.sent(),[4,e(this.currentUser)];case 2:return t.sent(),this.changeListener=e,[2]}}))}))}))},t.prototype.removeChangeListener=function(){this.auth&&this.auth.removeAuthTokenListener(this.uc),this.changeListener=function(){return Promise.resolve()}},t.prototype.ac=function(){var t=this.auth&&this.auth.getUid();return Fr(null===t||"string"==typeof t),new fc(t)},t}(),Pl=function(){function t(t,e,n){this.hc=t,this.lc=e,this.fc=n,this.type="FirstParty",this.user=fc.FIRST_PARTY}return Object.defineProperty(t.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.lc},e=this.hc.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),this.fc&&(t["X-Goog-Iam-Authorization-Token"]=this.fc),t},enumerable:!1,configurable:!0}),t}(),Ll=function(){function t(t,e,n){this.hc=t,this.lc=e,this.fc=n}return t.prototype.getToken=function(){return Promise.resolve(new Pl(this.hc,this.lc,this.fc))},t.prototype.setChangeListener=function(t,e){t.enqueueRetryable((function(){return e(fc.FIRST_PARTY)}))},t.prototype.removeChangeListener=function(){},t.prototype.invalidateToken=function(){},t}();function Fl(t,e,n){if(!n)throw new Ar(Nr.INVALID_ARGUMENT,"Function "+t+"() cannot be called with an empty "+e+".")}function Ml(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new Ar(Nr.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function Vl(t,e,n,r){if(!0===e&&!0===r)throw new Ar(Nr.INVALID_ARGUMENT,t+" and "+n+" cannot be used together.")}function ql(t){if(!hi.isDocumentKey(t))throw new Ar(Nr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t+" has "+t.length+".")}function Ul(t){if(hi.isDocumentKey(t))throw new Ar(Nr.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t+" has "+t.length+".")}function jl(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}return"function"==typeof t?"a function":Lr()}function Bl(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Ar(Nr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=jl(t);throw new Ar(Nr.INVALID_ARGUMENT,"Expected type '"+e.name+"', but it was: "+n)}return t}function Kl(t,e){if(e<=0)throw new Ar(Nr.INVALID_ARGUMENT,"Function "+t+"() requires a positive number, but it was: "+e+".")}var Gl=function(){function t(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new Ar(Nr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new Ar(Nr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,Vl("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}return t.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams},t}(),Ql=function(){function t(t,e){this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Gl({}),this._settingsFrozen=!1,t instanceof Al?(this._databaseId=t,this._credentials=new xl):(this._app=t,this._databaseId=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new Ar(Nr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Al(t.options.projectId)}(t),this._credentials=new Ol(e))}return Object.defineProperty(t.prototype,"app",{get:function(){if(!this._app)throw new Ar(Nr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_initialized",{get:function(){return this._settingsFrozen},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_terminated",{get:function(){return void 0!==this._terminateTask},enumerable:!1,configurable:!0}),t.prototype._setSettings=function(t){if(this._settingsFrozen)throw new Ar(Nr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Gl(t),void 0!==t.credentials&&(this._credentials=function(t){if(!t)return new xl;switch(t.type){case"gapi":var e=t.client;return Fr(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new Ll(e,t.sessionIndex||"0",t.iamToken||null);case"provider":return t.client;default:throw new Ar(Nr.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))},t.prototype._getSettings=function(){return this._settings},t.prototype._freezeSettings=function(){return this._settingsFrozen=!0,this._settings},t.prototype._delete=function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask},t.prototype.toJSON=function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}},t.prototype._terminate=function(){return this,(t=kl.get(this))&&(xr("ComponentProvider","Removing Datastore"),kl.delete(this),t.terminate()),Promise.resolve();var t},t}(),zl=function(){function t(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}return Object.defineProperty(t.prototype,"_path",{get:function(){return this._key.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new Wl(this.firestore,this.converter,this._key.path.popLast())},enumerable:!1,configurable:!0}),t.prototype.withConverter=function(e){return new t(this.firestore,e,this._key)},t}(),Hl=function(){function t(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}return t.prototype.withConverter=function(e){return new t(this.firestore,e,this._query)},t}(),Wl=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,Xi(r))||this)._path=r,i.type="collection",i}return o(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._path.popLast();return t.isEmpty()?null:new zl(this.firestore,null,new hi(t))},enumerable:!1,configurable:!0}),e.prototype.withConverter=function(t){return new e(this.firestore,t,this._path)},e}(Hl);function Yl(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t=(0,c.m9)(t),Fl("collection","path",e),t instanceof Ql)return Ul(n=Yr.fromString.apply(Yr,u([e],r))),new Wl(t,null,n);if(!(t instanceof zl||t instanceof Wl))throw new Ar(Nr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return Ul(n=Yr.fromString.apply(Yr,u([t.path],r)).child(Yr.fromString(e))),new Wl(t.firestore,null,n)}function Xl(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t=(0,c.m9)(t),1===arguments.length&&(e=qr.u()),Fl("doc","path",e),t instanceof Ql)return ql(n=Yr.fromString.apply(Yr,u([e],r))),new zl(t,null,new hi(n));if(!(t instanceof zl||t instanceof Wl))throw new Ar(Nr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return ql(n=t._path.child(Yr.fromString.apply(Yr,u([e],r)))),new zl(t.firestore,t instanceof Wl?t.converter:null,new hi(n))}function $l(t,e){return t=(0,c.m9)(t),e=(0,c.m9)(e),(t instanceof zl||t instanceof Wl)&&(e instanceof zl||e instanceof Wl)&&t.firestore===e.firestore&&t.path===e.path&&t.converter===e.converter}function Jl(t,e){return t=(0,c.m9)(t),e=(0,c.m9)(e),t instanceof Hl&&e instanceof Hl&&t.firestore===e.firestore&&oo(t._query,e._query)&&t.converter===e.converter}var Zl=function(){function t(){var t=this;this.dc=Promise.resolve(),this.wc=[],this._c=!1,this.mc=[],this.yc=null,this.gc=!1,this.Ec=!1,this.Tc=[],this.Zi=new xc(this,"async_queue_retry"),this.Ic=function(){var e=kc();e&&xr("AsyncQueue","Visibility state changed to "+e.visibilityState),t.Zi.Gi()};var e=kc();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Ic)}return Object.defineProperty(t.prototype,"isShuttingDown",{get:function(){return this._c},enumerable:!1,configurable:!0}),t.prototype.enqueueAndForget=function(t){this.enqueue(t)},t.prototype.enqueueAndForgetEvenWhileRestricted=function(t){this.Ac(),this.Rc(t)},t.prototype.enterRestrictedMode=function(t){if(!this._c){this._c=!0,this.Ec=t||!1;var e=kc();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.Ic)}},t.prototype.enqueue=function(t){var e=this;if(this.Ac(),this._c)return new Promise((function(){}));var n=new Ta;return this.Rc((function(){return e._c&&e.Ec?Promise.resolve():(t().then(n.resolve,n.reject),n.promise)})).then((function(){return n.promise}))},t.prototype.enqueueRetryable=function(t){var e=this;this.enqueueAndForget((function(){return e.wc.push(t),e.bc()}))},t.prototype.bc=function(){return s(this,void 0,void 0,(function(){var t,e=this;return a(this,(function(n){switch(n.label){case 0:if(0===this.wc.length)return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.wc[0]()];case 2:return n.sent(),this.wc.shift(),this.Zi.reset(),[3,4];case 3:if(!Na(t=n.sent()))throw t;return xr("AsyncQueue","Operation failed with retryable error: "+t),[3,4];case 4:this.wc.length>0&&this.Zi.ji((function(){return e.bc()})),n.label=5;case 5:return[2]}}))}))},t.prototype.Rc=function(t){var e=this,n=this.dc.then((function(){return e.gc=!0,t().catch((function(t){throw e.yc=t,e.gc=!1,Rr("INTERNAL UNHANDLED ERROR: ",function(t){var e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t)),t})).then((function(t){return e.gc=!1,t}))}));return this.dc=n,n},t.prototype.enqueueAfterDelay=function(t,e,n){var r=this;this.Ac(),this.Tc.indexOf(t)>-1&&(e=0);var i=ch.createAndSchedule(this,t,e,n,(function(t){return r.vc(t)}));return this.mc.push(i),i},t.prototype.Ac=function(){this.yc&&Lr()},t.prototype.verifyOperationInProgress=function(){},t.prototype.Pc=function(){return s(this,void 0,void 0,(function(){var t;return a(this,(function(e){switch(e.label){case 0:return[4,t=this.dc];case 1:e.sent(),e.label=2;case 2:if(t!==this.dc)return[3,0];e.label=3;case 3:return[2]}}))}))},t.prototype.Vc=function(t){for(var e=0,n=this.mc;e<n.length;e++)if(n[e].timerId===t)return!0;return!1},t.prototype.Sc=function(t){var e=this;return this.Pc().then((function(){e.mc.sort((function(t,e){return t.targetTimeMs-e.targetTimeMs}));for(var n=0,r=e.mc;n<r.length;n++){var i=r[n];if(i.skipDelay(),"all"!==t&&i.timerId===t)break}return e.Pc()}))},t.prototype.Dc=function(t){this.Tc.push(t)},t.prototype.vc=function(t){var e=this.mc.indexOf(t);this.mc.splice(e,1)},t}();function tf(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=t,r=0,i=["next","error","complete"];r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}(t)}!function(){function t(){this._progressObserver={},this._taskCompletionResolver=new Ta,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}t.prototype.onProgress=function(t,e,n){this._progressObserver={next:t,error:e,complete:n}},t.prototype.catch=function(t){return this._taskCompletionResolver.promise.catch(t)},t.prototype.then=function(t,e){return this._taskCompletionResolver.promise.then(t,e)},t.prototype._completeWith=function(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)},t.prototype._failWith=function(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)},t.prototype._updateProgress=function(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)}}();var ef=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).type="firestore",r._queue=new Zl,r._persistenceKey="name"in e?e.name:"[DEFAULT]",r}return o(e,t),e.prototype._terminate=function(){return this._firestoreClient||rf(this),this._firestoreClient.terminate()},e}(Ql);function nf(t){return t._firestoreClient||rf(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function rf(t){var e,n=t._freezeSettings(),r=function(t,e,n,r){return new Nl(t,e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,r.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,n);t._firestoreClient=new yl(t._credentials,t._queue,r)}function of(t,e,n){var r=this,i=new Ta;return t.asyncQueue.enqueue((function(){return s(r,void 0,void 0,(function(){var r;return a(this,(function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),[4,gl(t,n)];case 1:return o.sent(),[4,vl(t,e)];case 2:return o.sent(),i.resolve(),[3,4];case 3:if(!function(t){return"FirebaseError"===t.name?t.code===Nr.FAILED_PRECONDITION||t.code===Nr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(r=o.sent()))throw r;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+r),i.reject(r),[3,4];case 4:return[2]}}))}))})).then((function(){return i.promise}))}function sf(t){if(t._initialized||t._terminated)throw new Ar(Nr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var af=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0;n<t.length;++n)if(0===t[n].length)throw new Ar(Nr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new $r(t)}return t.prototype.isEqual=function(t){return this._internalPath.isEqual(t._internalPath)},t}(),uf=function(){function t(t){this._byteString=t}return t.fromBase64String=function(e){try{return new t(Zr.fromBase64String(e))}catch(e){throw new Ar(Nr.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}},t.fromUint8Array=function(e){return new t(Zr.fromUint8Array(e))},t.prototype.toBase64=function(){return this._byteString.toBase64()},t.prototype.toUint8Array=function(){return this._byteString.toUint8Array()},t.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},t.prototype.isEqual=function(t){return this._byteString.isEqual(t._byteString)},t}(),cf=function(t){this._methodName=t},hf=function(){function t(t,e){if(!isFinite(t)||t<-90||t>90)throw new Ar(Nr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new Ar(Nr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}return Object.defineProperty(t.prototype,"latitude",{get:function(){return this._lat},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"longitude",{get:function(){return this._long},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},t.prototype.toJSON=function(){return{latitude:this._lat,longitude:this._long}},t.prototype._compareTo=function(t){return Ur(this._lat,t._lat)||Ur(this._long,t._long)},t}(),lf=/^__.*__$/,ff=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return null!==this.fieldMask?new Vo(t,this.data,this.fieldMask,e,this.fieldTransforms):new Mo(t,this.data,e,this.fieldTransforms)},t}(),df=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return new Vo(t,this.data,this.fieldMask,e,this.fieldTransforms)},t}();function pf(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Lr()}}var yf=function(){function t(t,e,n,r,i,o){this.settings=t,this.databaseId=e,this.R=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Cc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}return Object.defineProperty(t.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Nc",{get:function(){return this.settings.Nc},enumerable:!1,configurable:!0}),t.prototype.xc=function(e){return new t(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.R,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)},t.prototype.kc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.xc({path:n,Fc:!1});return r.$c(t),r},t.prototype.Oc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.xc({path:n,Fc:!1});return r.Cc(),r},t.prototype.Mc=function(t){return this.xc({path:void 0,Fc:!0})},t.prototype.Lc=function(t){return Lf(t,this.settings.methodName,this.settings.Bc||!1,this.path,this.settings.qc)},t.prototype.contains=function(t){return void 0!==this.fieldMask.find((function(e){return t.isPrefixOf(e)}))||void 0!==this.fieldTransforms.find((function(e){return t.isPrefixOf(e.field)}))},t.prototype.Cc=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.$c(this.path.get(t))},t.prototype.$c=function(t){if(0===t.length)throw this.Lc("Document fields must not be empty");if(pf(this.Nc)&&lf.test(t))throw this.Lc('Document fields cannot begin and end with "__"')},t}(),gf=function(){function t(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.R=n||Cc(t)}return t.prototype.Uc=function(t,e,n,r){return void 0===r&&(r=!1),new yf({Nc:t,methodName:e,qc:n,path:$r.emptyPath(),Fc:!1,Bc:r},this.databaseId,this.R,this.ignoreUndefinedProperties)},t}();function vf(t){var e=t._freezeSettings(),n=Cc(t._databaseId);return new gf(t._databaseId,!!e.ignoreUndefinedProperties,n)}function mf(t,e,n,r,i,o){void 0===o&&(o={});var s=t.Uc(o.merge||o.mergeFields?2:0,e,n,i);xf("Data must be an object, but it was:",s,r);var a,u,c=kf(r,s);if(o.merge)a=new Jr(s.fieldMask),u=s.fieldTransforms;else if(o.mergeFields){for(var h=[],l=0,f=o.mergeFields;l<f.length;l++){var d=Rf(e,f[l],n);if(!s.contains(d))throw new Ar(Nr.INVALID_ARGUMENT,"Field '"+d+"' is specified in your field mask but missing from your input data.");Ff(h,d)||h.push(d)}a=new Jr(h),u=s.fieldTransforms.filter((function(t){return a.covers(t.field)}))}else a=null,u=s.fieldTransforms;return new ff(new Si(c),a,u)}var wf=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype._toFieldTransform=function(t){if(2!==t.Nc)throw 1===t.Nc?t.Lc(this._methodName+"() can only appear at the top level of your update data"):t.Lc(this._methodName+"() cannot be used with set() unless you pass {merge:true}");return t.fieldMask.push(t.path),null},e.prototype.isEqual=function(t){return t instanceof e},e}(cf);function bf(t,e,n){return new yf({Nc:3,qc:e.settings.qc,methodName:t._methodName,Fc:n},e.databaseId,e.R,e.ignoreUndefinedProperties)}var Tf=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype._toFieldTransform=function(t){return new No(t.path,new wo)},e.prototype.isEqual=function(t){return t instanceof e},e}(cf),If=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Kc=n,r}return o(e,t),e.prototype._toFieldTransform=function(t){var e=bf(this,t,!0),n=this.Kc.map((function(t){return Af(t,e)})),r=new bo(n);return new No(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(cf),Ef=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Kc=n,r}return o(e,t),e.prototype._toFieldTransform=function(t){var e=bf(this,t,!0),n=this.Kc.map((function(t){return Af(t,e)})),r=new Io(n);return new No(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(cf),_f=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Qc=n,r}return o(e,t),e.prototype._toFieldTransform=function(t){var e=new _o(t.R,po(t.R,this.Qc));return new No(t.path,e)},e.prototype.isEqual=function(t){return this===t},e}(cf);function Sf(t,e,n,r){var i=t.Uc(1,e,n);xf("Data must be an object, but it was:",i,r);var o=[],s=Si.empty();zr(r,(function(t,r){var a=Pf(e,t,n);r=(0,c.m9)(r);var u=i.Oc(a);if(r instanceof wf)o.push(a);else{var h=Af(r,u);null!=h&&(o.push(a),s.set(a,h))}}));var a=new Jr(o);return new df(s,a,i.fieldTransforms)}function Df(t,e,n,r,i,o){var s=t.Uc(1,e,n),a=[Rf(e,r,n)],u=[i];if(o.length%2!=0)throw new Ar(Nr.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var h=0;h<o.length;h+=2)a.push(Rf(e,o[h])),u.push(o[h+1]);for(var l=[],f=Si.empty(),d=a.length-1;d>=0;--d)if(!Ff(l,a[d])){var p=a[d],y=u[d];y=(0,c.m9)(y);var g=s.Oc(p);if(y instanceof wf)l.push(p);else{var v=Af(y,g);null!=v&&(l.push(p),f.set(p,v))}}var m=new Jr(l);return new df(f,m,s.fieldTransforms)}function Nf(t,e,n,r){return void 0===r&&(r=!1),Af(n,t.Uc(r?4:3,e))}function Af(t,e){if(Cf(t=(0,c.m9)(t)))return xf("Unsupported field value:",e,t),kf(t,e);if(t instanceof cf)return function(t,e){if(!pf(e.Nc))throw e.Lc(t._methodName+"() can only be used with update() and set()");if(!e.path)throw e.Lc(t._methodName+"() is not currently supported inside arrays");var n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.Fc&&4!==e.Nc)throw e.Lc("Nested arrays are not supported");return function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var s=Af(o[i],e.Mc(r));null==s&&(s={nullValue:"NULL_VALUE"}),n.push(s),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=(0,c.m9)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return po(e.R,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=Kr.fromDate(t);return{timestampValue:Is(e.R,n)}}if(t instanceof Kr)return n=new Kr(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)),{timestampValue:Is(e.R,n)};if(t instanceof hf)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof uf)return{bytesValue:Es(e.R,t._byteString)};if(t instanceof zl){n=e.databaseId;var r=t.firestore._databaseId;if(!r.isEqual(n))throw e.Lc("Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return{referenceValue:Ds(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.Lc("Unsupported field value: "+jl(t))}(t,e)}function kf(t,e){var n={};return Hr(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):zr(t,(function(t,r){var i=Af(r,e.kc(t));null!=i&&(n[t]=i)})),{mapValue:{fields:n}}}function Cf(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Kr||t instanceof hf||t instanceof uf||t instanceof zl||t instanceof cf)}function xf(t,e,n){if(!Cf(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){var r=jl(n);throw"an object"===r?e.Lc(t+" a custom object"):e.Lc(t+" "+r)}}function Rf(t,e,n){if((e=(0,c.m9)(e))instanceof af)return e._internalPath;if("string"==typeof e)return Pf(t,e);throw Lf("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}var Of=new RegExp("[~\\*/\\[\\]]");function Pf(t,e,n){if(e.search(Of)>=0)throw Lf("Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'",t,!1,void 0,n);try{return(new(af.bind.apply(af,u([void 0],e.split(".")))))._internalPath}catch(r){throw Lf("Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'",t,!1,void 0,n)}}function Lf(t,e,n,r,i){var o=r&&!r.isEmpty(),s=void 0!==i,a="Function "+e+"() called with invalid data";n&&(a+=" (via `toFirestore()`)");var u="";return(o||s)&&(u+=" (found",o&&(u+=" in field "+r),s&&(u+=" in document "+i),u+=")"),new Ar(Nr.INVALID_ARGUMENT,(a+=". ")+t+u)}function Ff(t,e){return t.some((function(t){return t.isEqual(e)}))}var Mf=function(){function t(t,e,n,r,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=i}return Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ref",{get:function(){return new zl(this._firestore,this._converter,this._key)},enumerable:!1,configurable:!0}),t.prototype.exists=function(){return null!==this._document},t.prototype.data=function(){if(this._document){if(this._converter){var t=new Vf(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}},t.prototype.get=function(t){if(this._document){var e=this._document.data.field(qf("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}},t}(),Vf=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.data=function(){return t.prototype.data.call(this)},e}(Mf);function qf(t,e){return"string"==typeof e?Pf(t,e):e instanceof af?e._internalPath:e._delegate._internalPath}var Uf=function(){function t(t,e){this.hasPendingWrites=t,this.fromCache=e}return t.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},t}(),jf=function(t){function e(e,n,r,i,o,s){var a=this;return(a=t.call(this,e,n,r,i,s)||this)._firestore=e,a._firestoreImpl=e,a.metadata=o,a}return o(e,t),e.prototype.exists=function(){return t.prototype.exists.call(this)},e.prototype.data=function(t){if(void 0===t&&(t={}),this._document){if(this._converter){var e=new Bf(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}},e.prototype.get=function(t,e){if(void 0===e&&(e={}),this._document){var n=this._document.data.field(qf("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}},e}(Mf),Bf=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.data=function(e){return void 0===e&&(e={}),t.prototype.data.call(this,e)},e}(jf),Kf=function(){function t(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new Uf(r.hasPendingWrites,r.fromCache),this.query=n}return Object.defineProperty(t.prototype,"docs",{get:function(){var t=[];return this.forEach((function(e){return t.push(e)})),t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return 0===this.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t,e){var n=this;this._snapshot.docs.forEach((function(r){t.call(e,new Bf(n._firestore,n._userDataWriter,r.key,r,new Uf(n._snapshot.mutatedKeys.has(r.key),n._snapshot.fromCache),n.query.converter))}))},t.prototype.docChanges=function(t){void 0===t&&(t={});var e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new Ar(Nr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){var n=0;return t._snapshot.docChanges.map((function(e){return{type:"added",doc:new Bf(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Uf(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter),oldIndex:-1,newIndex:n++}}))}var r=t._snapshot.oldDocs;return t._snapshot.docChanges.filter((function(t){return e||3!==t.type})).map((function(e){var n=new Bf(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Uf(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter),i=-1,o=-1;return 0!==e.type&&(i=r.indexOf(e.doc.key),r=r.delete(e.doc.key)),1!==e.type&&(o=(r=r.add(e.doc)).indexOf(e.doc.key)),{type:Gf(e.type),doc:n,oldIndex:i,newIndex:o}}))}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges},t}();function Gf(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Lr()}}function Qf(t,e){return t instanceof jf&&e instanceof jf?t._firestore===e._firestore&&t._key.isEqual(e._key)&&(null===t._document?null===e._document:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof Kf&&e instanceof Kf&&t._firestore===e._firestore&&Jl(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._snapshot.isEqual(e._snapshot)}function zf(t){if(Ji(t)&&0===t.explicitOrderBy.length)throw new Ar(Nr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Hf=function(){};function Wf(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0,i=e;r<i.length;r++){t=i[r]._apply(t)}return t}var Yf=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).jc=e,i.Wc=n,i.Gc=r,i.type="where",i}return o(e,t),e.prototype._apply=function(t){var e=vf(t.firestore),n=function(t,e,n,r,i,o,s){var a;if(i.isKeyField()){if("array-contains"===o||"array-contains-any"===o)throw new Ar(Nr.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o+"' queries on FieldPath.documentId().");if("in"===o||"not-in"===o){nd(s,o);for(var u=[],c=0,h=s;c<h.length;c++){var l=h[c];u.push(ed(r,t,l))}a={arrayValue:{values:u}}}else a=ed(r,t,s)}else"in"!==o&&"not-in"!==o&&"array-contains-any"!==o||nd(s,o),a=Nf(n,"where",s,"in"===o||"not-in"===o);var f=Oi.create(i,o,a);return function(t,e){if(e.g()){var n=to(t);if(null!==n&&!n.isEqual(e.field))throw new Ar(Nr.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");var r=Zi(t);null!==r&&rd(t,e.field,r)}var i=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(e.indexOf(i.op)>=0)return i.op}return null}(t,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==i)throw i===e.op?new Ar(Nr.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter."):new Ar(Nr.INVALID_ARGUMENT,"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+i.toString()+"' filters.")}(t,f),f}(t._query,0,e,t.firestore._databaseId,this.jc,this.Wc,this.Gc);return new Hl(t.firestore,t.converter,function(t,e){var n=t.filters.concat([e]);return new Wi(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}(t._query,n))},e}(Hf),Xf=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).jc=e,r.zc=n,r.type="orderBy",r}return o(e,t),e.prototype._apply=function(t){var e=function(t,e,n){if(null!==t.startAt)throw new Ar(Nr.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new Ar(Nr.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new Gi(e,n);return function(t,e){if(null===Zi(t)){var n=to(t);null!==n&&rd(t,n,e.field)}}(t,r),r}(t._query,this.jc,this.zc);return new Hl(t.firestore,t.converter,function(t,e){var n=t.explicitOrderBy.concat([e]);return new Wi(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(t._query,e))},e}(Hf),$f=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Hc=n,i.Jc=r,i}return o(e,t),e.prototype._apply=function(t){return new Hl(t.firestore,t.converter,io(t._query,this.Hc,this.Jc))},e}(Hf),Jf=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Yc=n,i.Xc=r,i}return o(e,t),e.prototype._apply=function(t){var e=td(t,this.type,this.Yc,this.Xc);return new Hl(t.firestore,t.converter,function(t,e){return new Wi(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)}(t._query,e))},e}(Hf),Zf=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Yc=n,i.Xc=r,i}return o(e,t),e.prototype._apply=function(t){var e=td(t,this.type,this.Yc,this.Xc);return new Hl(t.firestore,t.converter,function(t,e){return new Wi(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)}(t._query,e))},e}(Hf);function td(t,e,n,r){if(n[0]=(0,c.m9)(n[0]),n[0]instanceof Mf)return function(t,e,n,r,i){if(!r)throw new Ar(Nr.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+n+"().");for(var o=[],s=0,a=no(t);s<a.length;s++){var u=a[s];if(u.field.isKeyField())o.push(mi(e,r.key));else{var c=r.data.field(u.field);if(ii(c))throw new Ar(Nr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+u.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===c){var h=u.field.canonicalString();throw new Ar(Nr.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+h+"' (used as the orderBy) does not exist.")}o.push(c)}}return new Bi(o,i)}(t._query,t.firestore._databaseId,e,n[0]._document,r);var i=vf(t.firestore);return function(t,e,n,r,i,o){var s=t.explicitOrderBy;if(i.length>s.length)throw new Ar(Nr.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var a=[],u=0;u<i.length;u++){var c=i[u];if(s[u].field.isKeyField()){if("string"!=typeof c)throw new Ar(Nr.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof c);if(!eo(t)&&-1!==c.indexOf("/"))throw new Ar(Nr.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+c+"' contains a slash.");var h=t.path.child(Yr.fromString(c));if(!hi.isDocumentKey(h))throw new Ar(Nr.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+h+"' is not because it contains an odd number of segments.");var l=new hi(h);a.push(mi(e,l))}else{var f=Nf(n,r,c);a.push(f)}}return new Bi(a,o)}(t._query,t.firestore._databaseId,i,e,n,r)}function ed(t,e,n){if("string"==typeof(n=(0,c.m9)(n))){if(""===n)throw new Ar(Nr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!eo(e)&&-1!==n.indexOf("/"))throw new Ar(Nr.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");var r=e.path.child(Yr.fromString(n));if(!hi.isDocumentKey(r))throw new Ar(Nr.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+r+"' is not because it has an odd number of segments ("+r.length+").");return mi(t,new hi(r))}if(n instanceof zl)return mi(t,n._key);throw new Ar(Nr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+jl(n)+".")}function nd(t,e){if(!Array.isArray(t)||0===t.length)throw new Ar(Nr.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(t.length>10)throw new Ar(Nr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.")}function rd(t,e,n){if(!n.isEqual(e))throw new Ar(Nr.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first argument to orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}var id=function(){function t(){}return t.prototype.convertValue=function(t,e){switch(void 0===e&&(e="none"),li(t)){case 0:return null;case 1:return t.booleanValue;case 2:return ni(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(ri(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw Lr()}},t.prototype.convertObject=function(t,e){var n=this,r={};return zr(t.fields,(function(t,i){r[t]=n.convertValue(i,e)})),r},t.prototype.convertGeoPoint=function(t){return new hf(ni(t.latitude),ni(t.longitude))},t.prototype.convertArray=function(t,e){var n=this;return(t.values||[]).map((function(t){return n.convertValue(t,e)}))},t.prototype.convertServerTimestamp=function(t,e){switch(e){case"previous":var n=oi(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(si(t));default:return null}},t.prototype.convertTimestamp=function(t){var e=ei(t);return new Kr(e.seconds,e.nanos)},t.prototype.convertDocumentKey=function(t,e){var n=Yr.fromString(t);Fr($s(n));var r=new Al(n.get(1),n.get(3)),i=new hi(n.popFirst(5));return r.isEqual(e)||Rr("Document "+i+" contains a document reference within a different database ("+r.projectId+"/"+r.database+") which is not supported. It will be treated as a reference in the current database ("+e.projectId+"/"+e.database+") instead."),i},t}();function od(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var sd=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return o(e,t),e.prototype.convertBytes=function(t){return new uf(t)},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new zl(this.firestore,null,e)},e}(id),ad=function(){function t(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=vf(t)}return t.prototype.set=function(t,e,n){this._verifyNotCommitted();var r=ud(t,this._firestore),i=od(r.converter,e,n),o=mf(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(o.toMutation(r._key,ko.none())),this},t.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];this._verifyNotCommitted();var o,s=ud(t,this._firestore);return o="string"==typeof(e=(0,c.m9)(e))||e instanceof af?Df(this._dataReader,"WriteBatch.update",s._key,e,n,r):Sf(this._dataReader,"WriteBatch.update",s._key,e),this._mutations.push(o.toMutation(s._key,ko.exists(!0))),this},t.prototype.delete=function(t){this._verifyNotCommitted();var e=ud(t,this._firestore);return this._mutations=this._mutations.concat(new Go(e._key,ko.none())),this},t.prototype.commit=function(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()},t.prototype._verifyNotCommitted=function(){if(this._committed)throw new Ar(Nr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},t}();function ud(t,e){if((t=(0,c.m9)(t)).firestore!==e)throw new Ar(Nr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}var cd=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return o(e,t),e.prototype.convertBytes=function(t){return new uf(t)},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new zl(this.firestore,null,e)},e}(id);function hd(t,e,n){t=Bl(t,zl);var r=Bl(t.firestore,ef),i=od(t.converter,e,n);return dd(r,[mf(vf(r),"setDoc",t._key,i,null!==t.converter,n).toMutation(t._key,ko.none())])}function ld(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];t=Bl(t,zl);var o=Bl(t.firestore,ef),s=vf(o);return dd(o,[("string"==typeof(e=(0,c.m9)(e))||e instanceof af?Df(s,"updateDoc",t._key,e,n,r):Sf(s,"updateDoc",t._key,e)).toMutation(t._key,ko.exists(!0))])}function fd(t){for(var e,n,r,i=[],o=1;o<arguments.length;o++)i[o-1]=arguments[o];t=(0,c.m9)(t);var u={includeMetadataChanges:!1},h=0;"object"!=typeof i[h]||tf(i[h])||(u=i[h],h++);var l,f,d,p={includeMetadataChanges:u.includeMetadataChanges};if(tf(i[h])){var y=i[h];i[h]=null===(e=y.next)||void 0===e?void 0:e.bind(y),i[h+1]=null===(n=y.error)||void 0===n?void 0:n.bind(y),i[h+2]=null===(r=y.complete)||void 0===r?void 0:r.bind(y)}if(t instanceof zl)f=Bl(t.firestore,ef),d=Xi(t._key.path),l={next:function(e){i[h]&&i[h](pd(f,t,e))},error:i[h+1],complete:i[h+2]};else{var g=Bl(t,Hl);f=Bl(g.firestore,ef),d=g._query;var v=new cd(f);l={next:function(t){i[h]&&i[h](new Kf(f,v,g,t))},error:i[h+1],complete:i[h+2]},zf(t._query)}return function(t,e,n,r){var i=this,o=new fl(r),u=new Th(e,o,n);return t.asyncQueue.enqueueAndForget((function(){return s(i,void 0,void 0,(function(){var e;return a(this,(function(n){switch(n.label){case 0:return e=gh,[4,_l(t)];case 1:return[2,e.apply(void 0,[n.sent(),u])]}}))}))})),function(){o.Wo(),t.asyncQueue.enqueueAndForget((function(){return s(i,void 0,void 0,(function(){var e;return a(this,(function(n){switch(n.label){case 0:return e=vh,[4,_l(t)];case 1:return[2,e.apply(void 0,[n.sent(),u])]}}))}))}))}}(nf(f),d,p,l)}function dd(t,e){return function(t,e){var n=this,r=new Ta;return t.asyncQueue.enqueueAndForget((function(){return s(n,void 0,void 0,(function(){var n;return a(this,(function(i){switch(i.label){case 0:return n=Ph,[4,El(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}}))}))})),r.promise}(nf(t),e)}function pd(t,e,n){var r=n.docs.get(e._key),i=new cd(t);return new jf(t,i,e._key,r,new Uf(n.hasPendingWrites,n.fromCache),e.converter)}var yd=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this)._firestore=e,r}return o(e,t),e.prototype.get=function(e){var n=this,r=ud(e,this._firestore),i=new cd(this._firestore);return t.prototype.get.call(this,e).then((function(t){return new jf(n._firestore,i,r._key,t._document,new Uf(!1,!1),r.converter)}))},e}(function(){function t(t,e){this._firestore=t,this._transaction=e,this._dataReader=vf(t)}return t.prototype.get=function(t){var e=this,n=ud(t,this._firestore),r=new sd(this._firestore);return this._transaction.lookup([n._key]).then((function(t){if(!t||1!==t.length)return Lr();var i=t[0];if(i.isFoundDocument())return new Mf(e._firestore,r,i.key,i,n.converter);if(i.isNoDocument())return new Mf(e._firestore,r,n._key,null,n.converter);throw Lr()}))},t.prototype.set=function(t,e,n){var r=ud(t,this._firestore),i=od(r.converter,e,n),o=mf(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,o),this},t.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o,s=ud(t,this._firestore);return o="string"==typeof(e=(0,c.m9)(e))||e instanceof af?Df(this._dataReader,"Transaction.update",s._key,e,n,r):Sf(this._dataReader,"Transaction.update",s._key,e),this._transaction.update(s._key,o),this},t.prototype.delete=function(t){var e=ud(t,this._firestore);return this._transaction.delete(e._key),this},t}());function gd(){if("undefined"==typeof Uint8Array)throw new Ar(Nr.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function vd(){if("undefined"==typeof atob)throw new Ar(Nr.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var md=function(){function t(t){this._delegate=t}return t.fromBase64String=function(e){return vd(),new t(uf.fromBase64String(e))},t.fromUint8Array=function(e){return gd(),new t(uf.fromUint8Array(e))},t.prototype.toBase64=function(){return vd(),this._delegate.toBase64()},t.prototype.toUint8Array=function(){return gd(),this._delegate.toUint8Array()},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},t}(),wd=function(){function t(){}return t.prototype.enableIndexedDbPersistence=function(t,e){return function(t,e){sf(t=Bl(t,ef));var n=nf(t),r=t._freezeSettings(),i=new ll;return of(n,i,new cl(i,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(t._delegate,{forceOwnership:e})},t.prototype.enableMultiTabIndexedDbPersistence=function(t){return function(t){sf(t=Bl(t,ef));var e=nf(t),n=t._freezeSettings(),r=new ll;return of(e,r,new hl(r,n.cacheSizeBytes))}(t._delegate)},t.prototype.clearIndexedDbPersistence=function(t){return function(t){var e=this;if(t._initialized&&!t._terminated)throw new Ar(Nr.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var n=new Ta;return t._queue.enqueueAndForgetEvenWhileRestricted((function(){return s(e,void 0,void 0,(function(){var e;return a(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,function(t){return s(this,void 0,void 0,(function(){var e;return a(this,(function(n){switch(n.label){case 0:return _a.yt()?(e=t+"main",[4,_a.delete(e)]):[2,Promise.resolve()];case 1:return n.sent(),[2]}}))}))}(Lu(t._databaseId,t._persistenceKey))];case 1:return r.sent(),n.resolve(),[3,3];case 2:return e=r.sent(),n.reject(e),[3,3];case 3:return[2]}}))}))})),n.promise}(t._delegate)},t}(),bd=function(){function t(t,e,n){var r=this;this._delegate=e,this.Zc=n,this.INTERNAL={delete:function(){return r.terminate()}},t instanceof Al||(this.tu=t)}return Object.defineProperty(t.prototype,"_databaseId",{get:function(){return this._delegate._databaseId},enumerable:!1,configurable:!0}),t.prototype.settings=function(t){var e=this._delegate._getSettings();t.merge||e.host===t.host||Or("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),t.merge&&delete(t=Object.assign(Object.assign({},e),t)).merge,this._delegate._setSettings(t)},t.prototype.useEmulator=function(t,e,n){void 0===n&&(n={}),function(t,e,n,r){var i;void 0===r&&(r={});var o=(t=Bl(t,Ql))._getSettings();if("firestore.googleapis.com"!==o.host&&o.host!==e&&Or("Host has been set in both settings() and useEmulator(), emulator host will be used"),t._setSettings(Object.assign(Object.assign({},o),{host:e+":"+n,ssl:!1})),r.mockUserToken){var s,a;if("string"==typeof r.mockUserToken)s=r.mockUserToken,a=fc.MOCK_USER;else{s=(0,c.Sg)(r.mockUserToken,null===(i=t._app)||void 0===i?void 0:i.options.projectId);var u=r.mockUserToken.sub||r.mockUserToken.user_id;if(!u)throw new Ar(Nr.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");a=new fc(u)}t._credentials=new Rl(new Cl(s,a))}}(this._delegate,t,e,n)},t.prototype.enableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue((function(){return s(e,void 0,void 0,(function(){var e,n;return a(this,(function(r){switch(r.label){case 0:return[4,bl(t)];case 1:return e=r.sent(),[4,Il(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!0),function(t){var e=Mr(t);return e.Or.delete(0),Vc(e)}(n))]}}))}))}))}(nf(Bl(this._delegate,ef)))},t.prototype.disableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue((function(){return s(e,void 0,void 0,(function(){var e,n;return a(this,(function(r){switch(r.label){case 0:return[4,bl(t)];case 1:return e=r.sent(),[4,Il(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!1),function(t){return s(this,void 0,void 0,(function(){var e;return a(this,(function(n){switch(n.label){case 0:return(e=Mr(t)).Or.add(0),[4,qc(e)];case 1:return n.sent(),e.Br.set("Offline"),[2]}}))}))}(n))]}}))}))}))}(nf(Bl(this._delegate,ef)))},t.prototype.enablePersistence=function(t){var e=!1,n=!1;return t&&Vl("synchronizeTabs",e=!!t.synchronizeTabs,"experimentalForceOwningTab",n=!!t.experimentalForceOwningTab),e?this.Zc.enableMultiTabIndexedDbPersistence(this):this.Zc.enableIndexedDbPersistence(this,n)},t.prototype.clearPersistence=function(){return this.Zc.clearIndexedDbPersistence(this)},t.prototype.terminate=function(){return this.tu&&(this.tu._removeServiceInstance("firestore"),this.tu._removeServiceInstance("firestore-exp")),this._delegate._delete()},t.prototype.waitForPendingWrites=function(){return function(t){var e=this,n=new Ta;return t.asyncQueue.enqueueAndForget((function(){return s(e,void 0,void 0,(function(){var e;return a(this,(function(r){switch(r.label){case 0:return e=Uh,[4,El(t)];case 1:return[2,e.apply(void 0,[r.sent(),n])]}}))}))})),n.promise}(nf(Bl(this._delegate,ef)))},t.prototype.onSnapshotsInSync=function(t){return function(t,e){return function(t,e){var n=this,r=new fl(e);return t.asyncQueue.enqueueAndForget((function(){return s(n,void 0,void 0,(function(){var e;return a(this,(function(n){switch(n.label){case 0:return e=function(t,e){Mr(t).Gr.add(e),e.next()},[4,_l(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}}))}))})),function(){r.Wo(),t.asyncQueue.enqueueAndForget((function(){return s(n,void 0,void 0,(function(){var e;return a(this,(function(n){switch(n.label){case 0:return e=function(t,e){Mr(t).Gr.delete(e)},[4,_l(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}}))}))}))}}(nf(t=Bl(t,ef)),tf(e)?e:{next:e})}(this._delegate,t)},Object.defineProperty(t.prototype,"app",{get:function(){if(!this.tu)throw new Ar(Nr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.tu},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new Pd(this,Yl(this._delegate,t))}catch(t){throw Dd(t,"collection()","Firestore.collection()")}},t.prototype.doc=function(t){try{return new Sd(this,Xl(this._delegate,t))}catch(t){throw Dd(t,"doc()","Firestore.doc()")}},t.prototype.collectionGroup=function(t){try{return new xd(this,function(t,e){if(t=Bl(t,Ql),Fl("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new Ar(Nr.INVALID_ARGUMENT,"Invalid collection ID '"+e+"' passed to function collectionGroup(). Collection IDs must not contain '/'.");return new Hl(t,null,function(t){return new Wi(Yr.emptyPath(),t)}(e))}(this._delegate,t))}catch(t){throw Dd(t,"collectionGroup()","Firestore.collectionGroup()")}},t.prototype.runTransaction=function(t){var e=this;return function(t,e){return function(t,e){var n=this,r=new Ta;return t.asyncQueue.enqueueAndForget((function(){return s(n,void 0,void 0,(function(){var n;return a(this,(function(i){switch(i.label){case 0:return[4,function(t){return wl(t).then((function(t){return t.datastore}))}(t)];case 1:return n=i.sent(),new pl(t.asyncQueue,n,e,r).run(),[2]}}))}))})),r.promise}(nf(t),(function(n){return e(new yd(t,n))}))}(this._delegate,(function(n){return t(new Id(e,n))}))},t.prototype.batch=function(){var t=this;return nf(this._delegate),new Ed(new ad(this._delegate,(function(e){return dd(t._delegate,e)})))},t.prototype.loadBundle=function(t){throw new Ar(Nr.FAILED_PRECONDITION,'"loadBundle()" does not exist, have you imported "firebase/firestore/bundle"?')},t.prototype.namedQuery=function(t){throw new Ar(Nr.FAILED_PRECONDITION,'"namedQuery()" does not exist, have you imported "firebase/firestore/bundle"?')},t}(),Td=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return o(e,t),e.prototype.convertBytes=function(t){return new md(new uf(t))},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return Sd.eu(e,this.firestore,null)},e}(id);var Id=function(){function t(t,e){this._firestore=t,this._delegate=e,this._userDataWriter=new Td(t)}return t.prototype.get=function(t){var e=this,n=Ld(t);return this._delegate.get(n).then((function(t){return new kd(e._firestore,new jf(e._firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,n.converter))}))},t.prototype.set=function(t,e,n){var r=Ld(t);return n?(Ml("Transaction.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var s=Ld(t);return 2===arguments.length?this._delegate.update(s,e):(r=this._delegate).update.apply(r,u([s,e,n],i)),this},t.prototype.delete=function(t){var e=Ld(t);return this._delegate.delete(e),this},t}(),Ed=function(){function t(t){this._delegate=t}return t.prototype.set=function(t,e,n){var r=Ld(t);return n?(Ml("WriteBatch.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var s=Ld(t);return 2===arguments.length?this._delegate.update(s,e):(r=this._delegate).update.apply(r,u([s,e,n],i)),this},t.prototype.delete=function(t){var e=Ld(t);return this._delegate.delete(e),this},t.prototype.commit=function(){return this._delegate.commit()},t}(),_d=function(){function t(t,e,n){this._firestore=t,this._userDataWriter=e,this._delegate=n}return t.prototype.fromFirestore=function(t,e){var n=new Bf(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null);return this._delegate.fromFirestore(new Cd(this._firestore,n),null!=e?e:{})},t.prototype.toFirestore=function(t,e){return e?this._delegate.toFirestore(t,e):this._delegate.toFirestore(t)},t.nu=function(e,n){var r=t.su,i=r.get(e);i||(i=new WeakMap,r.set(e,i));var o=i.get(n);return o||(o=new t(e,new Td(e),n),i.set(n,o)),o},t}();_d.su=new WeakMap;var Sd=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new Td(t)}return t.iu=function(e,n,r){if(e.length%2!=0)throw new Ar(Nr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+e.canonicalString()+" has "+e.length);return new t(n,new zl(n._delegate,r,new hi(e)))},t.eu=function(e,n,r){return new t(n,new zl(n._delegate,r,e))},Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new Pd(this.firestore,this._delegate.parent)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new Pd(this.firestore,Yl(this._delegate,t))}catch(t){throw Dd(t,"collection()","DocumentReference.collection()")}},t.prototype.isEqual=function(t){return(t=(0,c.m9)(t))instanceof zl&&$l(this._delegate,t)},t.prototype.set=function(t,e){e=Ml("DocumentReference.set",e);try{return e?hd(this._delegate,t,e):hd(this._delegate,t)}catch(t){throw Dd(t,"setDoc()","DocumentReference.set()")}},t.prototype.update=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];try{return 1===arguments.length?ld(this._delegate,t):ld.apply(void 0,u([this._delegate,t,e],n))}catch(t){throw Dd(t,"updateDoc()","DocumentReference.update()")}},t.prototype.delete=function(){return dd(Bl((t=this._delegate).firestore,ef),[new Go(t._key,ko.none())]);var t},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=Nd(e),i=Ad(e,(function(e){return new kd(t.firestore,new jf(t.firestore._delegate,t._userDataWriter,e._key,e._document,e.metadata,t._delegate.converter))}));return fd(this._delegate,r,i)},t.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=Bl(t,zl);var e=Bl(t.firestore,ef),n=nf(e),r=new cd(e);return function(t,e){var n=this,r=new Ta;return t.asyncQueue.enqueueAndForget((function(){return s(n,void 0,void 0,(function(){var n;return a(this,(function(i){switch(i.label){case 0:return n=function(t,e,n){return s(this,void 0,void 0,(function(){var r,i;return a(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,function(t,e){var n=Mr(t);return n.persistence.runTransaction("read document","readonly",(function(t){return n.Mn.mn(t,e)}))}(t,e)];case 1:return(i=o.sent()).isFoundDocument()?n.resolve(i):i.isNoDocument()?n.resolve(null):n.reject(new Ar(Nr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return r=o.sent(),i=hh(r,"Failed to get document '"+e+" from cache"),n.reject(i),[3,3];case 3:return[2]}}))}))},[4,Tl(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}}))}))})),r.promise}(n,t._key).then((function(n){return new jf(e,r,t._key,n,new Uf(null!==n&&n.hasLocalMutations,!0),t.converter)}))}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=Bl(t,zl);var e=Bl(t.firestore,ef);return Sl(nf(e),t._key,{source:"server"}).then((function(n){return pd(e,t,n)}))}(this._delegate):function(t){t=Bl(t,zl);var e=Bl(t.firestore,ef);return Sl(nf(e),t._key).then((function(n){return pd(e,t,n)}))}(this._delegate)).then((function(t){return new kd(e.firestore,new jf(e.firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,e._delegate.converter))}))},t.prototype.withConverter=function(e){return new t(this.firestore,e?this._delegate.withConverter(_d.nu(this.firestore,e)):this._delegate.withConverter(null))},t}();function Dd(t,e,n){return t.message=t.message.replace(e,n),t}function Nd(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if("object"==typeof r&&!tf(r))return r}return{}}function Ad(t,e){var n,r,i;return{next:function(t){i.next&&i.next(e(t))},error:null===(n=(i=tf(t[0])?t[0]:tf(t[1])?t[1]:"function"==typeof t[0]?{next:t[0],error:t[1],complete:t[2]}:{next:t[1],error:t[2],complete:t[3]}).error)||void 0===n?void 0:n.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}var kd=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"ref",{get:function(){return new Sd(this._firestore,this._delegate.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"exists",{get:function(){return this._delegate.exists()},enumerable:!1,configurable:!0}),t.prototype.data=function(t){return this._delegate.data(t)},t.prototype.get=function(t,e){return this._delegate.get(t,e)},t.prototype.isEqual=function(t){return Qf(this._delegate,t._delegate)},t}(),Cd=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.data=function(t){return this._delegate.data(t)},e}(kd),xd=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new Td(t)}return t.prototype.where=function(e,n,r){try{return new t(this.firestore,Wf(this._delegate,function(t,e,n){var r=e,i=qf("where",t);return new Yf(i,r,n)}(e,n,r)))}catch(e){throw Dd(e,/(orderBy|where)\(\)/,"Query.$1()")}},t.prototype.orderBy=function(e,n){try{return new t(this.firestore,Wf(this._delegate,function(t,e){void 0===e&&(e="asc");var n=e,r=qf("orderBy",t);return new Xf(r,n)}(e,n)))}catch(e){throw Dd(e,/(orderBy|where)\(\)/,"Query.$1()")}},t.prototype.limit=function(e){try{return new t(this.firestore,Wf(this._delegate,function(t){return Kl("limit",t),new $f("limit",t,"F")}(e)))}catch(e){throw Dd(e,"limit()","Query.limit()")}},t.prototype.limitToLast=function(e){try{return new t(this.firestore,Wf(this._delegate,function(t){return Kl("limitToLast",t),new $f("limitToLast",t,"L")}(e)))}catch(e){throw Dd(e,"limitToLast()","Query.limitToLast()")}},t.prototype.startAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Wf(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Jf("startAt",t,!0)}.apply(void 0,e)))}catch(e){throw Dd(e,"startAt()","Query.startAt()")}},t.prototype.startAfter=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Wf(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Jf("startAfter",t,!1)}.apply(void 0,e)))}catch(e){throw Dd(e,"startAfter()","Query.startAfter()")}},t.prototype.endBefore=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Wf(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Zf("endBefore",t,!0)}.apply(void 0,e)))}catch(e){throw Dd(e,"endBefore()","Query.endBefore()")}},t.prototype.endAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Wf(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Zf("endAt",t,!1)}.apply(void 0,e)))}catch(e){throw Dd(e,"endAt()","Query.endAt()")}},t.prototype.isEqual=function(t){return Jl(this._delegate,t._delegate)},t.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=Bl(t,Hl);var e=Bl(t.firestore,ef),n=nf(e),r=new cd(e);return function(t,e){var n=this,r=new Ta;return t.asyncQueue.enqueueAndForget((function(){return s(n,void 0,void 0,(function(){var n;return a(this,(function(i){switch(i.label){case 0:return n=function(t,e,n){return s(this,void 0,void 0,(function(){var r,i,o,s,u;return a(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,Xu(t,e,!0)];case 1:return u=a.sent(),r=new Nh(e,u.Bn),i=r._o(u.documents),o=r.applyChanges(i,!1),n.resolve(o.snapshot),[3,3];case 2:return s=a.sent(),u=hh(s,"Failed to execute query '"+e+" against cache"),n.reject(u),[3,3];case 3:return[2]}}))}))},[4,Tl(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}}))}))})),r.promise}(n,t._query).then((function(n){return new Kf(e,r,t,n)}))}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=Bl(t,Hl);var e=Bl(t.firestore,ef),n=nf(e),r=new cd(e);return Dl(n,t._query,{source:"server"}).then((function(n){return new Kf(e,r,t,n)}))}(this._delegate):function(t){t=Bl(t,Hl);var e=Bl(t.firestore,ef),n=nf(e),r=new cd(e);return zf(t._query),Dl(n,t._query).then((function(n){return new Kf(e,r,t,n)}))}(this._delegate)).then((function(t){return new Od(e.firestore,new Kf(e.firestore._delegate,e._userDataWriter,e._delegate,t._snapshot))}))},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=Nd(e),i=Ad(e,(function(e){return new Od(t.firestore,new Kf(t.firestore._delegate,t._userDataWriter,t._delegate,e._snapshot))}));return fd(this._delegate,r,i)},t.prototype.withConverter=function(e){return new t(this.firestore,e?this._delegate.withConverter(_d.nu(this.firestore,e)):this._delegate.withConverter(null))},t}(),Rd=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"type",{get:function(){return this._delegate.type},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"doc",{get:function(){return new Cd(this._firestore,this._delegate.doc)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"oldIndex",{get:function(){return this._delegate.oldIndex},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"newIndex",{get:function(){return this._delegate.newIndex},enumerable:!1,configurable:!0}),t}(),Od=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"query",{get:function(){return new xd(this._firestore,this._delegate.query)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._delegate.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return this._delegate.empty},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"docs",{get:function(){var t=this;return this._delegate.docs.map((function(e){return new Cd(t._firestore,e)}))},enumerable:!1,configurable:!0}),t.prototype.docChanges=function(t){var e=this;return this._delegate.docChanges(t).map((function(t){return new Rd(e._firestore,t)}))},t.prototype.forEach=function(t,e){var n=this;this._delegate.forEach((function(r){t.call(e,new Cd(n._firestore,r))}))},t.prototype.isEqual=function(t){return Qf(this._delegate,t._delegate)},t}(),Pd=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).firestore=e,r._delegate=n,r}return o(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._delegate.parent;return t?new Sd(this.firestore,t):null},enumerable:!1,configurable:!0}),e.prototype.doc=function(t){try{return new Sd(this.firestore,void 0===t?Xl(this._delegate):Xl(this._delegate,t))}catch(t){throw Dd(t,"doc()","CollectionReference.doc()")}},e.prototype.add=function(t){var e=this;return function(t,e){var n=Bl(t.firestore,ef),r=Xl(t),i=od(t.converter,e);return dd(n,[mf(vf(t.firestore),"addDoc",r._key,i,null!==t.converter,{}).toMutation(r._key,ko.exists(!1))]).then((function(){return r}))}(this._delegate,t).then((function(t){return new Sd(e.firestore,t)}))},e.prototype.isEqual=function(t){return $l(this._delegate,t._delegate)},e.prototype.withConverter=function(t){return new e(this.firestore,t?this._delegate.withConverter(_d.nu(this.firestore,t)):this._delegate.withConverter(null))},e}(xd);function Ld(t){return Bl(t,zl)}var Fd=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._delegate=new(af.bind.apply(af,u([void 0],t)))}return t.documentId=function(){return new t($r.keyField().canonicalString())},t.prototype.isEqual=function(t){return(t=(0,c.m9)(t))instanceof af&&this._delegate._internalPath.isEqual(t._internalPath)},t}(),Md=function(){function t(t){this._delegate=t}return t.serverTimestamp=function(){var e=new Tf("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new t(e)},t.delete=function(){var e=new wf("deleteField");return e._methodName="FieldValue.delete",new t(e)},t.arrayUnion=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new If("arrayUnion",t)}.apply(void 0,e);return r._methodName="FieldValue.arrayUnion",new t(r)},t.arrayRemove=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Ef("arrayRemove",t)}.apply(void 0,e);return r._methodName="FieldValue.arrayRemove",new t(r)},t.increment=function(e){var n=function(t){return new _f("increment",t)}(e);return n._methodName="FieldValue.increment",new t(n)},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t}();var Vd,qd=n(437),Ud={Firestore:bd,GeoPoint:hf,Timestamp:Kr,Blob:md,Transaction:Id,WriteBatch:Ed,DocumentReference:Sd,DocumentSnapshot:kd,Query:xd,QueryDocumentSnapshot:Cd,QuerySnapshot:Od,CollectionReference:Pd,FieldPath:Fd,FieldValue:Md,setLogLevel:function(t){var e;e=t,kr.setLogLevel(e)},CACHE_SIZE_UNLIMITED:-1};(function(t,e){t.INTERNAL.registerComponent(new qd.wA("firestore",(function(t){return function(t,e){return new bd(t,new ef(t,e),new wd)}(t.getProvider("app").getImmediate(),t.getProvider("auth-internal"))}),"PUBLIC").setServiceProps(Object.assign({},Ud)))})(Vd=r.Z),Vd.registerVersion("@firebase/firestore","2.4.1")}}]);